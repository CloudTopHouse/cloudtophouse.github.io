<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Spring Security OAuth2.0 认证授权 | 山河社稷图</title>
    <meta name="description" content="学习笔记">
    <meta name="generator" content="VuePress 1.4.0">
    <link rel="icon" href="/favicon.ico">
  <link rel="manifest" href="/manifest.json">
    
    <link rel="preload" href="/assets/css/0.styles.477ae52b.css" as="style"><link rel="preload" href="/assets/js/app.b1e3aafa.js" as="script"><link rel="preload" href="/assets/js/3.053a1cac.js" as="script"><link rel="preload" href="/assets/js/7.8dff6ea0.js" as="script"><link rel="prefetch" href="/assets/js/10.81b8e2a5.js"><link rel="prefetch" href="/assets/js/100.e413f7a1.js"><link rel="prefetch" href="/assets/js/101.77e1ecbb.js"><link rel="prefetch" href="/assets/js/102.17738a72.js"><link rel="prefetch" href="/assets/js/103.3a9c7450.js"><link rel="prefetch" href="/assets/js/104.c307999d.js"><link rel="prefetch" href="/assets/js/105.cc9bc364.js"><link rel="prefetch" href="/assets/js/106.d29e01a5.js"><link rel="prefetch" href="/assets/js/107.41ff0c63.js"><link rel="prefetch" href="/assets/js/108.4b1f3fe4.js"><link rel="prefetch" href="/assets/js/109.d2c162c1.js"><link rel="prefetch" href="/assets/js/11.131389f3.js"><link rel="prefetch" href="/assets/js/110.6d77df08.js"><link rel="prefetch" href="/assets/js/111.08f95385.js"><link rel="prefetch" href="/assets/js/112.a95b3355.js"><link rel="prefetch" href="/assets/js/113.2a4adf33.js"><link rel="prefetch" href="/assets/js/114.eab1daa2.js"><link rel="prefetch" href="/assets/js/115.776e83e4.js"><link rel="prefetch" href="/assets/js/116.8cc9882d.js"><link rel="prefetch" href="/assets/js/117.c48155dd.js"><link rel="prefetch" href="/assets/js/118.72d2a9e7.js"><link rel="prefetch" href="/assets/js/119.fed76ece.js"><link rel="prefetch" href="/assets/js/12.eebe822f.js"><link rel="prefetch" href="/assets/js/120.a23d0b9d.js"><link rel="prefetch" href="/assets/js/121.0e933231.js"><link rel="prefetch" href="/assets/js/122.e1f198fa.js"><link rel="prefetch" href="/assets/js/123.b34e37a9.js"><link rel="prefetch" href="/assets/js/124.42e2f45e.js"><link rel="prefetch" href="/assets/js/125.94976df9.js"><link rel="prefetch" href="/assets/js/126.02597c74.js"><link rel="prefetch" href="/assets/js/127.a4732edb.js"><link rel="prefetch" href="/assets/js/128.28a5c9f4.js"><link rel="prefetch" href="/assets/js/129.b8981fb5.js"><link rel="prefetch" href="/assets/js/13.3c340d26.js"><link rel="prefetch" href="/assets/js/130.f9ed6076.js"><link rel="prefetch" href="/assets/js/131.11fefaee.js"><link rel="prefetch" href="/assets/js/132.4a0b6be8.js"><link rel="prefetch" href="/assets/js/133.789589ef.js"><link rel="prefetch" href="/assets/js/134.78576b10.js"><link rel="prefetch" href="/assets/js/135.921f8aeb.js"><link rel="prefetch" href="/assets/js/136.cced45c6.js"><link rel="prefetch" href="/assets/js/137.ce55634f.js"><link rel="prefetch" href="/assets/js/138.711061e9.js"><link rel="prefetch" href="/assets/js/139.d4fc1899.js"><link rel="prefetch" href="/assets/js/14.a5b42a2b.js"><link rel="prefetch" href="/assets/js/140.572ec5cd.js"><link rel="prefetch" href="/assets/js/141.8ace4b4a.js"><link rel="prefetch" href="/assets/js/142.4f02fda1.js"><link rel="prefetch" href="/assets/js/143.e0487c21.js"><link rel="prefetch" href="/assets/js/144.74e288e7.js"><link rel="prefetch" href="/assets/js/145.e53f1bcd.js"><link rel="prefetch" href="/assets/js/146.27cb5135.js"><link rel="prefetch" href="/assets/js/147.5d9238de.js"><link rel="prefetch" href="/assets/js/148.e7c27d61.js"><link rel="prefetch" href="/assets/js/149.e87f3ea8.js"><link rel="prefetch" href="/assets/js/15.2911388f.js"><link rel="prefetch" href="/assets/js/150.113f8682.js"><link rel="prefetch" href="/assets/js/151.debad739.js"><link rel="prefetch" href="/assets/js/152.1bbd7e1a.js"><link rel="prefetch" href="/assets/js/153.824c6478.js"><link rel="prefetch" href="/assets/js/154.8c53e05d.js"><link rel="prefetch" href="/assets/js/155.dd895090.js"><link rel="prefetch" href="/assets/js/156.66c8ce64.js"><link rel="prefetch" href="/assets/js/157.7386fc78.js"><link rel="prefetch" href="/assets/js/158.d00d7f95.js"><link rel="prefetch" href="/assets/js/159.6f5de174.js"><link rel="prefetch" href="/assets/js/16.407ec56d.js"><link rel="prefetch" href="/assets/js/160.cc3ed796.js"><link rel="prefetch" href="/assets/js/161.91099b7d.js"><link rel="prefetch" href="/assets/js/162.32ef2051.js"><link rel="prefetch" href="/assets/js/163.4cb0bf09.js"><link rel="prefetch" href="/assets/js/164.4563fb2f.js"><link rel="prefetch" href="/assets/js/165.a2c02ca8.js"><link rel="prefetch" href="/assets/js/166.df3604cd.js"><link rel="prefetch" href="/assets/js/167.da639fda.js"><link rel="prefetch" href="/assets/js/168.330871fd.js"><link rel="prefetch" href="/assets/js/169.12737b08.js"><link rel="prefetch" href="/assets/js/17.33ea195a.js"><link rel="prefetch" href="/assets/js/170.58207317.js"><link rel="prefetch" href="/assets/js/171.d99f6ad8.js"><link rel="prefetch" href="/assets/js/172.c59bc626.js"><link rel="prefetch" href="/assets/js/173.4b801329.js"><link rel="prefetch" href="/assets/js/174.b2b9c95a.js"><link rel="prefetch" href="/assets/js/175.6d5b816d.js"><link rel="prefetch" href="/assets/js/176.60491e3a.js"><link rel="prefetch" href="/assets/js/177.fa1f6557.js"><link rel="prefetch" href="/assets/js/178.6e06b0cd.js"><link rel="prefetch" href="/assets/js/179.04e58f18.js"><link rel="prefetch" href="/assets/js/18.e0cce666.js"><link rel="prefetch" href="/assets/js/180.8029c7db.js"><link rel="prefetch" href="/assets/js/181.fb65df9b.js"><link rel="prefetch" href="/assets/js/182.6b1fce34.js"><link rel="prefetch" href="/assets/js/183.d5eb984e.js"><link rel="prefetch" href="/assets/js/184.6f78e190.js"><link rel="prefetch" href="/assets/js/185.efc60297.js"><link rel="prefetch" href="/assets/js/186.e5fd87b9.js"><link rel="prefetch" href="/assets/js/187.c866edc7.js"><link rel="prefetch" href="/assets/js/188.bdf77a8b.js"><link rel="prefetch" href="/assets/js/189.c4ee6349.js"><link rel="prefetch" href="/assets/js/19.19fbadbb.js"><link rel="prefetch" href="/assets/js/190.c6ddc3b1.js"><link rel="prefetch" href="/assets/js/191.cbb80b77.js"><link rel="prefetch" href="/assets/js/192.90301c7e.js"><link rel="prefetch" href="/assets/js/193.6bd0feef.js"><link rel="prefetch" href="/assets/js/194.f206446d.js"><link rel="prefetch" href="/assets/js/195.99910e37.js"><link rel="prefetch" href="/assets/js/196.8fe0075a.js"><link rel="prefetch" href="/assets/js/197.68dcce08.js"><link rel="prefetch" href="/assets/js/198.58cca528.js"><link rel="prefetch" href="/assets/js/199.d5a5380b.js"><link rel="prefetch" href="/assets/js/20.3cb2a1f8.js"><link rel="prefetch" href="/assets/js/200.2ee2a9b0.js"><link rel="prefetch" href="/assets/js/201.aa5e3c2d.js"><link rel="prefetch" href="/assets/js/202.89b2622c.js"><link rel="prefetch" href="/assets/js/203.311a8355.js"><link rel="prefetch" href="/assets/js/204.37c87881.js"><link rel="prefetch" href="/assets/js/205.e47e3dfe.js"><link rel="prefetch" href="/assets/js/206.2be437cf.js"><link rel="prefetch" href="/assets/js/207.0166eddc.js"><link rel="prefetch" href="/assets/js/208.00d70aab.js"><link rel="prefetch" href="/assets/js/209.145ed104.js"><link rel="prefetch" href="/assets/js/21.564f0f3b.js"><link rel="prefetch" href="/assets/js/210.69a42b86.js"><link rel="prefetch" href="/assets/js/211.e31aa405.js"><link rel="prefetch" href="/assets/js/212.9dd5df8d.js"><link rel="prefetch" href="/assets/js/213.43dbbc83.js"><link rel="prefetch" href="/assets/js/214.00595adf.js"><link rel="prefetch" href="/assets/js/215.b5661cae.js"><link rel="prefetch" href="/assets/js/216.745cbd16.js"><link rel="prefetch" href="/assets/js/217.bb4b0ebc.js"><link rel="prefetch" href="/assets/js/218.e4a0fd5c.js"><link rel="prefetch" href="/assets/js/219.309f2abc.js"><link rel="prefetch" href="/assets/js/22.34e96fb2.js"><link rel="prefetch" href="/assets/js/220.a67391e3.js"><link rel="prefetch" href="/assets/js/221.fe050248.js"><link rel="prefetch" href="/assets/js/222.97a8b723.js"><link rel="prefetch" href="/assets/js/223.ff7a6884.js"><link rel="prefetch" href="/assets/js/224.dcea150c.js"><link rel="prefetch" href="/assets/js/225.753bfe05.js"><link rel="prefetch" href="/assets/js/226.c416a21f.js"><link rel="prefetch" href="/assets/js/227.ef0422f6.js"><link rel="prefetch" href="/assets/js/228.9f8b2811.js"><link rel="prefetch" href="/assets/js/229.6633dba6.js"><link rel="prefetch" href="/assets/js/23.03e9f714.js"><link rel="prefetch" href="/assets/js/230.dd1a0a2b.js"><link rel="prefetch" href="/assets/js/231.dba512ab.js"><link rel="prefetch" href="/assets/js/232.ee9b4680.js"><link rel="prefetch" href="/assets/js/233.8c137178.js"><link rel="prefetch" href="/assets/js/234.09fd194e.js"><link rel="prefetch" href="/assets/js/235.610781a5.js"><link rel="prefetch" href="/assets/js/236.6ea2e4a5.js"><link rel="prefetch" href="/assets/js/237.24e84ac6.js"><link rel="prefetch" href="/assets/js/238.3aa9b09e.js"><link rel="prefetch" href="/assets/js/239.f8f927f8.js"><link rel="prefetch" href="/assets/js/24.b388baeb.js"><link rel="prefetch" href="/assets/js/240.abf5c23b.js"><link rel="prefetch" href="/assets/js/241.73cba2f0.js"><link rel="prefetch" href="/assets/js/242.6cdf8f79.js"><link rel="prefetch" href="/assets/js/243.d8739c8e.js"><link rel="prefetch" href="/assets/js/244.c3927131.js"><link rel="prefetch" href="/assets/js/245.f8b8d6e1.js"><link rel="prefetch" href="/assets/js/246.eb7a31e4.js"><link rel="prefetch" href="/assets/js/247.d5055b44.js"><link rel="prefetch" href="/assets/js/248.d4363b11.js"><link rel="prefetch" href="/assets/js/249.0947a1fe.js"><link rel="prefetch" href="/assets/js/25.30a648c3.js"><link rel="prefetch" href="/assets/js/250.8a4cfdc4.js"><link rel="prefetch" href="/assets/js/251.699b742b.js"><link rel="prefetch" href="/assets/js/252.b76a9af8.js"><link rel="prefetch" href="/assets/js/253.dc0b970e.js"><link rel="prefetch" href="/assets/js/254.7cbd45fa.js"><link rel="prefetch" href="/assets/js/255.c81fcd35.js"><link rel="prefetch" href="/assets/js/256.98916287.js"><link rel="prefetch" href="/assets/js/257.0250bee0.js"><link rel="prefetch" href="/assets/js/258.801d1bc7.js"><link rel="prefetch" href="/assets/js/259.b93a6440.js"><link rel="prefetch" href="/assets/js/26.979d5eac.js"><link rel="prefetch" href="/assets/js/260.23ccdc5a.js"><link rel="prefetch" href="/assets/js/261.b80f7352.js"><link rel="prefetch" href="/assets/js/262.22f0930a.js"><link rel="prefetch" href="/assets/js/263.2deb150f.js"><link rel="prefetch" href="/assets/js/264.b9cb7505.js"><link rel="prefetch" href="/assets/js/265.e6112ebb.js"><link rel="prefetch" href="/assets/js/266.052808ed.js"><link rel="prefetch" href="/assets/js/267.89f30168.js"><link rel="prefetch" href="/assets/js/268.bfa8d7c4.js"><link rel="prefetch" href="/assets/js/269.02d79ba4.js"><link rel="prefetch" href="/assets/js/27.36b5f82c.js"><link rel="prefetch" href="/assets/js/270.f55b3071.js"><link rel="prefetch" href="/assets/js/271.36fcba11.js"><link rel="prefetch" href="/assets/js/272.db8044b6.js"><link rel="prefetch" href="/assets/js/273.723c5ac7.js"><link rel="prefetch" href="/assets/js/274.37e06a9d.js"><link rel="prefetch" href="/assets/js/275.432ccbb5.js"><link rel="prefetch" href="/assets/js/276.68ec5b00.js"><link rel="prefetch" href="/assets/js/277.6ffa406d.js"><link rel="prefetch" href="/assets/js/278.0ff21e49.js"><link rel="prefetch" href="/assets/js/279.2191e671.js"><link rel="prefetch" href="/assets/js/28.cad9d935.js"><link rel="prefetch" href="/assets/js/280.f2148359.js"><link rel="prefetch" href="/assets/js/281.6eac7840.js"><link rel="prefetch" href="/assets/js/282.db4e955e.js"><link rel="prefetch" href="/assets/js/283.c7316f32.js"><link rel="prefetch" href="/assets/js/284.52bee93a.js"><link rel="prefetch" href="/assets/js/285.1057f10e.js"><link rel="prefetch" href="/assets/js/286.56c851d3.js"><link rel="prefetch" href="/assets/js/287.bb1e5520.js"><link rel="prefetch" href="/assets/js/288.ec9a862c.js"><link rel="prefetch" href="/assets/js/289.fd4be2fa.js"><link rel="prefetch" href="/assets/js/29.eebe8dd7.js"><link rel="prefetch" href="/assets/js/290.045713dd.js"><link rel="prefetch" href="/assets/js/291.3acf96a8.js"><link rel="prefetch" href="/assets/js/292.0774f733.js"><link rel="prefetch" href="/assets/js/293.f081f948.js"><link rel="prefetch" href="/assets/js/294.38698e17.js"><link rel="prefetch" href="/assets/js/295.56ee9537.js"><link rel="prefetch" href="/assets/js/296.7937fe59.js"><link rel="prefetch" href="/assets/js/297.1e233583.js"><link rel="prefetch" href="/assets/js/298.3b5396ac.js"><link rel="prefetch" href="/assets/js/299.0c96c52e.js"><link rel="prefetch" href="/assets/js/30.2442b09c.js"><link rel="prefetch" href="/assets/js/300.6923629d.js"><link rel="prefetch" href="/assets/js/301.e5326a81.js"><link rel="prefetch" href="/assets/js/302.8e532232.js"><link rel="prefetch" href="/assets/js/303.34370493.js"><link rel="prefetch" href="/assets/js/304.9c18f126.js"><link rel="prefetch" href="/assets/js/305.93dd8679.js"><link rel="prefetch" href="/assets/js/306.d8fcbb6c.js"><link rel="prefetch" href="/assets/js/307.db140ace.js"><link rel="prefetch" href="/assets/js/308.24c0b2e7.js"><link rel="prefetch" href="/assets/js/309.4a6568b2.js"><link rel="prefetch" href="/assets/js/31.a4f77996.js"><link rel="prefetch" href="/assets/js/310.1005089a.js"><link rel="prefetch" href="/assets/js/311.f2bf5feb.js"><link rel="prefetch" href="/assets/js/312.b86dc6fb.js"><link rel="prefetch" href="/assets/js/313.cb3b9525.js"><link rel="prefetch" href="/assets/js/314.ce4f8ce1.js"><link rel="prefetch" href="/assets/js/315.3141d900.js"><link rel="prefetch" href="/assets/js/316.5d953850.js"><link rel="prefetch" href="/assets/js/317.face04e7.js"><link rel="prefetch" href="/assets/js/318.28ccba45.js"><link rel="prefetch" href="/assets/js/32.3b485b81.js"><link rel="prefetch" href="/assets/js/33.b57e1e3a.js"><link rel="prefetch" href="/assets/js/34.843ca6c5.js"><link rel="prefetch" href="/assets/js/35.ec2bc1a9.js"><link rel="prefetch" href="/assets/js/36.0186afea.js"><link rel="prefetch" href="/assets/js/37.d1bff54d.js"><link rel="prefetch" href="/assets/js/38.4a278ae7.js"><link rel="prefetch" href="/assets/js/39.08c30ec9.js"><link rel="prefetch" href="/assets/js/4.66e2f1d3.js"><link rel="prefetch" href="/assets/js/40.519d2489.js"><link rel="prefetch" href="/assets/js/41.75de2f57.js"><link rel="prefetch" href="/assets/js/42.77be8efd.js"><link rel="prefetch" href="/assets/js/43.e6cfd1d5.js"><link rel="prefetch" href="/assets/js/44.8dfecd74.js"><link rel="prefetch" href="/assets/js/45.5fcb1b89.js"><link rel="prefetch" href="/assets/js/46.fe7ac4b3.js"><link rel="prefetch" href="/assets/js/47.7b598e9b.js"><link rel="prefetch" href="/assets/js/48.1429110c.js"><link rel="prefetch" href="/assets/js/49.1d091e11.js"><link rel="prefetch" href="/assets/js/5.5605652f.js"><link rel="prefetch" href="/assets/js/50.5dab09aa.js"><link rel="prefetch" href="/assets/js/51.0ba804c0.js"><link rel="prefetch" href="/assets/js/52.aee20efb.js"><link rel="prefetch" href="/assets/js/53.4c96a9fb.js"><link rel="prefetch" href="/assets/js/54.cef039f3.js"><link rel="prefetch" href="/assets/js/55.2d23ee83.js"><link rel="prefetch" href="/assets/js/56.fbfe2ac4.js"><link rel="prefetch" href="/assets/js/57.1393a49f.js"><link rel="prefetch" href="/assets/js/58.eb182848.js"><link rel="prefetch" href="/assets/js/59.73d1bd9f.js"><link rel="prefetch" href="/assets/js/6.bd1962f8.js"><link rel="prefetch" href="/assets/js/60.5ac4bd62.js"><link rel="prefetch" href="/assets/js/61.c61115ef.js"><link rel="prefetch" href="/assets/js/62.3212e147.js"><link rel="prefetch" href="/assets/js/63.90a0e51d.js"><link rel="prefetch" href="/assets/js/64.6f26383a.js"><link rel="prefetch" href="/assets/js/65.e3d327f6.js"><link rel="prefetch" href="/assets/js/66.ddb170c5.js"><link rel="prefetch" href="/assets/js/67.50070127.js"><link rel="prefetch" href="/assets/js/68.a7230ff0.js"><link rel="prefetch" href="/assets/js/69.af01451b.js"><link rel="prefetch" href="/assets/js/70.30f2abec.js"><link rel="prefetch" href="/assets/js/71.25c147cc.js"><link rel="prefetch" href="/assets/js/72.df075c0e.js"><link rel="prefetch" href="/assets/js/73.9f7d323e.js"><link rel="prefetch" href="/assets/js/74.eb116f98.js"><link rel="prefetch" href="/assets/js/75.6dffe0d0.js"><link rel="prefetch" href="/assets/js/76.3e04a011.js"><link rel="prefetch" href="/assets/js/77.5907412c.js"><link rel="prefetch" href="/assets/js/78.5f20b015.js"><link rel="prefetch" href="/assets/js/79.723aaaa0.js"><link rel="prefetch" href="/assets/js/8.076f0d61.js"><link rel="prefetch" href="/assets/js/80.613d3c7f.js"><link rel="prefetch" href="/assets/js/81.ebddc18f.js"><link rel="prefetch" href="/assets/js/82.04453732.js"><link rel="prefetch" href="/assets/js/83.3a681cd5.js"><link rel="prefetch" href="/assets/js/84.5bc4749a.js"><link rel="prefetch" href="/assets/js/85.141c52a5.js"><link rel="prefetch" href="/assets/js/86.6f72e2bb.js"><link rel="prefetch" href="/assets/js/87.d20e49f7.js"><link rel="prefetch" href="/assets/js/88.e8e506ff.js"><link rel="prefetch" href="/assets/js/89.aad7bd16.js"><link rel="prefetch" href="/assets/js/9.49c8eb80.js"><link rel="prefetch" href="/assets/js/90.c4162bad.js"><link rel="prefetch" href="/assets/js/91.9fad1199.js"><link rel="prefetch" href="/assets/js/92.e8502c5f.js"><link rel="prefetch" href="/assets/js/93.4a01b95d.js"><link rel="prefetch" href="/assets/js/94.84926bec.js"><link rel="prefetch" href="/assets/js/95.df690749.js"><link rel="prefetch" href="/assets/js/96.aaa6659f.js"><link rel="prefetch" href="/assets/js/97.0aab7173.js"><link rel="prefetch" href="/assets/js/98.6028f6e6.js"><link rel="prefetch" href="/assets/js/99.02af9331.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.d18e2c74.js">
    <link rel="stylesheet" href="/assets/css/0.styles.477ae52b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/zh/" class="home-link router-link-active"><!----> <span class="site-name">山河社稷图</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/zh/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/zh/guide/" class="nav-link">
  指南
</a></div><div class="nav-item"><a href="/zh/interview/" class="nav-link">
  面试收集
</a></div><div class="nav-item"><a href="/zh/DevBasic/" class="nav-link">
  基础
</a></div><div class="nav-item"><a href="/zh/DevAdvance/" class="nav-link router-link-active">
  高级
</a></div><div class="nav-item"><a href="/zh/Frontend/" class="nav-link">
  前端
</a></div><div class="nav-item"><a href="/zh/DevOthers/" class="nav-link">
  开发杂谈
</a></div><div class="nav-item"><a href="/zh/article/" class="nav-link">
  文章
</a></div><div class="nav-item"><a href="/zh/about/" class="nav-link">
  关于
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/" class="nav-link">
  English
</a></li><li class="dropdown-item"><!----> <a href="/zh/DevAdvance/SpringBoot/SpringSecurity/SpringSecurity OAuth2.0认证授权.html" class="nav-link">
  简体中文
</a></li></ul></div></div> <a href="https://github.com/zhengxiaochuan" target="_blank" rel="noopener noreferrer" class="repo-link">
    官网
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/zh/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/zh/guide/" class="nav-link">
  指南
</a></div><div class="nav-item"><a href="/zh/interview/" class="nav-link">
  面试收集
</a></div><div class="nav-item"><a href="/zh/DevBasic/" class="nav-link">
  基础
</a></div><div class="nav-item"><a href="/zh/DevAdvance/" class="nav-link router-link-active">
  高级
</a></div><div class="nav-item"><a href="/zh/Frontend/" class="nav-link">
  前端
</a></div><div class="nav-item"><a href="/zh/DevOthers/" class="nav-link">
  开发杂谈
</a></div><div class="nav-item"><a href="/zh/article/" class="nav-link">
  文章
</a></div><div class="nav-item"><a href="/zh/about/" class="nav-link">
  关于
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/" class="nav-link">
  English
</a></li><li class="dropdown-item"><!----> <a href="/zh/DevAdvance/SpringBoot/SpringSecurity/SpringSecurity OAuth2.0认证授权.html" class="nav-link">
  简体中文
</a></li></ul></div></div> <a href="https://github.com/zhengxiaochuan" target="_blank" rel="noopener noreferrer" class="repo-link">
    官网
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>SpringBoot基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>SpringBoot整合</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>SpringSecurity</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/zh/DevAdvance/SpringBoot/SpringSecurity/01-SpringSecurity自定义基本使用及个性化登录配置.html" class="sidebar-link">01-SpringSecurity自定义基本使用及个性化登录配置</a></li><li><a href="/zh/DevAdvance/SpringBoot/SpringSecurity/02-SpringSecurity安全认证流程源码详解.html" class="sidebar-link">02-SpringSecurity安全认证流程源码详解</a></li><li><a href="/zh/DevAdvance/SpringBoot/SpringSecurity/03-SpringSecurity实现图片验证码认证.html" class="sidebar-link">03-SpringSecurity实现图片验证码认证</a></li><li><a href="/zh/DevAdvance/SpringBoot/SpringSecurity/04-SpringSecurity记住我功能实现.html" class="sidebar-link">04-SpringSecurity记住我功能实现</a></li><li><a href="/zh/DevAdvance/SpringBoot/SpringSecurity/05-实现短信验证码+登录功能.html" class="sidebar-link">05-实现短信验证码+登录功能</a></li><li><a href="/zh/DevAdvance/SpringBoot/SpringSecurity/SpringSecurity OAuth2.0认证授权.html" class="active sidebar-link">Spring Security OAuth2.0 认证授权</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zh/DevAdvance/SpringBoot/SpringSecurity/SpringSecurity OAuth2.0认证授权.html#_1-基本概念" class="sidebar-link">1. 基本概念</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zh/DevAdvance/SpringBoot/SpringSecurity/SpringSecurity OAuth2.0认证授权.html#_1-1-什么是认证" class="sidebar-link">1.1.什么是认证</a></li><li class="sidebar-sub-header"><a href="/zh/DevAdvance/SpringBoot/SpringSecurity/SpringSecurity OAuth2.0认证授权.html#_1-2-什么是会话" class="sidebar-link">1.2 什么是会话</a></li><li class="sidebar-sub-header"><a href="/zh/DevAdvance/SpringBoot/SpringSecurity/SpringSecurity OAuth2.0认证授权.html#_1-3-什么是授权" class="sidebar-link">1.3 什么是授权</a></li><li class="sidebar-sub-header"><a href="/zh/DevAdvance/SpringBoot/SpringSecurity/SpringSecurity OAuth2.0认证授权.html#_1-4-授权的数据模型" class="sidebar-link">1.4 授权的数据模型</a></li><li class="sidebar-sub-header"><a href="/zh/DevAdvance/SpringBoot/SpringSecurity/SpringSecurity OAuth2.0认证授权.html#_1-5-rbac" class="sidebar-link">1.5 RBAC</a></li></ul></li><li class="sidebar-sub-header"><a href="/zh/DevAdvance/SpringBoot/SpringSecurity/SpringSecurity OAuth2.0认证授权.html#_2-基于session的认证方式" class="sidebar-link">2.  基于Session的认证方式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zh/DevAdvance/SpringBoot/SpringSecurity/SpringSecurity OAuth2.0认证授权.html#_2-1-认证流程" class="sidebar-link">2.1 认证流程</a></li><li class="sidebar-sub-header"><a href="/zh/DevAdvance/SpringBoot/SpringSecurity/SpringSecurity OAuth2.0认证授权.html#_2-2-创建工程" class="sidebar-link">2.2.创建工程</a></li><li class="sidebar-sub-header"><a href="/zh/DevAdvance/SpringBoot/SpringSecurity/SpringSecurity OAuth2.0认证授权.html#_2-3-实现认证功能" class="sidebar-link">2.3.实现认证功能</a></li><li class="sidebar-sub-header"><a href="/zh/DevAdvance/SpringBoot/SpringSecurity/SpringSecurity OAuth2.0认证授权.html#_2-4-实现会话功能" class="sidebar-link">2.4.实现会话功能</a></li><li class="sidebar-sub-header"><a href="/zh/DevAdvance/SpringBoot/SpringSecurity/SpringSecurity OAuth2.0认证授权.html#_2-5-实现授权功能" class="sidebar-link">2.5.实现授权功能</a></li><li class="sidebar-sub-header"><a href="/zh/DevAdvance/SpringBoot/SpringSecurity/SpringSecurity OAuth2.0认证授权.html#_2-6-小结" class="sidebar-link">2.6.小结</a></li></ul></li><li class="sidebar-sub-header"><a href="/zh/DevAdvance/SpringBoot/SpringSecurity/SpringSecurity OAuth2.0认证授权.html#_3-spring-security-快速上手" class="sidebar-link">3. Spring Security 快速上手</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zh/DevAdvance/SpringBoot/SpringSecurity/SpringSecurity OAuth2.0认证授权.html#_3-1-spring-security介绍" class="sidebar-link">3.1 Spring Security介绍</a></li><li class="sidebar-sub-header"><a href="/zh/DevAdvance/SpringBoot/SpringSecurity/SpringSecurity OAuth2.0认证授权.html#_3-2-创建工程" class="sidebar-link">3.2 创建工程</a></li><li class="sidebar-sub-header"><a href="/zh/DevAdvance/SpringBoot/SpringSecurity/SpringSecurity OAuth2.0认证授权.html#_3-3-认证" class="sidebar-link">3.3 认证</a></li><li class="sidebar-sub-header"><a href="/zh/DevAdvance/SpringBoot/SpringSecurity/SpringSecurity OAuth2.0认证授权.html#_3-4-授权" class="sidebar-link">3.4 授权</a></li><li class="sidebar-sub-header"><a href="/zh/DevAdvance/SpringBoot/SpringSecurity/SpringSecurity OAuth2.0认证授权.html#_3-5-小结" class="sidebar-link">3.5 小结</a></li></ul></li><li class="sidebar-sub-header"><a href="/zh/DevAdvance/SpringBoot/SpringSecurity/SpringSecurity OAuth2.0认证授权.html#_4-spring-security-应用详解" class="sidebar-link">4. Spring Security  应用详解</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zh/DevAdvance/SpringBoot/SpringSecurity/SpringSecurity OAuth2.0认证授权.html#_4-1-集成springboot" class="sidebar-link">4.1 集成SpringBoot</a></li></ul></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>编程方法论</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>微服务</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Docker容器</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Kubernetes</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>解决方案</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="spring-security-oauth2-0-认证授权"><a href="#spring-security-oauth2-0-认证授权" class="header-anchor">#</a> Spring Security OAuth2.0 认证授权</h1> <h2 id="_1-基本概念"><a href="#_1-基本概念" class="header-anchor">#</a> 1. 基本概念</h2> <h3 id="_1-1-什么是认证"><a href="#_1-1-什么是认证" class="header-anchor">#</a> 1.1.什么是认证</h3> <p>进入移动互联网时代，大家每天都在刷手机，常用的软件有微信、支付宝、头条等，下边拿微信来举例子说明认证
相关的基本概念，在初次使用微信前需要注册成为微信用户，然后输入账号和密码即可登录微信，输入账号和密码
登录微信的过程就是认证。</p> <p>系统为什么要认证？
认证是为了保护系统的隐私数据与资源，用户的身份合法方可访问该系统的资源。</p> <p>**认证 ：**用户认证就是判断一个用户的身份是否合法的过程，用户去访问系统资源时系统要求验证用户的身份信
息，身份合法方可继续访问，不合法则拒绝访问。常见的用户身份认证方式有：用户名密码登录，二维码登录，手
机短信登录，指纹认证等方式。</p> <h3 id="_1-2-什么是会话"><a href="#_1-2-什么是会话" class="header-anchor">#</a> 1.2 什么是会话</h3> <p>用户认证通过后，为了避免用户的每次操作都进行认证可将用户的信息保证在会话中。会话就是系统为了保持当前
用户的登录状态所提供的机制，常见的有基于session方式、基于token方式等。</p> <p>基于session的认证方式如下图：</p> <p>它的交互流程是，用户认证成功后，在服务端生成用户相关的数据保存在session(当前会话)中，发给客户端的
sesssion_id 存放到 cookie 中，这样用户客户端请求时带上 session_id 就可以验证服务器端是否存在 session 数
据，以此完成用户的合法校验，当用户退出系统或session过期销毁时,客户端的session_id也就无效了。</p> <p><img src="/assets/img/conversation_session.de0de411.png" alt="image"></p> <p>基于token方式如下图：
它的交互流程是，用户认证成功后，服务端生成一个token发给客户端，客户端可以放到 cookie 或 localStorage
等存储中，每次请求时带上 token，服务端收到token通过验证后即可确认用户身份。</p> <p><img src="/assets/img/conversation_token.5b68fb30.png" alt="image"></p> <p>基于session的认证方式由Servlet规范定制，服务端要存储session信息需要占用内存资源，客户端需要支持
cookie；基于token的方式则一般不需要服务端存储token，并且不限制客户端的存储方式。如今移动互联网时代
更多类型的客户端需要接入系统，系统多是采用前后端分离的架构进行实现，所以基于token的方式更适合。</p> <h3 id="_1-3-什么是授权"><a href="#_1-3-什么是授权" class="header-anchor">#</a> 1.3 什么是授权</h3> <p>还拿微信来举例子，微信登录成功后用户即可使用微信的功能，比如，发红包、发朋友圈、添加好友等，没有绑定
银行卡的用户是无法发送红包的，绑定银行卡的用户才可以发红包，发红包功能、发朋友圈功能都是微信的资源即
功能资源，用户拥有发红包功能的权限才可以正常使用发送红包功能，拥有发朋友圈功能的权限才可以使用发朋友
圈功能，这个根据用户的权限来控制用户使用资源的过程就是授权。</p> <p>为什么要授权？</p> <p>认证是为了保证用户身份的合法性，授权则是为了更细粒度的对隐私数据进行划分，授权是在认证通过后发生的，
控制不同的用户能够访问不同的资源。</p> <p>**授权： **授权是用户认证通过根据用户的权限来控制用户访问资源的过程，拥有资源的访问权限则正常访问，没有
权限则拒绝访问。</p> <h3 id="_1-4-授权的数据模型"><a href="#_1-4-授权的数据模型" class="header-anchor">#</a> 1.4 授权的数据模型</h3> <p>如何进行授权即如何对用户访问资源进行控制，首先需要学习授权相关的数据模型。</p> <p>授权可简单理解为Who对What(which)进行How操作，包括如下：</p> <p>Who，即主体（Subject），主体一般是指用户，也可以是程序，需要访问系统中的资源。</p> <p>What，即资源（Resource），如系统菜单、页面、按钮、代码方法、系统商品信息、系统订单信息等。系统菜单、页面、按钮、代码方法都属于系统功能资源，对于web系统每个功能资源通常对应一个URL；系统商品信息、系统订单信息都属于实体资源（数据资源），实体资源由资源类型和资源实例组成，比如商品信息为资源类型，商品编号 为001的商品为资源实例。</p> <p>How，权限/许可（Permission），规定了用户对资源的操作许可，权限离开资源没有意义，
如用户查询权限、用户添加权限、某个代码方法的调用权限、编号为001的用户的修改权限等，通过权限可知用户
对哪些资源都有哪些操作许可。</p> <p>主体、资源、权限关系如下图：</p> <p><img src="/assets/img/Snipaste_2020-03-28_12-54-52.e0518b6f.jpg" alt="img"></p> <p>主体、资源、权限相关的数据模型如下：
主体（用户id、账号、密码、...）
资源（资源id、资源名称、访问地址、...）
权限（权限id、权限标识、权限名称、资源id、...）
角色（角色id、角色名称、...）</p> <p>角色和权限关系（角色 id、权限id、...）
主体（用户）和角色关系（用户id、角色id、...）</p> <p>主体（用户）、资源、权限关系如下图：</p> <p><img src="/assets/img/Snipaste_2020-03-28_12-58-13.481fcc22.jpg" alt="img"></p> <p>通常企业开发中将资源和权限表合并为一张权限表，如下：
资源（资源id、资源名称、访问地址、...）
权限（权限id、权限标识、权限名称、资源id、...）
合并为：
权限（权限id、权限标识、权限名称、资源名称、资源访问地址、...）</p> <p>修改后数据模型之间的关系如下图：</p> <p><img src="/assets/img/Snipaste_2020-03-28_12-59-27.251f8aa5.jpg" alt="img"></p> <h3 id="_1-5-rbac"><a href="#_1-5-rbac" class="header-anchor">#</a> 1.5 RBAC</h3> <p>如何实现授权？业界通常基于RBAC实现授权。</p> <h4 id="_1-5-1-基于角色的访问控制"><a href="#_1-5-1-基于角色的访问控制" class="header-anchor">#</a> 1.5.1  基于角色的访问控制</h4> <p>RBAC基于角色的访问控制（Role-Based Access Control）是按角色进行授权，比如：主体的角色为总经理可以查
询企业运营报表，查询员工工资信息等，访问控制流程如下：</p> <p><img src="/assets/img/Snipaste_2020-03-28_13-04-17.c635c614.jpg" alt="img"></p> <p>根据上图中的判断逻辑，授权代码可表示如下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>if(主体.hasRole(&quot;总经理角色id&quot;)){
    查询工资
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>如果上图中查询工资所需要的角色变化为总经理和部门经理，此时就需要修改判断逻辑为“判断用户的角色是否是
总经理或部门经理”，修改代码如下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>if(主体.hasRole(&quot;总经理角色id&quot;) ||  主体.hasRole(&quot;部门经理角色id&quot;)){
    查询工资
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>根据上边的例子发现，当需要修改角色的权限时就需要修改授权的相关代码，系统可扩展性差。</p> <h4 id="_1-5-2-基于资源的访问控制"><a href="#_1-5-2-基于资源的访问控制" class="header-anchor">#</a> 1.5.2 基于资源的访问控制</h4> <p>RBAC基于资源的访问控制（Resource-Based Access Control）是按资源（或权限）进行授权，比如：用户必须
具有查询工资权限才可以查询员工工资信息等，访问控制流程如下：</p> <p><img src="/assets/img/Snipaste_2020-03-28_13-05-33.b1fbf409.jpg" alt="img"></p> <p>根据上图中的判断，授权代码可以表示为：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>if(主体.hasPermission(&quot;查询工资权限标识&quot;)){
    查询工资
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>优点：系统设计时定义好查询工资的权限标识，即使查询工资所需要的角色变化为总经理和部门经理也不需要修改
授权代码，系统可扩展性强。</p> <h2 id="_2-基于session的认证方式"><a href="#_2-基于session的认证方式" class="header-anchor">#</a> 2.  基于Session的认证方式</h2> <h3 id="_2-1-认证流程"><a href="#_2-1-认证流程" class="header-anchor">#</a> 2.1 认证流程</h3> <p>基于Session认证方式的流程是，用户认证成功后，在服务端生成用户相关的数据保存在session(当前会话)，而发
给客户端的 sesssion_id 存放到 cookie 中，这样用客户端请求时带上 session_id 就可以验证服务器端是否存在
session 数据，以此完成用户的合法校验。当用户退出系统或session过期销毁时,客户端的session_id也就无效了。</p> <p>下图是session认证方式的流程图：</p> <p><img src="/assets/img/Snipaste_2020-03-28_13-07-18.8e9ff15c.jpg" alt="img"></p> <p>基于Session的认证机制由Servlet规范定制，Servlet容器已实现，用户通过HttpSession的操作方法即可实现，如
下是HttpSession相关的操作API。</p> <table><thead><tr><th>方法</th> <th>含义</th></tr></thead> <tbody><tr><td>HttpSession getSession(Boolean create)</td> <td>获取当前HttpSession对象</td></tr> <tr><td>void setAttribute(String name,Object value)</td> <td>向session中存放对象</td></tr> <tr><td>object getAttribute(String name)</td> <td>从session中获取对象</td></tr> <tr><td>void removeAttribute(String name);</td> <td>移除session中对象</td></tr> <tr><td>void invalidate()</td> <td>使HttpSession失效</td></tr> <tr><td>略...</td> <td></td></tr></tbody></table> <h3 id="_2-2-创建工程"><a href="#_2-2-创建工程" class="header-anchor">#</a> 2.2.创建工程</h3> <p>本案例工程使用maven进行构建，使用SpringMVC、Servlet3.0实现。</p> <h4 id="_2-2-1-创建maven工程"><a href="#_2-2-1-创建maven工程" class="header-anchor">#</a> 2.2.1 创建maven工程</h4> <p>创建maven工程 security-springmvc，工程结构如下：</p> <p><img src="/assets/img/Snipaste_2020-03-28_17-46-37.bdb78e87.jpg" alt="img"></p> <p>引入如下依赖如下，注意：
1、由于是web工程，packaging设置为war
2、使用tomcat7-maven-plugin插件来运行工程</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.jjane.security<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>security-springmvc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>packaging</span><span class="token punctuation">&gt;</span></span>war<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>packaging</span><span class="token punctuation">&gt;</span></span>


    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project.build.sourceEncoding</span><span class="token punctuation">&gt;</span></span>UTF‐8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project.build.sourceEncoding</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>


    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-webmvc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>5.1.14.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>javax.servlet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>javax.servlet-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.1.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>provided<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.18.12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>


    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>finalName</span><span class="token punctuation">&gt;</span></span>security‐springmvc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>finalName</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pluginManagement</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.tomcat.maven<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>tomcat7‐maven‐plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>

                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.maven.plugins<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>maven‐compiler‐plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>source</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>source</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>target</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>target</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>maven‐resources‐plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>encoding</span><span class="token punctuation">&gt;</span></span>utf‐8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>encoding</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>useDefaultDelimiters</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>useDefaultDelimiters</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resources</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resource</span><span class="token punctuation">&gt;</span></span>
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>directory</span><span class="token punctuation">&gt;</span></span>src/main/resources<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>directory</span><span class="token punctuation">&gt;</span></span>
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filtering</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filtering</span><span class="token punctuation">&gt;</span></span>
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>includes</span><span class="token punctuation">&gt;</span></span>
                                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span><span class="token punctuation">&gt;</span></span>**/*<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>include</span><span class="token punctuation">&gt;</span></span>
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>includes</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resource</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resource</span><span class="token punctuation">&gt;</span></span>
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>directory</span><span class="token punctuation">&gt;</span></span>src/main/java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>directory</span><span class="token punctuation">&gt;</span></span>
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>includes</span><span class="token punctuation">&gt;</span></span>
                                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span><span class="token punctuation">&gt;</span></span>**/*.xml<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>include</span><span class="token punctuation">&gt;</span></span>
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>includes</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resource</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resources</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pluginManagement</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br></div></div><h4 id="_2-2-2-spring-容器配置"><a href="#_2-2-2-spring-容器配置" class="header-anchor">#</a> 2.2.2 Spring  容器配置</h4> <p>在config包下定义<code>ApplicationConfig.java</code>，它对应web.xml中ContextLoaderListener的配置</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>jjane<span class="token punctuation">.</span>security<span class="token punctuation">.</span>springmvc<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">ComponentScan</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">Configuration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">FilterType</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype</span><span class="token punctuation">.</span><span class="token class-name">Controller</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * Spring 容器配置  【相当于applicationContext.xml】
 */</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span>basePackages <span class="token operator">=</span> <span class="token string">&quot;com.jjane.security.springmvc&quot;</span><span class="token punctuation">,</span> excludeFilters <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">.</span><span class="token class-name">Filter</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">FilterType</span><span class="token punctuation">.</span>ANNOTATION<span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token class-name">Controller</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ApplicationConfig</span> <span class="token punctuation">{</span>
    <span class="token comment">//在此配置除了Controller的其它bean，比如：数据库链接池、事务管理器、业务bean等</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h4 id="_2-2-3-servletcontext配置"><a href="#_2-2-3-servletcontext配置" class="header-anchor">#</a> 2.2.3 servletContext配置</h4> <p>本案例采用Servlet3.0无web.xml方式，在config包下定义<code>WebConfig.java</code>，它对应于DispatcherServlet配
置。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>jjane<span class="token punctuation">.</span>security<span class="token punctuation">.</span>springmvc<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">Bean</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">ComponentScan</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">Configuration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">FilterType</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype</span><span class="token punctuation">.</span><span class="token class-name">Controller</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>config<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">EnableWebMvc</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>config<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">WebMvcConfigurer</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>view</span><span class="token punctuation">.</span><span class="token class-name">InternalResourceViewResolver</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * SpringMVC的servletContext配置  【相当于springmvc.xml】
 */</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@EnableWebMvc</span>
<span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span>basePackages <span class="token operator">=</span> <span class="token string">&quot;com.jjane.security.springmvc&quot;</span><span class="token punctuation">,</span> includeFilters <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">.</span><span class="token class-name">Filter</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">FilterType</span><span class="token punctuation">.</span>ANNOTATION<span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token class-name">Controller</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebConfig</span> <span class="token keyword">implements</span> <span class="token class-name">WebMvcConfigurer</span> <span class="token punctuation">{</span>

    <span class="token comment">/**
     * 视图解析器
     *
     * @return
     */</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">InternalResourceViewResolver</span> <span class="token function">viewResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">InternalResourceViewResolver</span> viewResolver <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InternalResourceViewResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        viewResolver<span class="token punctuation">.</span><span class="token function">setPrefix</span><span class="token punctuation">(</span><span class="token string">&quot;/WEB‐INF/views/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        viewResolver<span class="token punctuation">.</span><span class="token function">setSuffix</span><span class="token punctuation">(</span><span class="token string">&quot;.jsp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> viewResolver<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><h4 id="_2-2-4-加载-spring容器"><a href="#_2-2-4-加载-spring容器" class="header-anchor">#</a> 2.2.4 加载 Spring容器</h4> <p>在init包下定义Spring容器初始化类<code>SpringApplicationInitializer</code>，此类实现WebApplicationInitializer接口，Spring容器启动时加载WebApplicationInitializer接口的所有实现类。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>jjane<span class="token punctuation">.</span>security<span class="token punctuation">.</span>springmvc<span class="token punctuation">.</span>init</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>jjane<span class="token punctuation">.</span>security<span class="token punctuation">.</span>springmvc<span class="token punctuation">.</span>config</span><span class="token punctuation">.</span><span class="token class-name">ApplicationConfig</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>jjane<span class="token punctuation">.</span>security<span class="token punctuation">.</span>springmvc<span class="token punctuation">.</span>config</span><span class="token punctuation">.</span><span class="token class-name">WebConfig</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>support</span><span class="token punctuation">.</span><span class="token class-name">AbstractAnnotationConfigDispatcherServletInitializer</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 容器启动类
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringApplicationInitializer</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractAnnotationConfigDispatcherServletInitializer</span> <span class="token punctuation">{</span>

    <span class="token comment">/**
     * 加载Spring容器，相当于加载applicationContext.xml
     *
     * @return
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getRootConfigClasses</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token class-name">ApplicationConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 加载SpringMvc的servletContext容器，相当于加载springmvc.xml
     *
     * @return
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getServletConfigClasses</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token class-name">WebConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * url-mapping 配置
     *
     * @return
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getServletMappings</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div></div><p>SpringApplicationInitializer相当于web.xml，使用了servlet3.0开发则不需要再定义web.xml。
ApplicationConfig.class对应以下配置的application-context.xml，WebConfig.class对应以下配置的spring-
mvc.xml，web.xml的内容参考：</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>web‐app</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>listener</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>listener‐class</span><span class="token punctuation">&gt;</span></span>org.springframework.web.context.ContextLoaderListener<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>listener‐class</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>listener</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>context‐param</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param‐name</span><span class="token punctuation">&gt;</span></span>contextConfigLocation<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param‐name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param‐value</span><span class="token punctuation">&gt;</span></span>/WEB‐INF/application‐context.xml<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param‐value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>context‐param</span><span class="token punctuation">&gt;</span></span>
 
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet‐name</span><span class="token punctuation">&gt;</span></span>springmvc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet‐name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet‐class</span><span class="token punctuation">&gt;</span></span>org.springframework.web.servlet.DispatcherServlet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet‐class</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>init‐param</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param‐name</span><span class="token punctuation">&gt;</span></span>contextConfigLocation<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param‐name</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param‐value</span><span class="token punctuation">&gt;</span></span>/WEB‐INF/spring‐mvc.xml<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param‐value</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>init‐param</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>load‐on‐startup</span><span class="token punctuation">&gt;</span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>load‐on‐startup</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet‐mapping</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet‐name</span><span class="token punctuation">&gt;</span></span>springmvc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet‐name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url‐pattern</span><span class="token punctuation">&gt;</span></span>/<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url‐pattern</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet‐mapping</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>web‐app</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h3 id="_2-3-实现认证功能"><a href="#_2-3-实现认证功能" class="header-anchor">#</a> 2.3.实现认证功能</h3> <h4 id="_2-3-1-认证页面"><a href="#_2-3-1-认证页面" class="header-anchor">#</a> 2.3.1  认证页面</h4> <p>在webapp/WEB-INF/views下定义认证页面login.jsp。本案例只是测试认证流程，页面没有添加css样式，页面实
现可填入用户名，密码，触发登录将提交表单信息至/login。</p> <p><code>login.jsp</code> 文件内容如下：</p> <div class="language-jsp line-numbers-mode"><pre class="language-text"><code>&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;用户登录&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;form action=&quot;login&quot;  method=&quot;post&quot;&gt;
        用户名：&lt;input type=&quot;text&quot;  name=&quot;username&quot;&gt;&lt;br&gt;
        密&amp;nbsp;&amp;nbsp;&amp;nbsp;码:
        &lt;input type=&quot;password&quot;  name=&quot;password&quot;&gt;&lt;br&gt;
        &lt;input type=&quot;submit&quot;  value=&quot;登录&quot;&gt;
&lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>在 WebConfig 中新增如下配置，将 / 直接导向login.jsp页面：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addViewControllers</span><span class="token punctuation">(</span><span class="token class-name">ViewControllerRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    registry<span class="token punctuation">.</span><span class="token function">addViewController</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setViewName</span><span class="token punctuation">(</span><span class="token string">&quot;login&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>启动项目，访问/路径地址，进行测试</p> <p><img src="data:image/jpeg;base64,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v93W9ultz3Tz/pR5/wBK+LJfg7dCR9vwM8UOMnDf8LPmGffH2msPSvD+p+Bv2hvhQieCde8C2t9e3cU5vfGMurx3YFnOwQxmZwMEBskfw1pSh7Wajte/4Jv9BSfLFy7H3f5/0rGt5N/xK0//ALBdx/6Miqx59Zumyb/iZYf9gu4/9GRVmM9BooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACvNb+TZ8RNeGf+XW0/9q16VXlesybPiRrw/wCnS0/9q0AaVysV5bywTKHilQo6nupGCK+SfjE+o+APjBZabbN490TwLc6ZDHZReBEiAlvjJL5gkMgOW2mOvqeaV3idUfy3KkK+M7T2OO9eC/EX9n3xr8TtKk03WfiuzWfnefB5fhy1WW3cHKtHIGyrD+8Oai3vxf3+m34XuvM0jJKMk+qt6bP8bWfkeS/E7xxN4N8I3102sfHzT76SJ0sm1NLUQvNtJUMAuSODnHYGvadI+DHhbx38GdO1LU9N0+LxBq+j2s91qOoLIYzc+ShEkkayIDhsEgFc1jeIf2bfGfizxFomtav8WDqF3owY2SXHhq1eKNzx5mwtjeBkBuoBPrXap8H9R8T6dJp3xD8WSeONNMgcWLafHZQOBjKypGSJVOPutxzWj1puLSu3+C/q/TZepm21KLXRfj/krfiz5Y+Ingz4fR/DDxbotho2m6j4x0tFRvEHh5rhbeJ/MUAyo0h8otk4UM+cNyMV1Gn/AAX8PeIPFuk+EIvhnoGm6rpaxPqeuaxcznzRgbmtYd43+YMjdvGzd0bHPt3i74DXfiLT4vDmn+KU8O+AEWNP+EZ07SIUQIrbtqyghlBOOg7V3vjHwBoHju0totXskmmtCWs7xDsuLRypXfDIPmRsEjcOeatSUUpLV31v6K22i1u7bPZhP3korS19fVr8kt+nQ6nRdPtNA0q106xhW2tLaMRxwqSQgHYE80uhyb/idY/9gq4/9GxVn6RZpo2mW1kk9xcpAgQTXczTSv7s7csfc1P4Zk3/ABRsv+wVcf8Ao2Gobu2yYqySPU6KKKRQUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFefeKPAWs3/AIoutW0q9sYluYYopI7yN2I2bsEbSP7xr0GigDy7/hAvF/8A0ENE/wC/M3/xVH/CBeL/APoIaJ/35m/+Kr1GigDy7/hAvF//AEENE/78zf8AxVH/AAgXi/8A6CGif9+Zv/iq9RooA8u/4QLxf/0ENE/78zf/ABVH/CBeL/8AoIaJ/wB+Zv8A4qvUaKAPLv8AhAvF/wD0ENE/78zf/FVp+EfAer6V4oXWNVvLKYx2r2yR2cbr95lYk7if7n6131FABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAf/9k=" alt="img"></p> <h4 id="_2-3-2-认证接口"><a href="#_2-3-2-认证接口" class="header-anchor">#</a> 2.3.2 认证接口</h4> <p>用户进入认证页面，输入账号和密码，点击登录，请求/login进行身份认证。</p> <p>（1）定义认证接口，此接口用于对传来的用户名、密码校验，若成功则返回该用户的详细信息，否则抛出错误异
常：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>jjane<span class="token punctuation">.</span>security<span class="token punctuation">.</span>springmvc<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>jjane<span class="token punctuation">.</span>security<span class="token punctuation">.</span>springmvc<span class="token punctuation">.</span>model</span><span class="token punctuation">.</span><span class="token class-name">AuthenticationRequest</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>jjane<span class="token punctuation">.</span>security<span class="token punctuation">.</span>springmvc<span class="token punctuation">.</span>model</span><span class="token punctuation">.</span><span class="token class-name">UserDto</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 认证服务
 */</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">AuthenticationService</span> <span class="token punctuation">{</span>

    <span class="token comment">/**
     * 用户认证
     *
     * @param authenticationRequest 用户认证请求
     * @return 认证成功的用户信息      
     */</span>
    <span class="token class-name">UserDto</span> <span class="token function">authentication</span><span class="token punctuation">(</span><span class="token class-name">AuthenticationRequest</span> authenticationRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>认证请求结构：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>jjane<span class="token punctuation">.</span>security<span class="token punctuation">.</span>springmvc<span class="token punctuation">.</span>model</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> lombok<span class="token punctuation">.</span><span class="token class-name">Data</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 登录认证请求
 */</span>
<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AuthenticationRequest</span> <span class="token punctuation">{</span>

    <span class="token comment">/**
     * 用户名
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 密码
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>认证成功后返回的用户详细信息，也就是当前登录用户的信息：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>jjane<span class="token punctuation">.</span>security<span class="token punctuation">.</span>springmvc<span class="token punctuation">.</span>model</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> lombok<span class="token punctuation">.</span><span class="token class-name">AllArgsConstructor</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> lombok<span class="token punctuation">.</span><span class="token class-name">Data</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 登录用户信息
 */</span>
<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserDto</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> id<span class="token punctuation">;</span>

    <span class="token comment">/** 用户名 */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span>

    <span class="token comment">/** 密码 */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span>

    <span class="token comment">/** 全名 */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> fullname<span class="token punctuation">;</span>
    
    <span class="token comment">/** 手机号 */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> mobile<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p>（2）认证实现类，根据用户名查找用户信息，并校验密码，这里模拟了两个用户：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>jjane<span class="token punctuation">.</span>security<span class="token punctuation">.</span>springmvc<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>jjane<span class="token punctuation">.</span>security<span class="token punctuation">.</span>springmvc<span class="token punctuation">.</span>model</span><span class="token punctuation">.</span><span class="token class-name">AuthenticationRequest</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>jjane<span class="token punctuation">.</span>security<span class="token punctuation">.</span>springmvc<span class="token punctuation">.</span>model</span><span class="token punctuation">.</span><span class="token class-name">UserDto</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>jjane<span class="token punctuation">.</span>security<span class="token punctuation">.</span>springmvc<span class="token punctuation">.</span>service</span><span class="token punctuation">.</span><span class="token class-name">AuthenticationService</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype</span><span class="token punctuation">.</span><span class="token class-name">Service</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>util</span><span class="token punctuation">.</span><span class="token class-name">StringUtils</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util</span><span class="token punctuation">.</span><span class="token class-name">HashMap</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util</span><span class="token punctuation">.</span><span class="token class-name">Map</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 认证实现类
 */</span>
<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AuthenticationServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">AuthenticationService</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">UserDto</span> <span class="token function">authentication</span><span class="token punctuation">(</span><span class="token class-name">AuthenticationRequest</span> authenticationRequest<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//校验参数是否为空</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>authenticationRequest <span class="token operator">==</span> <span class="token keyword">null</span>
                <span class="token operator">||</span> <span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>authenticationRequest<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token operator">||</span> <span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>authenticationRequest<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;账号和密码为空&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//根据账号去查询数据库,这里测试程序采用模拟方法</span>
        <span class="token class-name">UserDto</span> user <span class="token operator">=</span> <span class="token function">getUserDto</span><span class="token punctuation">(</span>authenticationRequest<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//判断用户是否为空</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>user <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;查询不到该用户&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//校验密码</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>authenticationRequest<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;账号或密码错误&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//认证通过，返回用户身份信息</span>
        <span class="token keyword">return</span> user<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token comment">//模拟用户查询</span>
    <span class="token keyword">public</span> <span class="token class-name">UserDto</span> <span class="token function">getUserDto</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> userMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//用户信息</span>
    <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">UserDto</span><span class="token punctuation">&gt;</span></span> userMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">{</span>
        userMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;zhangsan&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">UserDto</span><span class="token punctuation">(</span><span class="token string">&quot;1010&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;zhangsan&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;123&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;张三&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;133443&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        userMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;lisi&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">UserDto</span><span class="token punctuation">(</span><span class="token string">&quot;1011&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;lisi&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;456&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;李四&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;144553&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br></div></div><p>（ 3）登录Controller，对/login请求处理，它调用AuthenticationService完成认证并返回登录结果提示信息：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>jjane<span class="token punctuation">.</span>security<span class="token punctuation">.</span>springmvc<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>jjane<span class="token punctuation">.</span>security<span class="token punctuation">.</span>springmvc<span class="token punctuation">.</span>model</span><span class="token punctuation">.</span><span class="token class-name">AuthenticationRequest</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>jjane<span class="token punctuation">.</span>security<span class="token punctuation">.</span>springmvc<span class="token punctuation">.</span>model</span><span class="token punctuation">.</span><span class="token class-name">UserDto</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>jjane<span class="token punctuation">.</span>security<span class="token punctuation">.</span>springmvc<span class="token punctuation">.</span>service</span><span class="token punctuation">.</span><span class="token class-name">AuthenticationService</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">GetMapping</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">RequestMapping</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">RestController</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http</span><span class="token punctuation">.</span><span class="token class-name">HttpSession</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 登录Controller
 *
 * @author RyuZheng
 * @version 1.0
 **/</span>
<span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LoginController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">AuthenticationService</span> authenticationService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/login&quot;</span><span class="token punctuation">,</span> produces <span class="token operator">=</span> <span class="token string">&quot;text/plain;charset=utf-8&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token class-name">AuthenticationRequest</span> authenticationRequest<span class="token punctuation">,</span> <span class="token class-name">HttpSession</span> session<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">UserDto</span> userDto <span class="token operator">=</span> authenticationService<span class="token punctuation">.</span><span class="token function">authentication</span><span class="token punctuation">(</span>authenticationRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//存入session</span>
        session<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token class-name">UserDto</span><span class="token punctuation">.</span>SESSION_USER_KEY<span class="token punctuation">,</span> userDto<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> userDto<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;登录成功&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/logout&quot;</span><span class="token punctuation">,</span> produces <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;text/plain;charset=UTF-8&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">logout</span><span class="token punctuation">(</span><span class="token class-name">HttpSession</span> session<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        session<span class="token punctuation">.</span><span class="token function">invalidate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">&quot;退出成功&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/r/r1&quot;</span><span class="token punctuation">,</span> produces <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;text/plain;charset=UTF-8&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">r1</span><span class="token punctuation">(</span><span class="token class-name">HttpSession</span> session<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> fullname <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token class-name">Object</span> object <span class="token operator">=</span> session<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token class-name">UserDto</span><span class="token punctuation">.</span>SESSION_USER_KEY<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>object <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            fullname <span class="token operator">=</span> <span class="token string">&quot;匿名&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token class-name">UserDto</span> userDto <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">UserDto</span><span class="token punctuation">)</span> object<span class="token punctuation">;</span>
            fullname <span class="token operator">=</span> userDto<span class="token punctuation">.</span><span class="token function">getFullname</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> fullname <span class="token operator">+</span> <span class="token string">&quot;访问资源r1&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/r/r2&quot;</span><span class="token punctuation">,</span> produces <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;text/plain;charset=UTF-8&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">r2</span><span class="token punctuation">(</span><span class="token class-name">HttpSession</span> session<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> fullname <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token class-name">Object</span> userObj <span class="token operator">=</span> session<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token class-name">UserDto</span><span class="token punctuation">.</span>SESSION_USER_KEY<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>userObj <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            fullname <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">UserDto</span><span class="token punctuation">)</span> userObj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getFullname</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            fullname <span class="token operator">=</span> <span class="token string">&quot;匿名&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> fullname <span class="token operator">+</span> <span class="token string">&quot; 访问资源2&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br></div></div><p>（4）测试
启动项目，访问/路径地址，进行测试</p> <p><img src="data:image/jpeg;base64,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beKdJsrSz02W30nxVrp1WaEubjc6yebIAG2rwG/hrxzxB4V8F+NPFHw6l8C6LfS2U9zcnUIrfWr6e01KOKHeyQTCb5yMEAr0YEHOK9L+B/wp8LeMfHMnizSPAcHhzQrVvKWe61q9m1G5mU/KXQzARhMt8jq2d4wRznppe7zKXVP7k1r96sv0WpjVVopdXZr73p+GvkfYfn1D8N233Xik/wDUU/8AaEVVvPFSfC5t8vik/wDUVP8A6IirnLO6ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAK8Y8JTY0dhn/l7uv/R8lez15TB8NfE2m+dDZXuktamaWVDOsu/Duz4OOP4qAKPim31fVNEnt9E1ePQ9SfHl30loLpY/+2ZZQfzrxLU/2fviFqnjfS/Fr/Fm1h1zT0eJJ4PC0SebGykFJB5/zKM5A9QDXv8A/wAIJ4w/5+9E/wC+JqP+EE8Yf8/eif8AfE1C0fMt/wCl+Q27qx896T+zn470jxrqvixPinZXGv6jtWS8ufCkUjRoo4jjzP8AKo5OB3Y+tdzN8EdP8UvY3vj27j8a6xZrmCW5tRFaxSAgrIluGYK4x1z3Nel/8IJ4w/5+9E/74mo/4QTxh/z96J/3xNRtby28vTsJ6u7PLNH+EevH4haV4l8ReMo9ag0cznTtOtdJSyWHzVKHcyyNvwpx0HTNdLq3wv0LU/EqeIIBc6RrWU8690uYwSXKLnbHKQPmT5jxXXf8IJ4w/wCfvRP++JqP+EE8Yf8AP3on/fE1O793y2++4mr3v1JPP96v/CV97eKT/wBRU/8AoiKsz/hBPGH/AD96J/3xNXT/AA+8J3nhWz1EX08E91e3RuX+zghF+RVwM8/w/rSGdXRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAf//Z" alt="img"></p> <p>填入错误的用户信息，页面返回错误信息：</p> <p><img src="/assets/img/Snipaste_2020-03-28_17-38-15.a9067b31.jpg" alt="img"></p> <p>填入正确的用户信息，页面提示登录成功：</p> <p><img src="data:image/jpeg;base64,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" alt="img"></p> <p>以上的测试全部符合预期，到目前为止最基础的认证功能已经完成，它仅仅实现了对用户身份凭证的校验，若某用
户认证成功，只能说明他是该系统的一个合法用户，仅此而已。</p> <h3 id="_2-4-实现会话功能"><a href="#_2-4-实现会话功能" class="header-anchor">#</a> 2.4.实现会话功能</h3> <p>会话是指用户登入系统后，系统会记住该用户的登录状态，他可以在系统连续操作直到退出系统的过程。</p> <p>认证的目的是对系统资源的保护，每次对资源的访问，系统必须得知道是谁在访问资源，才能对该请求进行合法性
拦截。因此，在认证成功后，一般会把认证成功的用户信息放入Session中，在后续的请求中，系统能够从Session中获取到当前用户，用这样的方式来实现会话机制。</p> <p>（1）增加会话控制
首先在UserDto中定义一个SESSION_USER_KEY，作为Session中存放登录用户信息的key。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> SESSION_USER_KEY <span class="token operator">=</span> <span class="token string">&quot;_user&quot;</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>然后修改LoginController，认证成功后，将用户信息放入当前会话。并增加用户登出方法，登出时将session置为
失效。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * 用户登录
 * @param authenticationRequest 登录请求
 * @param session http会话
 * @return
 */</span>
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/login&quot;</span><span class="token punctuation">,</span>produces <span class="token operator">=</span> <span class="token string">&quot;text/plain;charset=utf‐8&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token class-name">AuthenticationRequest</span> authenticationRequest<span class="token punctuation">,</span> <span class="token class-name">HttpSession</span> session<span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token class-name">UserDto</span> userDto <span class="token operator">=</span> authenticationService<span class="token punctuation">.</span><span class="token function">authentication</span><span class="token punctuation">(</span>authenticationRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//用户信息存入session</span>
      session<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token class-name">UserDto</span><span class="token punctuation">.</span>SESSION_USER_KEY<span class="token punctuation">,</span>userDto<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> userDto<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;登录成功&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;logout&quot;</span><span class="token punctuation">,</span>produces <span class="token operator">=</span> <span class="token string">&quot;text/plain;charset=utf‐8&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">logout</span><span class="token punctuation">(</span><span class="token class-name">HttpSession</span> session<span class="token punctuation">)</span><span class="token punctuation">{</span>
     session<span class="token punctuation">.</span><span class="token function">invalidate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">return</span> <span class="token string">&quot;退出成功&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>（2）增加测试资源
修改LoginController，增加测试资源1，它从当前会话session中获取当前登录用户，并返回提示信息给前台。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * 测试资源1
 *
 * @return
 * @param session
 */</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/r/r1&quot;</span><span class="token punctuation">,</span> produces <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;text/plain;charset=UTF-8&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">r1</span><span class="token punctuation">(</span><span class="token class-name">HttpSession</span> session<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> fullname <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token class-name">Object</span> object <span class="token operator">=</span> session<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token class-name">UserDto</span><span class="token punctuation">.</span>SESSION_USER_KEY<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>object <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        fullname <span class="token operator">=</span> <span class="token string">&quot;匿名&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token class-name">UserDto</span> userDto <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">UserDto</span><span class="token punctuation">)</span> object<span class="token punctuation">;</span>
        fullname <span class="token operator">=</span> userDto<span class="token punctuation">.</span><span class="token function">getFullname</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> fullname <span class="token operator">+</span> <span class="token string">&quot;访问资源r1&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>（3）测试
未登录情况下直接访问测试资源/r/r1：</p> <p><img src="data:image/jpeg;base64,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" alt="img"></p> <p>成功登录的情况下访问测试资源/r/r1：</p> <p><img src="data:image/jpeg;base64,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" alt="img"></p> <p>测试结果说明，在用户登录成功时，该用户信息已被成功放入session，并且后续请求可以正常从session中获取当
前登录用户信息，符合预期结果。</p> <h3 id="_2-5-实现授权功能"><a href="#_2-5-实现授权功能" class="header-anchor">#</a> 2.5.实现授权功能</h3> <p>现在我们已经完成了用户身份凭证的校验以及登录的状态保持，并且我们也知道了如何获取当前登录用户(从
Session中获取)的信息，接下来，用户访问系统需要经过授权，即需要完成如下功能：</p> <ul><li><p>匿名用户（未登录用户）访问拦截：禁止匿名用户访问某些资源。</p></li> <li><p>登录用户访问拦截：根据用户的权限决定是否能访问某些资源。</p></li></ul> <p>（1）增加权限数据
为了实现这样的功能，我们需要在UserDto里增加权限属性，用于表示该登录用户所拥有的权限，同时修改
UserDto的构造方法。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserDto</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> SESSION_USER_KEY <span class="token operator">=</span> <span class="token string">&quot;_user&quot;</span><span class="token punctuation">;</span>
    
    <span class="token keyword">private</span> <span class="token class-name">String</span> id<span class="token punctuation">;</span>
    
    <span class="token comment">/** 用户名 */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span>

    <span class="token comment">/** 密码 */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span>

    <span class="token comment">/** 全名 */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> fullname<span class="token punctuation">;</span>
    
    <span class="token comment">/**
     * 用户权限
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> authorities<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>并在AuthenticationServiceImpl中为模拟用户初始化权限，其中张三给了p1权限，李四给了p2权限。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//用户信息</span>
    <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">UserDto</span><span class="token punctuation">&gt;</span></span> userMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">{</span>
        <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> authorities1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        authorities1<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;p1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//这个p1我们人为让它和/r/r1对应</span>
        <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> authorities2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        authorities2<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;p2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//这个p2我们人为让它和/r/r2对应</span>
        userMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;zhangsan&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">UserDto</span><span class="token punctuation">(</span><span class="token string">&quot;1010&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;zhangsan&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;123&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;张三&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;133443&quot;</span><span class="token punctuation">,</span> authorities1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        userMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;lisi&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">UserDto</span><span class="token punctuation">(</span><span class="token string">&quot;1011&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;lisi&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;456&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;李四&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;144553&quot;</span><span class="token punctuation">,</span> authorities2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>（2）增加测试资源
我们想实现针对不同的用户能访问不同的资源，前提是得有多个资源，因此在LoginController中增加测试资源2。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * 测试资源2
 * @param session
 * @return
 */</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/r/r2&quot;</span><span class="token punctuation">,</span>produces <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;text/plain;charset=UTF‐8&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">r2</span><span class="token punctuation">(</span><span class="token class-name">HttpSession</span> session<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">String</span> fullname <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token class-name">Object</span> userObj <span class="token operator">=</span> session<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token class-name">UserDto</span><span class="token punctuation">.</span>SESSION_USER_KEY<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>userObj <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        fullname <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">UserDto</span><span class="token punctuation">)</span>userObj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getFullname</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
        fullname <span class="token operator">=</span> <span class="token string">&quot;匿名&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> fullname <span class="token operator">+</span> <span class="token string">&quot; 访问资源2&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>（3）实现授权拦截器
在interceptor包下定义SimpleAuthenticationInterceptor拦截器，实现授权拦截：
1、校验用户是否登录
2、校验用户是否拥有操作权限</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * 授权拦截器
 *
 * @author RyuZheng
 * @version 1.0
 **/</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SimpleAuthenticationInterceptor</span> <span class="token keyword">implements</span> <span class="token class-name">HandlerInterceptor</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">preHandle</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">Object</span> handler<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">//在这个方法中校验用户请求的url是否在用户的权限范围内</span>
        <span class="token comment">//取出用户身份信息</span>
        <span class="token class-name">Object</span> object <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token class-name">UserDto</span><span class="token punctuation">.</span>SESSION_USER_KEY<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>object <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">//没有认证，提示登录</span>
            <span class="token function">writeContent</span><span class="token punctuation">(</span>response<span class="token punctuation">,</span><span class="token string">&quot;请登录&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">UserDto</span> userDto <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">UserDto</span><span class="token punctuation">)</span> object<span class="token punctuation">;</span>
        <span class="token comment">//请求的url</span>
        <span class="token class-name">String</span> requestURI <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getRequestURI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span> userDto<span class="token punctuation">.</span><span class="token function">getAuthorities</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">&quot;p1&quot;</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> requestURI<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">&quot;/r/r1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span> userDto<span class="token punctuation">.</span><span class="token function">getAuthorities</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">&quot;p2&quot;</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> requestURI<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">&quot;/r/r2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">writeContent</span><span class="token punctuation">(</span>response<span class="token punctuation">,</span><span class="token string">&quot;没有权限，拒绝访问&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//响应信息给客户端</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">writeContent</span><span class="token punctuation">(</span><span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">String</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">&quot;text/html;charset=utf-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">PrintWriter</span> writer <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        writer<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        writer<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><p>在 WebConfig中配置拦截器，匹配/r/**的资源为受保护的系统资源，访问该资源的请求进入SimpleAuthenticationInterceptor拦截器。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Autowired</span>
<span class="token class-name">SimpleAuthenticationInterceptor</span> simpleAuthenticationInterceptor<span class="token punctuation">;</span>

<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addInterceptors</span><span class="token punctuation">(</span><span class="token class-name">InterceptorRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>            registry<span class="token punctuation">.</span><span class="token function">addInterceptor</span><span class="token punctuation">(</span>simpleAuthenticationInterceptor<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addPathPatterns</span><span class="token punctuation">(</span><span class="token string">&quot;/r/**&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>（4）测试
未登录情况下，/r/r1与/r/r2均提示 “请先登录”。
张三登录情况下，由于张三有p1权限，因此可以访问/r/r1，张三没有p2权限，访问/r/r2时提示 “权限不足 “。
李四登录情况下，由于李四有p2权限，因此可以访问/r/r2，李四没有p1权限，访问/r/r1时提示 “权限不足 “。
测试结果全部符合预期结果。</p> <h3 id="_2-6-小结"><a href="#_2-6-小结" class="header-anchor">#</a> 2.6.小结</h3> <p>基于Session的认证方式是一种常见的认证方式，至今还有非常多的系统在使用。我们在此小节使用Spring mvc技
术对它进行简单实现，旨在让大家更清晰实在的了解用户认证、授权以及会话的功能意义及实现套路，也就是它们
分别干了哪些事儿？大概需要怎么做？</p> <p>而在正式生产项目中，我们往往会考虑使用第三方安全框架（如 spring security，shiro等安全框架）来实现认证
授权功能，因为这样做能一定程度提高生产力，提高软件标准化程度，另外往往这些框架的可扩展性考虑的非常全
面。但是缺点也非常明显，这些通用化组件为了提高支持范围会增加很多可能我们不需要的功能，结构上也会比较
抽象，如果我们不够了解它，一旦出现问题，将会很难定位。</p> <h2 id="_3-spring-security-快速上手"><a href="#_3-spring-security-快速上手" class="header-anchor">#</a> 3. Spring Security 快速上手</h2> <h3 id="_3-1-spring-security介绍"><a href="#_3-1-spring-security介绍" class="header-anchor">#</a> 3.1 Spring Security介绍</h3> <p>Spring Security是一个能够为基于Spring的企业应用系统提供声明式的安全访问控制解决方案的安全框架。由于它
是Spring生态系统中的一员，因此它伴随着整个Spring生态系统不断修正、升级，在spring boot项目中加入spring security更是十分简单，使用Spring Security 减少了为企业系统安全控制编写大量重复代码的工作。</p> <h3 id="_3-2-创建工程"><a href="#_3-2-创建工程" class="header-anchor">#</a> 3.2 创建工程</h3> <h4 id="_3-2-1-创建maven工程"><a href="#_3-2-1-创建maven工程" class="header-anchor">#</a> 3.2.1 创建maven工程</h4> <p>创建maven工程 security-spring-security，工程结构如下：</p> <p><img src="/assets/img/Snipaste_2020-03-29_17-11-24.d7be212b.jpg" alt="img"></p> <p>引入以下依赖：
在security-springmvc的基础上增加spring-security的依赖：</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.security<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-security-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>5.1.4.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.security<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-security-config<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>5.1.4.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h4 id="_3-2-2-spring容器配置"><a href="#_3-2-2-spring容器配置" class="header-anchor">#</a> 3.2.2 Spring容器配置</h4> <p>同security-springmvc.</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * Spring 容器配置  【相当于applicationContext.xml】
 *
 * @author RyuZheng
 * @version 1.0
 **/</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span>basePackages <span class="token operator">=</span> <span class="token string">&quot;com.jjane.security.springmvc&quot;</span><span class="token punctuation">,</span> excludeFilters <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">.</span><span class="token class-name">Filter</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">FilterType</span><span class="token punctuation">.</span>ANNOTATION<span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token class-name">Controller</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ApplicationConfig</span> <span class="token punctuation">{</span>
    <span class="token comment">//在此配置除了Controller的其它bean，比如：数据库链接池、事务管理器、业务bean等</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h4 id="_3-2-3-servlet-context配置"><a href="#_3-2-3-servlet-context配置" class="header-anchor">#</a> 3.2.3 Servlet Context配置</h4> <p>同security-springmvc.</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * SpringMVC的servletContext配置  【相当于springmvc.xml】
 *
 * @author RyuZheng
 * @version 1.0
 **/</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@EnableWebMvc</span>
<span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span>basePackages <span class="token operator">=</span> <span class="token string">&quot;com.jjane.security.springmvc&quot;</span><span class="token punctuation">,</span> includeFilters <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">.</span><span class="token class-name">Filter</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">FilterType</span><span class="token punctuation">.</span>ANNOTATION<span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token class-name">Controller</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebConfig</span> <span class="token keyword">implements</span> <span class="token class-name">WebMvcConfigurer</span> <span class="token punctuation">{</span>

    <span class="token comment">/**
     * 视图解析器
     *
     * @return
     */</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">InternalResourceViewResolver</span> <span class="token function">viewResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">InternalResourceViewResolver</span> viewResolver <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InternalResourceViewResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        viewResolver<span class="token punctuation">.</span><span class="token function">setPrefix</span><span class="token punctuation">(</span><span class="token string">&quot;/WEB-INF/view/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        viewResolver<span class="token punctuation">.</span><span class="token function">setSuffix</span><span class="token punctuation">(</span><span class="token string">&quot;.jsp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> viewResolver<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h4 id="_3-2-4-加载-spring容器"><a href="#_3-2-4-加载-spring容器" class="header-anchor">#</a> 3.2.4  加载 Spring容器</h4> <p>在init包下定义Spring容器初始化类SpringApplicationInitializer，此类实现WebApplicationInitializer接口，
Spring容器启动时加载WebApplicationInitializer接口的所有实现类。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * 容器启动类
 *
 * @author RyuZheng
 * @version 1.0
 **/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringApplicationInitializer</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractAnnotationConfigDispatcherServletInitializer</span> <span class="token punctuation">{</span>

    <span class="token comment">/**
     * 加载Spring容器，相当于加载applicationContext.xml
     *
     * @return
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getRootConfigClasses</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token class-name">ApplicationConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 加载SpringMvc的servletContext容器，相当于加载springmvc.xml
     *
     * @return
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getServletConfigClasses</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token class-name">WebConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//url-mapping</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getServletMappings</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><h3 id="_3-3-认证"><a href="#_3-3-认证" class="header-anchor">#</a> 3.3 认证</h3> <h4 id="_3-3-1-认证页面"><a href="#_3-3-1-认证页面" class="header-anchor">#</a> 3.3.1 认证页面</h4> <p>springSecurity默认提供认证页面，不需要额外开发。</p> <p><img src="/assets/img/Snipaste_2020-03-29_15-49-37.11da246f.jpg" alt="img"></p> <h4 id="_3-3-2-安全配置"><a href="#_3-3-2-安全配置" class="header-anchor">#</a> 3.3.2.安全配置</h4> <p>spring security提供了用户名密码登录、退出、会话管理等认证功能，只需要配置即可使用。</p> <ol><li>在config包下定义WebSecurityConfig，安全配置的内容包括：用户信息、密码编码器、安全拦截机制。</li></ol> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * Security 安全配置
 *
 * @author RyuZheng
 * @version 1.0
 **/</span>
<span class="token annotation punctuation">@EnableWebSecurity</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebSecurityConfig</span> <span class="token keyword">extends</span> <span class="token class-name">WebSecurityConfigurerAdapter</span> <span class="token punctuation">{</span>

    <span class="token comment">//定义用户信息服务（即：查询用户信息）</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">UserDetailsService</span> <span class="token function">userDetailsService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">InMemoryUserDetailsManager</span> userDetailsManager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InMemoryUserDetailsManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        userDetailsManager<span class="token punctuation">.</span><span class="token function">createUser</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token function">withUsername</span><span class="token punctuation">(</span><span class="token string">&quot;zhangsan&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">password</span><span class="token punctuation">(</span><span class="token string">&quot;123&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authorities</span><span class="token punctuation">(</span><span class="token string">&quot;p1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        userDetailsManager<span class="token punctuation">.</span><span class="token function">createUser</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token function">withUsername</span><span class="token punctuation">(</span><span class="token string">&quot;lisi&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">password</span><span class="token punctuation">(</span><span class="token string">&quot;456&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authorities</span><span class="token punctuation">(</span><span class="token string">&quot;p2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> userDetailsManager<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//密码编码器</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">PasswordEncoder</span> <span class="token function">passwordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">NoOpPasswordEncoder</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//安全拦截机制</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        http<span class="token punctuation">.</span><span class="token function">authorizeRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/r/**&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span>     （<span class="token number">1</span>）
                <span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                 （<span class="token number">2</span>）
                <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">formLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">successForwardUrl</span><span class="token punctuation">(</span><span class="token string">&quot;/login-success&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   （<span class="token number">3</span>）
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><p>在 <strong>userDetailsService()</strong> 方法中，我们返回了一个UserDetailsService给Spring容器，Spring Security会使用它来获取用户信息。我们暂时使用InMemoryUserDetailsManager实现类，并在其中分别创建了zhangsan、lisi两个用户，并设置密码和权限。</p> <p>而在**configure()**中，我们通过HttpSecurity设置了安全拦截规则，其中包含了以下内容：</p> <p>（1）url匹配/r/**的资源，经过认证后才能访问。
（2）其他url完全开放。
（3）支持form表单认证，认证成功后转向/login-success。</p> <p>关于HttpSecurity的配置清单请参考附录 HttpSecurity。</p> <ol start="2"><li>加载 WebSecurityConfig
修改SpringApplicationInitializer的getRootConfigClasses()方法，添加WebSecurityConfig.class：</li></ol> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * 加载Spring容器，相当于加载applicationContext.xml
 *
 * @return
*/</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">protected</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getRootConfigClasses</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token class-name">ApplicationConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">WebSecurityConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="_3-3-3-spring-security初始化"><a href="#_3-3-3-spring-security初始化" class="header-anchor">#</a> 3.3.3. Spring Security初始化</h4> <p>Spring Security 初始化，这里有两种情况</p> <ul><li><p>若当前环境没有使用 Spring或Spring MVC，则需要将 WebSecurityConfig(Spring Security配置类) 传入超
类，以确保获取配置，并创建spring context。</p></li> <li><p>相反，若当前环境已经使用 spring，我们应该在现有的springContext中注册Spring Security【上一步已经做将WebSecurityConfig加载至rootcontext】，此方法可以什么都不做。</p></li></ul> <p>接下来，在init包下定义 <code>SpringSecurityApplicationInitializer</code> 类：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * Spring Security初始化
 *
 * @author RyuZheng
 * @version 1.0
 **/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringSecurityApplicationInitializer</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractSecurityWebApplicationInitializer</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token class-name">SpringSecurityApplicationInitializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//super(WebSecurityConfig.class);如果当前环境没有使用Spring或Spring MVC，则需要该代码</span>
    <span class="token punctuation">}</span>
    
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h4 id="_3-3-4-默认根路径请求"><a href="#_3-3-4-默认根路径请求" class="header-anchor">#</a> 3.3.4. 默认根路径请求</h4> <p>在 <code>WebConfig.java</code> 中添加默认请求根路径跳转到/login，此url为spring security提供：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 默认Url根路径跳转到/login，此url为spring security提供</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addViewControllers</span><span class="token punctuation">(</span><span class="token class-name">ViewControllerRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    registry<span class="token punctuation">.</span><span class="token function">addViewController</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setViewName</span><span class="token punctuation">(</span><span class="token string">&quot;redirect:/login&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>spring security默认提供的登录页面。</p> <h4 id="_3-3-5-认证成功页面"><a href="#_3-3-5-认证成功页面" class="header-anchor">#</a> 3.3.5. 认证成功页面</h4> <p>在安全配置中，认证成功将跳转到/login-success，代码如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    http<span class="token punctuation">.</span><span class="token function">authorizeRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/r/**&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                 
        <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">formLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">successForwardUrl</span><span class="token punctuation">(</span><span class="token string">&quot;/login-success&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>spring security支持form表单认证，认证成功后转向/login-success。</p> <p>在LoginController中定义/login-success：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/login-success&quot;</span><span class="token punctuation">,</span> produces <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;text/plain;charset=UTF-8&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">loginSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot; 登录成功&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="_3-3-6-测试"><a href="#_3-3-6-测试" class="header-anchor">#</a> 3.3.6 测试</h4> <p><strong>（1）启动项目，访问http://localhost:8080/security-spring-security/路径地址</strong></p> <p><img src="/assets/img/Snipaste_2020-03-29_15-50-10.f1b48a69.jpg" alt="img"></p> <p>页面会根据WebConfig中addViewControllers配置规则，跳转至/login，/login是pring Security提供的登录页面。</p> <p><strong>（2）登录</strong>
1、输入错误的用户名、密码</p> <p><img src="/assets/img/Snipaste_2020-03-29_15-51-11.9b077760.jpg" alt="img"></p> <p>2、输入正确的用户名、密码，登录成功。</p> <p><img src="data:image/jpeg;base64,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" alt="img"></p> <p><strong>（3）退出</strong></p> <p>1、请求/logout退出</p> <p><img src="/assets/img/Snipaste_2020-03-29_15-59-17.841e4225.jpg" alt="img"></p> <p>2、退出 后再访问资源自动跳转到登录页面</p> <h3 id="_3-4-授权"><a href="#_3-4-授权" class="header-anchor">#</a> 3.4 授权</h3> <p>实现授权需要对用户的访问进行拦截校验，校验用户的权限是否可以操作指定的资源，Spring Security默认提供授
权实现方法。</p> <p>在LoginController添加/r/r1或/r/r2</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
     * 测试资源1
     *
     * @return
     */</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/r/r1&quot;</span><span class="token punctuation">,</span> produces <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;text/plain;charset=UTF-8&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">r1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot; 访问资源1&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
* 测试资源2
*
* @return
*/</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/r/r2&quot;</span><span class="token punctuation">,</span> produces <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;text/plain;charset=UTF-8&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">r2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot; 访问资源2&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>在安全配置类 <code>WebSecurityConfig.java</code> 中配置授权规则：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/r/r1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hasAuthority</span><span class="token punctuation">(</span><span class="token string">&quot;p1&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/r/r2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hasAuthority</span><span class="token punctuation">(</span><span class="token string">&quot;p2&quot;</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>.antMatchers(&quot;/r/r1&quot;).hasAuthority(&quot;p1&quot;)表示：访问/r/r1资源的 url需要拥有p1权限。
.antMatchers(&quot;/r/r2&quot;).hasAuthority(&quot;p2&quot;)表示：访问/r/r2资源的 url需要拥有p2权限。</p> <p>完整的WebSecurityConfig方法如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    http<span class="token punctuation">.</span><span class="token function">authorizeRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/r/r1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hasAuthority</span><span class="token punctuation">(</span><span class="token string">&quot;p1&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/r/r2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hasAuthority</span><span class="token punctuation">(</span><span class="token string">&quot;p2&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/r/**&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//所有/r/**的请求必须认证通过</span>
        <span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token operator">/</span>除了<span class="token operator">/</span>r<span class="token comment">/**，其它的请求可以访问
        .and()
        .formLogin()//允许表单登录
        .successForwardUrl(&quot;/login-success&quot;);//自定义登录成功的页面地址
}
</span></code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>测试：
1、登录成功
2、访问/r/r1和/r/r2，有权限时则正常访问，否则返回403（拒绝访问）</p> <p><img src="/assets/img/Snipaste_2020-03-29_17-24-29.21259d9c.jpg" alt="img"></p> <h3 id="_3-5-小结"><a href="#_3-5-小结" class="header-anchor">#</a> 3.5 小结</h3> <p>通过快速上手，咱们使用Spring Security实现了认证和授权，Spring Security提供了基于账号和密码的认证方式，
通过安全配置即可实现请求拦截，授权功能，Spring Security能完成的不仅仅是这些。</p> <h2 id="_4-spring-security-应用详解"><a href="#_4-spring-security-应用详解" class="header-anchor">#</a> 4. Spring Security  应用详解</h2> <h3 id="_4-1-集成springboot"><a href="#_4-1-集成springboot" class="header-anchor">#</a> 4.1 集成SpringBoot</h3> <h4 id="_4-1-1-spring-boot-介绍"><a href="#_4-1-1-spring-boot-介绍" class="header-anchor">#</a> 4.1.1 Spring Boot 介绍</h4> <p>Spring Boot是一套Spring的快速开发框架，基于Spring 4.0设计，使用Spring Boot开发可以避免一些繁琐的工程搭建和配置，同时它集成了大量的常用框架，快速导入依赖包，避免依赖包的冲突。基本上常用的开发框架都支持
Spring Boot开发，例如：MyBatis、Dubbo等，Spring 家族更是如此，例如：Spring cloud、Spring mvc、Spring security等，使用Spring Boot开发可以大大得高生产率，所以Spring Boot的使用率非常高。</p> <p>本章节讲解如何通过Spring Boot开发Spring Security应用，Spring Boot提供spring-boot-starter-security用于开
发Spring Security应用。</p> <h4 id="_4-1-2-创建maven工程"><a href="#_4-1-2-创建maven工程" class="header-anchor">#</a> 4.1.2  创建maven工程</h4> <p>1）创建maven工程 security-spring-boot，工程结构如下：</p> <p>2）引入以下依赖：</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">3/29/2020, 1:11:28 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/zh/DevAdvance/SpringBoot/SpringSecurity/05-实现短信验证码+登录功能.html" class="prev">
        05-实现短信验证码+登录功能
      </a></span> <span class="next"><a href="/zh/DevAdvance/ProgramMethodology/01-敏捷宣言.html">
        01-敏捷软件开发宣言
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.b1e3aafa.js" defer></script><script src="/assets/js/3.053a1cac.js" defer></script><script src="/assets/js/7.8dff6ea0.js" defer></script>
  </body>
</html>
