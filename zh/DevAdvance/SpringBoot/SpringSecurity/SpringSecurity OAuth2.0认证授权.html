<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Spring Security OAuth2.0 认证授权 | 云顶轩</title>
    <meta name="generator" content="VuePress 1.5.0">
    <link rel="icon" href="/favicon.ico">
    <link rel="manifest" href="/manifest.json">
    <meta name="description" content="记录点滴足迹,留下美好时光">
    <link rel="preload" href="/assets/css/0.styles.53bee21c.css" as="style"><link rel="preload" href="/assets/js/app.4e1bd89e.js" as="script"><link rel="preload" href="/assets/js/3.3dfb1d3b.js" as="script"><link rel="preload" href="/assets/js/5.4601234e.js" as="script"><link rel="prefetch" href="/assets/js/10.203cd79f.js"><link rel="prefetch" href="/assets/js/100.45b687b3.js"><link rel="prefetch" href="/assets/js/101.8ac22601.js"><link rel="prefetch" href="/assets/js/102.02c35594.js"><link rel="prefetch" href="/assets/js/103.3318b389.js"><link rel="prefetch" href="/assets/js/104.7c2a7305.js"><link rel="prefetch" href="/assets/js/105.af08e6b8.js"><link rel="prefetch" href="/assets/js/106.f7da9c8d.js"><link rel="prefetch" href="/assets/js/107.8a301261.js"><link rel="prefetch" href="/assets/js/108.e5f52351.js"><link rel="prefetch" href="/assets/js/109.8bb4265a.js"><link rel="prefetch" href="/assets/js/11.0018c8a2.js"><link rel="prefetch" href="/assets/js/110.dd0d59e6.js"><link rel="prefetch" href="/assets/js/111.dae56cce.js"><link rel="prefetch" href="/assets/js/112.8676b661.js"><link rel="prefetch" href="/assets/js/113.c92dc339.js"><link rel="prefetch" href="/assets/js/114.a6397bf2.js"><link rel="prefetch" href="/assets/js/115.c89f9ecd.js"><link rel="prefetch" href="/assets/js/116.a27c397b.js"><link rel="prefetch" href="/assets/js/117.117c1041.js"><link rel="prefetch" href="/assets/js/118.2fe53b51.js"><link rel="prefetch" href="/assets/js/119.b449da9b.js"><link rel="prefetch" href="/assets/js/12.ff6bf355.js"><link rel="prefetch" href="/assets/js/120.d7c5fc7d.js"><link rel="prefetch" href="/assets/js/121.d571544e.js"><link rel="prefetch" href="/assets/js/122.69bb3f7a.js"><link rel="prefetch" href="/assets/js/123.29363250.js"><link rel="prefetch" href="/assets/js/124.301c73fd.js"><link rel="prefetch" href="/assets/js/125.32ad1cf9.js"><link rel="prefetch" href="/assets/js/126.042dab7b.js"><link rel="prefetch" href="/assets/js/127.99e10008.js"><link rel="prefetch" href="/assets/js/128.59ea99dc.js"><link rel="prefetch" href="/assets/js/129.5c98ce7e.js"><link rel="prefetch" href="/assets/js/13.1cde1e08.js"><link rel="prefetch" href="/assets/js/130.c4841530.js"><link rel="prefetch" href="/assets/js/131.fc7f51ac.js"><link rel="prefetch" href="/assets/js/132.3a53ecb6.js"><link rel="prefetch" href="/assets/js/133.94198196.js"><link rel="prefetch" href="/assets/js/134.8c7795ee.js"><link rel="prefetch" href="/assets/js/135.076846b0.js"><link rel="prefetch" href="/assets/js/136.f14b215b.js"><link rel="prefetch" href="/assets/js/137.48c10272.js"><link rel="prefetch" href="/assets/js/138.e56a4a88.js"><link rel="prefetch" href="/assets/js/139.b7c98cdf.js"><link rel="prefetch" href="/assets/js/14.78ac2b55.js"><link rel="prefetch" href="/assets/js/140.61fdc758.js"><link rel="prefetch" href="/assets/js/141.372ccf84.js"><link rel="prefetch" href="/assets/js/142.1c1ab094.js"><link rel="prefetch" href="/assets/js/143.b388613c.js"><link rel="prefetch" href="/assets/js/144.3c05c1c4.js"><link rel="prefetch" href="/assets/js/145.fdd8d14a.js"><link rel="prefetch" href="/assets/js/146.3ad61094.js"><link rel="prefetch" href="/assets/js/147.be6edec8.js"><link rel="prefetch" href="/assets/js/148.fdb8d76a.js"><link rel="prefetch" href="/assets/js/149.8b15c1e7.js"><link rel="prefetch" href="/assets/js/15.f965f29d.js"><link rel="prefetch" href="/assets/js/150.8bef9036.js"><link rel="prefetch" href="/assets/js/151.a531d854.js"><link rel="prefetch" href="/assets/js/152.fa7e224a.js"><link rel="prefetch" href="/assets/js/153.69ffd92d.js"><link rel="prefetch" href="/assets/js/154.094532c8.js"><link rel="prefetch" href="/assets/js/155.a92b0936.js"><link rel="prefetch" href="/assets/js/156.44a537c7.js"><link rel="prefetch" href="/assets/js/157.3123b61e.js"><link rel="prefetch" href="/assets/js/158.fefdddb1.js"><link rel="prefetch" href="/assets/js/159.fa5bea48.js"><link rel="prefetch" href="/assets/js/16.9921cd10.js"><link rel="prefetch" href="/assets/js/160.43794fec.js"><link rel="prefetch" href="/assets/js/161.d1a89ae0.js"><link rel="prefetch" href="/assets/js/162.c14121ea.js"><link rel="prefetch" href="/assets/js/163.86a4b2bb.js"><link rel="prefetch" href="/assets/js/164.00201c0d.js"><link rel="prefetch" href="/assets/js/165.f8bb1e89.js"><link rel="prefetch" href="/assets/js/166.e37f1bdb.js"><link rel="prefetch" href="/assets/js/167.3e9d6352.js"><link rel="prefetch" href="/assets/js/168.a5538970.js"><link rel="prefetch" href="/assets/js/169.a68858de.js"><link rel="prefetch" href="/assets/js/17.10d4570d.js"><link rel="prefetch" href="/assets/js/170.ff3e7036.js"><link rel="prefetch" href="/assets/js/171.cc0d8b63.js"><link rel="prefetch" href="/assets/js/172.a0f54f23.js"><link rel="prefetch" href="/assets/js/173.b2174ef6.js"><link rel="prefetch" href="/assets/js/174.20461c71.js"><link rel="prefetch" href="/assets/js/175.11f96c9c.js"><link rel="prefetch" href="/assets/js/176.ddc601ad.js"><link rel="prefetch" href="/assets/js/177.9a5a7e4d.js"><link rel="prefetch" href="/assets/js/178.3056828d.js"><link rel="prefetch" href="/assets/js/179.79199d22.js"><link rel="prefetch" href="/assets/js/18.af097650.js"><link rel="prefetch" href="/assets/js/180.aee68a88.js"><link rel="prefetch" href="/assets/js/181.7e56ec66.js"><link rel="prefetch" href="/assets/js/182.5cbeb3f6.js"><link rel="prefetch" href="/assets/js/183.6bddcc02.js"><link rel="prefetch" href="/assets/js/184.e722d782.js"><link rel="prefetch" href="/assets/js/185.4656f1b7.js"><link rel="prefetch" href="/assets/js/186.5f593187.js"><link rel="prefetch" href="/assets/js/187.fe799e85.js"><link rel="prefetch" href="/assets/js/188.77289edc.js"><link rel="prefetch" href="/assets/js/189.de7f3c52.js"><link rel="prefetch" href="/assets/js/19.e831f163.js"><link rel="prefetch" href="/assets/js/190.16a930c6.js"><link rel="prefetch" href="/assets/js/191.aa05cbcf.js"><link rel="prefetch" href="/assets/js/192.93052017.js"><link rel="prefetch" href="/assets/js/193.004ebc56.js"><link rel="prefetch" href="/assets/js/194.d57c30a4.js"><link rel="prefetch" href="/assets/js/195.079b4df4.js"><link rel="prefetch" href="/assets/js/196.e8aed995.js"><link rel="prefetch" href="/assets/js/197.6cd089b9.js"><link rel="prefetch" href="/assets/js/198.5f23a7c7.js"><link rel="prefetch" href="/assets/js/199.9c6e9044.js"><link rel="prefetch" href="/assets/js/20.122b22e2.js"><link rel="prefetch" href="/assets/js/200.2313f0b9.js"><link rel="prefetch" href="/assets/js/201.f2cf3289.js"><link rel="prefetch" href="/assets/js/202.5ab22fa8.js"><link rel="prefetch" href="/assets/js/203.cf403c11.js"><link rel="prefetch" href="/assets/js/204.727aba85.js"><link rel="prefetch" href="/assets/js/205.460e6bf9.js"><link rel="prefetch" href="/assets/js/206.6b80b6a6.js"><link rel="prefetch" href="/assets/js/207.fa4d3d6e.js"><link rel="prefetch" href="/assets/js/208.ba28b976.js"><link rel="prefetch" href="/assets/js/209.2c471641.js"><link rel="prefetch" href="/assets/js/21.a4d4b0ed.js"><link rel="prefetch" href="/assets/js/210.e4e5ec50.js"><link rel="prefetch" href="/assets/js/211.7ac0b3eb.js"><link rel="prefetch" href="/assets/js/212.2cb73c5d.js"><link rel="prefetch" href="/assets/js/213.a7218d59.js"><link rel="prefetch" href="/assets/js/214.e5f95933.js"><link rel="prefetch" href="/assets/js/215.23e35bec.js"><link rel="prefetch" href="/assets/js/216.af8b9ca3.js"><link rel="prefetch" href="/assets/js/217.17b07a91.js"><link rel="prefetch" href="/assets/js/218.b38b05ab.js"><link rel="prefetch" href="/assets/js/219.369f4285.js"><link rel="prefetch" href="/assets/js/22.e95a8abd.js"><link rel="prefetch" href="/assets/js/220.36a40a73.js"><link rel="prefetch" href="/assets/js/221.6abbbf8d.js"><link rel="prefetch" href="/assets/js/222.d15065ff.js"><link rel="prefetch" href="/assets/js/223.0e1eb692.js"><link rel="prefetch" href="/assets/js/224.7418676b.js"><link rel="prefetch" href="/assets/js/225.49593c39.js"><link rel="prefetch" href="/assets/js/226.cbf10584.js"><link rel="prefetch" href="/assets/js/227.f64a4697.js"><link rel="prefetch" href="/assets/js/228.a17c56a4.js"><link rel="prefetch" href="/assets/js/229.2f15b9a1.js"><link rel="prefetch" href="/assets/js/23.0fa330de.js"><link rel="prefetch" href="/assets/js/230.72b1421b.js"><link rel="prefetch" href="/assets/js/231.bd9c2048.js"><link rel="prefetch" href="/assets/js/232.e16b1c75.js"><link rel="prefetch" href="/assets/js/233.3fdc84db.js"><link rel="prefetch" href="/assets/js/234.3231ffa5.js"><link rel="prefetch" href="/assets/js/235.442e8056.js"><link rel="prefetch" href="/assets/js/236.a3833a1a.js"><link rel="prefetch" href="/assets/js/237.d2d7a614.js"><link rel="prefetch" href="/assets/js/238.c0f7a016.js"><link rel="prefetch" href="/assets/js/239.165f2a63.js"><link rel="prefetch" href="/assets/js/24.f10ba58d.js"><link rel="prefetch" href="/assets/js/240.1043e3b4.js"><link rel="prefetch" href="/assets/js/241.d1da35e4.js"><link rel="prefetch" href="/assets/js/242.d2104ee4.js"><link rel="prefetch" href="/assets/js/243.ffe8ba86.js"><link rel="prefetch" href="/assets/js/244.dafa577b.js"><link rel="prefetch" href="/assets/js/245.5d4ba3f0.js"><link rel="prefetch" href="/assets/js/246.be491d26.js"><link rel="prefetch" href="/assets/js/247.87078f4d.js"><link rel="prefetch" href="/assets/js/248.b942c03e.js"><link rel="prefetch" href="/assets/js/249.905c2d6d.js"><link rel="prefetch" href="/assets/js/25.207c972e.js"><link rel="prefetch" href="/assets/js/250.7041bb43.js"><link rel="prefetch" href="/assets/js/251.0ad26225.js"><link rel="prefetch" href="/assets/js/252.2d2f9c99.js"><link rel="prefetch" href="/assets/js/253.88cb1ee7.js"><link rel="prefetch" href="/assets/js/254.01914d38.js"><link rel="prefetch" href="/assets/js/255.490bc994.js"><link rel="prefetch" href="/assets/js/256.338f64db.js"><link rel="prefetch" href="/assets/js/257.fa5ad9e3.js"><link rel="prefetch" href="/assets/js/258.e2ab01fd.js"><link rel="prefetch" href="/assets/js/259.047b1d55.js"><link rel="prefetch" href="/assets/js/26.f591825e.js"><link rel="prefetch" href="/assets/js/260.5f50ba5f.js"><link rel="prefetch" href="/assets/js/261.91f40ac5.js"><link rel="prefetch" href="/assets/js/262.df5203e3.js"><link rel="prefetch" href="/assets/js/263.c9145fa9.js"><link rel="prefetch" href="/assets/js/264.0cb579ac.js"><link rel="prefetch" href="/assets/js/265.357af552.js"><link rel="prefetch" href="/assets/js/266.7c77867d.js"><link rel="prefetch" href="/assets/js/267.817174fa.js"><link rel="prefetch" href="/assets/js/268.255ca80d.js"><link rel="prefetch" href="/assets/js/269.e47db2e6.js"><link rel="prefetch" href="/assets/js/27.59cb7e68.js"><link rel="prefetch" href="/assets/js/270.98c0e008.js"><link rel="prefetch" href="/assets/js/271.5ef7c898.js"><link rel="prefetch" href="/assets/js/272.b680253e.js"><link rel="prefetch" href="/assets/js/273.109b69e5.js"><link rel="prefetch" href="/assets/js/274.ed666912.js"><link rel="prefetch" href="/assets/js/275.318ce484.js"><link rel="prefetch" href="/assets/js/276.874abe8b.js"><link rel="prefetch" href="/assets/js/277.feb52891.js"><link rel="prefetch" href="/assets/js/278.685ad7a2.js"><link rel="prefetch" href="/assets/js/279.0752db46.js"><link rel="prefetch" href="/assets/js/28.fa7f16ab.js"><link rel="prefetch" href="/assets/js/280.e63b5f3c.js"><link rel="prefetch" href="/assets/js/281.008069bf.js"><link rel="prefetch" href="/assets/js/282.a7077578.js"><link rel="prefetch" href="/assets/js/283.80e06a11.js"><link rel="prefetch" href="/assets/js/284.b6e33f2a.js"><link rel="prefetch" href="/assets/js/285.b4c33b5a.js"><link rel="prefetch" href="/assets/js/286.ed21a901.js"><link rel="prefetch" href="/assets/js/287.142ffde6.js"><link rel="prefetch" href="/assets/js/288.64c2a018.js"><link rel="prefetch" href="/assets/js/289.58042b17.js"><link rel="prefetch" href="/assets/js/29.6e9b5c2e.js"><link rel="prefetch" href="/assets/js/290.31342961.js"><link rel="prefetch" href="/assets/js/291.e5fa2368.js"><link rel="prefetch" href="/assets/js/292.c23ff6e9.js"><link rel="prefetch" href="/assets/js/293.99825196.js"><link rel="prefetch" href="/assets/js/294.07829124.js"><link rel="prefetch" href="/assets/js/295.2e920585.js"><link rel="prefetch" href="/assets/js/296.646ea547.js"><link rel="prefetch" href="/assets/js/297.c66cd6c5.js"><link rel="prefetch" href="/assets/js/298.2c02c275.js"><link rel="prefetch" href="/assets/js/299.1012055f.js"><link rel="prefetch" href="/assets/js/30.506c40c2.js"><link rel="prefetch" href="/assets/js/300.d4633d95.js"><link rel="prefetch" href="/assets/js/301.83e4d118.js"><link rel="prefetch" href="/assets/js/302.0628a646.js"><link rel="prefetch" href="/assets/js/303.9dbc720e.js"><link rel="prefetch" href="/assets/js/304.03a395d3.js"><link rel="prefetch" href="/assets/js/305.aa36aa28.js"><link rel="prefetch" href="/assets/js/306.3a93d6d2.js"><link rel="prefetch" href="/assets/js/307.385d9e97.js"><link rel="prefetch" href="/assets/js/308.2ed9799b.js"><link rel="prefetch" href="/assets/js/309.3f07ec4f.js"><link rel="prefetch" href="/assets/js/31.1849b83e.js"><link rel="prefetch" href="/assets/js/310.fac4f617.js"><link rel="prefetch" href="/assets/js/311.65ddc82e.js"><link rel="prefetch" href="/assets/js/312.edaf0189.js"><link rel="prefetch" href="/assets/js/313.51084a78.js"><link rel="prefetch" href="/assets/js/314.2320daef.js"><link rel="prefetch" href="/assets/js/315.7f85d7fe.js"><link rel="prefetch" href="/assets/js/316.e1ac41f5.js"><link rel="prefetch" href="/assets/js/317.7e81ed74.js"><link rel="prefetch" href="/assets/js/318.00cacb3e.js"><link rel="prefetch" href="/assets/js/32.a254a69f.js"><link rel="prefetch" href="/assets/js/33.a7d6bfb1.js"><link rel="prefetch" href="/assets/js/34.83c2cf33.js"><link rel="prefetch" href="/assets/js/35.362eaad1.js"><link rel="prefetch" href="/assets/js/36.7ba3de88.js"><link rel="prefetch" href="/assets/js/37.423b58a7.js"><link rel="prefetch" href="/assets/js/38.a412fae6.js"><link rel="prefetch" href="/assets/js/39.3bf46cc4.js"><link rel="prefetch" href="/assets/js/4.019e8ebd.js"><link rel="prefetch" href="/assets/js/40.cb22b335.js"><link rel="prefetch" href="/assets/js/41.d60daad8.js"><link rel="prefetch" href="/assets/js/42.6b983e3a.js"><link rel="prefetch" href="/assets/js/43.1a0f92a8.js"><link rel="prefetch" href="/assets/js/44.b423ee48.js"><link rel="prefetch" href="/assets/js/45.1f4202d8.js"><link rel="prefetch" href="/assets/js/46.955cf24c.js"><link rel="prefetch" href="/assets/js/47.0c85e3ab.js"><link rel="prefetch" href="/assets/js/48.a7f4fa60.js"><link rel="prefetch" href="/assets/js/49.1f541bb0.js"><link rel="prefetch" href="/assets/js/50.914cdca3.js"><link rel="prefetch" href="/assets/js/51.b7fed704.js"><link rel="prefetch" href="/assets/js/52.49989bae.js"><link rel="prefetch" href="/assets/js/53.2cf8ca76.js"><link rel="prefetch" href="/assets/js/54.339f534b.js"><link rel="prefetch" href="/assets/js/55.297b3c9a.js"><link rel="prefetch" href="/assets/js/56.8cfb4bd4.js"><link rel="prefetch" href="/assets/js/57.8df37f87.js"><link rel="prefetch" href="/assets/js/58.43c53767.js"><link rel="prefetch" href="/assets/js/59.d4aa69cb.js"><link rel="prefetch" href="/assets/js/6.24a7bdd2.js"><link rel="prefetch" href="/assets/js/60.443f2f46.js"><link rel="prefetch" href="/assets/js/61.951ceb04.js"><link rel="prefetch" href="/assets/js/62.459d19a9.js"><link rel="prefetch" href="/assets/js/63.73ece404.js"><link rel="prefetch" href="/assets/js/64.cba9848d.js"><link rel="prefetch" href="/assets/js/65.78902847.js"><link rel="prefetch" href="/assets/js/66.4efccf9f.js"><link rel="prefetch" href="/assets/js/67.71acafac.js"><link rel="prefetch" href="/assets/js/68.02c254a7.js"><link rel="prefetch" href="/assets/js/69.a87265dc.js"><link rel="prefetch" href="/assets/js/7.bc01430e.js"><link rel="prefetch" href="/assets/js/70.4e513318.js"><link rel="prefetch" href="/assets/js/71.978215b4.js"><link rel="prefetch" href="/assets/js/72.607fda78.js"><link rel="prefetch" href="/assets/js/73.f3977b68.js"><link rel="prefetch" href="/assets/js/74.f8c51459.js"><link rel="prefetch" href="/assets/js/75.991dc6a1.js"><link rel="prefetch" href="/assets/js/76.3d2bb418.js"><link rel="prefetch" href="/assets/js/77.48b87d25.js"><link rel="prefetch" href="/assets/js/78.3790b030.js"><link rel="prefetch" href="/assets/js/79.85fd30a7.js"><link rel="prefetch" href="/assets/js/8.3a1ff779.js"><link rel="prefetch" href="/assets/js/80.0bb0470b.js"><link rel="prefetch" href="/assets/js/81.165fec7b.js"><link rel="prefetch" href="/assets/js/82.a33504af.js"><link rel="prefetch" href="/assets/js/83.80b47ca2.js"><link rel="prefetch" href="/assets/js/84.a8f1bfbc.js"><link rel="prefetch" href="/assets/js/85.c5de7e74.js"><link rel="prefetch" href="/assets/js/86.7dd68066.js"><link rel="prefetch" href="/assets/js/87.1234cbd2.js"><link rel="prefetch" href="/assets/js/88.a48b807f.js"><link rel="prefetch" href="/assets/js/89.ed8671ef.js"><link rel="prefetch" href="/assets/js/9.ae844292.js"><link rel="prefetch" href="/assets/js/90.1dc21932.js"><link rel="prefetch" href="/assets/js/91.376cdf42.js"><link rel="prefetch" href="/assets/js/92.012e924e.js"><link rel="prefetch" href="/assets/js/93.8489194a.js"><link rel="prefetch" href="/assets/js/94.e28a2cb9.js"><link rel="prefetch" href="/assets/js/95.25ce7e96.js"><link rel="prefetch" href="/assets/js/96.185ff487.js"><link rel="prefetch" href="/assets/js/97.6b5aa6f2.js"><link rel="prefetch" href="/assets/js/98.6b1b50a3.js"><link rel="prefetch" href="/assets/js/99.dc3090d3.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.665629d6.js">
    <link rel="stylesheet" href="/assets/css/0.styles.53bee21c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/zh/" class="home-link router-link-active"><!----> <span class="site-name">云顶轩</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/zh/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/zh/guide/" class="nav-link">
  指南
</a></div><div class="nav-item"><a href="/zh/interview/" class="nav-link">
  面试
</a></div><div class="nav-item"><a href="/zh/DevBasic/" class="nav-link">
  基础
</a></div><div class="nav-item"><a href="/zh/DevAdvance/" class="nav-link router-link-active">
  高级
</a></div><div class="nav-item"><a href="/zh/Frontend/" class="nav-link">
  前端
</a></div><div class="nav-item"><a href="/zh/DevOthers/" class="nav-link">
  杂谈
</a></div><div class="nav-item"><a href="/zh/article/" class="nav-link">
  文章
</a></div><div class="nav-item"><a href="/zh/about/" class="nav-link">
  关于
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/" class="nav-link">
  English
</a></li><li class="dropdown-item"><!----> <a href="/zh/DevAdvance/SpringBoot/SpringSecurity/SpringSecurity OAuth2.0认证授权.html" class="nav-link">
  简体中文
</a></li></ul></div></div> <a href="https://github.com/zhengxiaochuan" target="_blank" rel="noopener noreferrer" class="repo-link">
    官网
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/zh/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/zh/guide/" class="nav-link">
  指南
</a></div><div class="nav-item"><a href="/zh/interview/" class="nav-link">
  面试
</a></div><div class="nav-item"><a href="/zh/DevBasic/" class="nav-link">
  基础
</a></div><div class="nav-item"><a href="/zh/DevAdvance/" class="nav-link router-link-active">
  高级
</a></div><div class="nav-item"><a href="/zh/Frontend/" class="nav-link">
  前端
</a></div><div class="nav-item"><a href="/zh/DevOthers/" class="nav-link">
  杂谈
</a></div><div class="nav-item"><a href="/zh/article/" class="nav-link">
  文章
</a></div><div class="nav-item"><a href="/zh/about/" class="nav-link">
  关于
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/" class="nav-link">
  English
</a></li><li class="dropdown-item"><!----> <a href="/zh/DevAdvance/SpringBoot/SpringSecurity/SpringSecurity OAuth2.0认证授权.html" class="nav-link">
  简体中文
</a></li></ul></div></div> <a href="https://github.com/zhengxiaochuan" target="_blank" rel="noopener noreferrer" class="repo-link">
    官网
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>SpringBoot基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>SpringBoot整合</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>SpringSecurity</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/zh/DevAdvance/SpringBoot/SpringSecurity/01-SpringSecurity自定义基本使用及个性化登录配置.html" class="sidebar-link">01-SpringSecurity自定义基本使用及个性化登录配置</a></li><li><a href="/zh/DevAdvance/SpringBoot/SpringSecurity/02-SpringSecurity安全认证流程源码详解.html" class="sidebar-link">02-SpringSecurity安全认证流程源码详解</a></li><li><a href="/zh/DevAdvance/SpringBoot/SpringSecurity/03-SpringSecurity实现图片验证码认证.html" class="sidebar-link">03-SpringSecurity实现图片验证码认证</a></li><li><a href="/zh/DevAdvance/SpringBoot/SpringSecurity/04-SpringSecurity记住我功能实现.html" class="sidebar-link">04-SpringSecurity记住我功能实现</a></li><li><a href="/zh/DevAdvance/SpringBoot/SpringSecurity/05-实现短信验证码+登录功能.html" class="sidebar-link">05-实现短信验证码+登录功能</a></li><li><a href="/zh/DevAdvance/SpringBoot/SpringSecurity/SpringSecurity OAuth2.0认证授权.html" class="active sidebar-link">Spring Security OAuth2.0 认证授权</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zh/DevAdvance/SpringBoot/SpringSecurity/SpringSecurity OAuth2.0认证授权.html#_1-基本概念" class="sidebar-link">1. 基本概念</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zh/DevAdvance/SpringBoot/SpringSecurity/SpringSecurity OAuth2.0认证授权.html#_1-1-什么是认证" class="sidebar-link">1.1.什么是认证</a></li><li class="sidebar-sub-header"><a href="/zh/DevAdvance/SpringBoot/SpringSecurity/SpringSecurity OAuth2.0认证授权.html#_1-2-什么是会话" class="sidebar-link">1.2 什么是会话</a></li><li class="sidebar-sub-header"><a href="/zh/DevAdvance/SpringBoot/SpringSecurity/SpringSecurity OAuth2.0认证授权.html#_1-3-什么是授权" class="sidebar-link">1.3 什么是授权</a></li><li class="sidebar-sub-header"><a href="/zh/DevAdvance/SpringBoot/SpringSecurity/SpringSecurity OAuth2.0认证授权.html#_1-4-授权的数据模型" class="sidebar-link">1.4 授权的数据模型</a></li><li class="sidebar-sub-header"><a href="/zh/DevAdvance/SpringBoot/SpringSecurity/SpringSecurity OAuth2.0认证授权.html#_1-5-rbac" class="sidebar-link">1.5 RBAC</a></li></ul></li><li class="sidebar-sub-header"><a href="/zh/DevAdvance/SpringBoot/SpringSecurity/SpringSecurity OAuth2.0认证授权.html#_2-基于session的认证方式" class="sidebar-link">2.  基于Session的认证方式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zh/DevAdvance/SpringBoot/SpringSecurity/SpringSecurity OAuth2.0认证授权.html#_2-1-认证流程" class="sidebar-link">2.1 认证流程</a></li><li class="sidebar-sub-header"><a href="/zh/DevAdvance/SpringBoot/SpringSecurity/SpringSecurity OAuth2.0认证授权.html#_2-2-创建工程" class="sidebar-link">2.2.创建工程</a></li><li class="sidebar-sub-header"><a href="/zh/DevAdvance/SpringBoot/SpringSecurity/SpringSecurity OAuth2.0认证授权.html#_2-3-实现认证功能" class="sidebar-link">2.3.实现认证功能</a></li><li class="sidebar-sub-header"><a href="/zh/DevAdvance/SpringBoot/SpringSecurity/SpringSecurity OAuth2.0认证授权.html#_2-4-实现会话功能" class="sidebar-link">2.4.实现会话功能</a></li><li class="sidebar-sub-header"><a href="/zh/DevAdvance/SpringBoot/SpringSecurity/SpringSecurity OAuth2.0认证授权.html#_2-5-实现授权功能" class="sidebar-link">2.5.实现授权功能</a></li><li class="sidebar-sub-header"><a href="/zh/DevAdvance/SpringBoot/SpringSecurity/SpringSecurity OAuth2.0认证授权.html#_2-6-小结" class="sidebar-link">2.6.小结</a></li></ul></li><li class="sidebar-sub-header"><a href="/zh/DevAdvance/SpringBoot/SpringSecurity/SpringSecurity OAuth2.0认证授权.html#_3-spring-security-快速上手" class="sidebar-link">3. Spring Security 快速上手</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zh/DevAdvance/SpringBoot/SpringSecurity/SpringSecurity OAuth2.0认证授权.html#_3-1-spring-security介绍" class="sidebar-link">3.1 Spring Security介绍</a></li><li class="sidebar-sub-header"><a href="/zh/DevAdvance/SpringBoot/SpringSecurity/SpringSecurity OAuth2.0认证授权.html#_3-2-创建工程" class="sidebar-link">3.2 创建工程</a></li><li class="sidebar-sub-header"><a href="/zh/DevAdvance/SpringBoot/SpringSecurity/SpringSecurity OAuth2.0认证授权.html#_3-3-认证" class="sidebar-link">3.3 认证</a></li><li class="sidebar-sub-header"><a href="/zh/DevAdvance/SpringBoot/SpringSecurity/SpringSecurity OAuth2.0认证授权.html#_3-4-授权" class="sidebar-link">3.4 授权</a></li><li class="sidebar-sub-header"><a href="/zh/DevAdvance/SpringBoot/SpringSecurity/SpringSecurity OAuth2.0认证授权.html#_3-5-小结" class="sidebar-link">3.5 小结</a></li></ul></li><li class="sidebar-sub-header"><a href="/zh/DevAdvance/SpringBoot/SpringSecurity/SpringSecurity OAuth2.0认证授权.html#_4-spring-security-应用详解" class="sidebar-link">4. Spring Security  应用详解</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zh/DevAdvance/SpringBoot/SpringSecurity/SpringSecurity OAuth2.0认证授权.html#_4-1-集成springboot" class="sidebar-link">4.1 集成SpringBoot</a></li><li class="sidebar-sub-header"><a href="/zh/DevAdvance/SpringBoot/SpringSecurity/SpringSecurity OAuth2.0认证授权.html#_4-2-工作原理" class="sidebar-link">4.2 工作原理</a></li><li class="sidebar-sub-header"><a href="/zh/DevAdvance/SpringBoot/SpringSecurity/SpringSecurity OAuth2.0认证授权.html#_4-3-自定义认证" class="sidebar-link">4.3 自定义认证</a></li><li class="sidebar-sub-header"><a href="/zh/DevAdvance/SpringBoot/SpringSecurity/SpringSecurity OAuth2.0认证授权.html#_4-4-会话" class="sidebar-link">4.4 会话</a></li><li class="sidebar-sub-header"><a href="/zh/DevAdvance/SpringBoot/SpringSecurity/SpringSecurity OAuth2.0认证授权.html#_4-5-退出" class="sidebar-link">4.5 退出</a></li><li class="sidebar-sub-header"><a href="/zh/DevAdvance/SpringBoot/SpringSecurity/SpringSecurity OAuth2.0认证授权.html#_4-6-授权" class="sidebar-link">4.6 授权</a></li></ul></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>编程方法论</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>微服务</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Docker容器</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Kubernetes</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>解决方案</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="spring-security-oauth2-0-认证授权"><a href="#spring-security-oauth2-0-认证授权" class="header-anchor">#</a> Spring Security OAuth2.0 认证授权</h1> <h2 id="_1-基本概念"><a href="#_1-基本概念" class="header-anchor">#</a> 1. 基本概念</h2> <h3 id="_1-1-什么是认证"><a href="#_1-1-什么是认证" class="header-anchor">#</a> 1.1.什么是认证</h3> <p>进入移动互联网时代，大家每天都在刷手机，常用的软件有微信、支付宝、头条等，下边拿微信来举例子说明认证
相关的基本概念，在初次使用微信前需要注册成为微信用户，然后输入账号和密码即可登录微信，输入账号和密码
登录微信的过程就是认证。</p> <p>系统为什么要认证？
认证是为了保护系统的隐私数据与资源，用户的身份合法方可访问该系统的资源。</p> <p>**认证 ：**用户认证就是判断一个用户的身份是否合法的过程，用户去访问系统资源时系统要求验证用户的身份信
息，身份合法方可继续访问，不合法则拒绝访问。常见的用户身份认证方式有：用户名密码登录，二维码登录，手
机短信登录，指纹认证等方式。</p> <h3 id="_1-2-什么是会话"><a href="#_1-2-什么是会话" class="header-anchor">#</a> 1.2 什么是会话</h3> <p>用户认证通过后，为了避免用户的每次操作都进行认证可将用户的信息保证在会话中。会话就是系统为了保持当前
用户的登录状态所提供的机制，常见的有基于session方式、基于token方式等。</p> <p>基于session的认证方式如下图：</p> <p>它的交互流程是，用户认证成功后，在服务端生成用户相关的数据保存在session(当前会话)中，发给客户端的
sesssion_id 存放到 cookie 中，这样用户客户端请求时带上 session_id 就可以验证服务器端是否存在 session 数
据，以此完成用户的合法校验，当用户退出系统或session过期销毁时,客户端的session_id也就无效了。</p> <p><img src="/assets/img/conversation_session.de0de411.png" alt="image"></p> <p>基于token方式如下图：
它的交互流程是，用户认证成功后，服务端生成一个token发给客户端，客户端可以放到 cookie 或 localStorage
等存储中，每次请求时带上 token，服务端收到token通过验证后即可确认用户身份。</p> <p><img src="/assets/img/conversation_token.5b68fb30.png" alt="image"></p> <p>基于session的认证方式由Servlet规范定制，服务端要存储session信息需要占用内存资源，客户端需要支持
cookie；基于token的方式则一般不需要服务端存储token，并且不限制客户端的存储方式。如今移动互联网时代
更多类型的客户端需要接入系统，系统多是采用前后端分离的架构进行实现，所以基于token的方式更适合。</p> <h3 id="_1-3-什么是授权"><a href="#_1-3-什么是授权" class="header-anchor">#</a> 1.3 什么是授权</h3> <p>还拿微信来举例子，微信登录成功后用户即可使用微信的功能，比如，发红包、发朋友圈、添加好友等，没有绑定
银行卡的用户是无法发送红包的，绑定银行卡的用户才可以发红包，发红包功能、发朋友圈功能都是微信的资源即
功能资源，用户拥有发红包功能的权限才可以正常使用发送红包功能，拥有发朋友圈功能的权限才可以使用发朋友
圈功能，这个根据用户的权限来控制用户使用资源的过程就是授权。</p> <p>为什么要授权？</p> <p>认证是为了保证用户身份的合法性，授权则是为了更细粒度的对隐私数据进行划分，授权是在认证通过后发生的，
控制不同的用户能够访问不同的资源。</p> <p>**授权： **授权是用户认证通过根据用户的权限来控制用户访问资源的过程，拥有资源的访问权限则正常访问，没有
权限则拒绝访问。</p> <h3 id="_1-4-授权的数据模型"><a href="#_1-4-授权的数据模型" class="header-anchor">#</a> 1.4 授权的数据模型</h3> <p>如何进行授权即如何对用户访问资源进行控制，首先需要学习授权相关的数据模型。</p> <p>授权可简单理解为Who对What(which)进行How操作，包括如下：</p> <p>Who，即主体（Subject），主体一般是指用户，也可以是程序，需要访问系统中的资源。</p> <p>What，即资源（Resource），如系统菜单、页面、按钮、代码方法、系统商品信息、系统订单信息等。系统菜单、页面、按钮、代码方法都属于系统功能资源，对于web系统每个功能资源通常对应一个URL；系统商品信息、系统订单信息都属于实体资源（数据资源），实体资源由资源类型和资源实例组成，比如商品信息为资源类型，商品编号 为001的商品为资源实例。</p> <p>How，权限/许可（Permission），规定了用户对资源的操作许可，权限离开资源没有意义，
如用户查询权限、用户添加权限、某个代码方法的调用权限、编号为001的用户的修改权限等，通过权限可知用户
对哪些资源都有哪些操作许可。</p> <p>主体、资源、权限关系如下图：</p> <p><img src="/assets/img/Snipaste_2020-03-28_12-54-52.e0518b6f.jpg" alt="img"></p> <p>主体、资源、权限相关的数据模型如下：
主体（用户id、账号、密码、...）
资源（资源id、资源名称、访问地址、...）
权限（权限id、权限标识、权限名称、资源id、...）
角色（角色id、角色名称、...）</p> <p>角色和权限关系（角色 id、权限id、...）
主体（用户）和角色关系（用户id、角色id、...）</p> <p>主体（用户）、资源、权限关系如下图：</p> <p><img src="/assets/img/Snipaste_2020-03-28_12-58-13.481fcc22.jpg" alt="img"></p> <p>通常企业开发中将资源和权限表合并为一张权限表，如下：
资源（资源id、资源名称、访问地址、...）
权限（权限id、权限标识、权限名称、资源id、...）
合并为：
权限（权限id、权限标识、权限名称、资源名称、资源访问地址、...）</p> <p>修改后数据模型之间的关系如下图：</p> <p><img src="/assets/img/Snipaste_2020-03-28_12-59-27.251f8aa5.jpg" alt="img"></p> <h3 id="_1-5-rbac"><a href="#_1-5-rbac" class="header-anchor">#</a> 1.5 RBAC</h3> <p>如何实现授权？业界通常基于RBAC实现授权。</p> <h4 id="_1-5-1-基于角色的访问控制"><a href="#_1-5-1-基于角色的访问控制" class="header-anchor">#</a> 1.5.1  基于角色的访问控制</h4> <p>RBAC基于角色的访问控制（Role-Based Access Control）是按角色进行授权，比如：主体的角色为总经理可以查
询企业运营报表，查询员工工资信息等，访问控制流程如下：</p> <p><img src="/assets/img/Snipaste_2020-03-28_13-04-17.c635c614.jpg" alt="img"></p> <p>根据上图中的判断逻辑，授权代码可表示如下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>if(主体.hasRole(&quot;总经理角色id&quot;)){
    查询工资
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>如果上图中查询工资所需要的角色变化为总经理和部门经理，此时就需要修改判断逻辑为“判断用户的角色是否是
总经理或部门经理”，修改代码如下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>if(主体.hasRole(&quot;总经理角色id&quot;) ||  主体.hasRole(&quot;部门经理角色id&quot;)){
    查询工资
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>根据上边的例子发现，当需要修改角色的权限时就需要修改授权的相关代码，系统可扩展性差。</p> <h4 id="_1-5-2-基于资源的访问控制"><a href="#_1-5-2-基于资源的访问控制" class="header-anchor">#</a> 1.5.2 基于资源的访问控制</h4> <p>RBAC基于资源的访问控制（Resource-Based Access Control）是按资源（或权限）进行授权，比如：用户必须
具有查询工资权限才可以查询员工工资信息等，访问控制流程如下：</p> <p><img src="/assets/img/Snipaste_2020-03-28_13-05-33.b1fbf409.jpg" alt="img"></p> <p>根据上图中的判断，授权代码可以表示为：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>if(主体.hasPermission(&quot;查询工资权限标识&quot;)){
    查询工资
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>优点：系统设计时定义好查询工资的权限标识，即使查询工资所需要的角色变化为总经理和部门经理也不需要修改
授权代码，系统可扩展性强。</p> <h2 id="_2-基于session的认证方式"><a href="#_2-基于session的认证方式" class="header-anchor">#</a> 2.  基于Session的认证方式</h2> <h3 id="_2-1-认证流程"><a href="#_2-1-认证流程" class="header-anchor">#</a> 2.1 认证流程</h3> <p>基于Session认证方式的流程是，用户认证成功后，在服务端生成用户相关的数据保存在session(当前会话)，而发
给客户端的 sesssion_id 存放到 cookie 中，这样用客户端请求时带上 session_id 就可以验证服务器端是否存在
session 数据，以此完成用户的合法校验。当用户退出系统或session过期销毁时,客户端的session_id也就无效了。</p> <p>下图是session认证方式的流程图：</p> <p><img src="/assets/img/Snipaste_2020-03-28_13-07-18.8e9ff15c.jpg" alt="img"></p> <p>基于Session的认证机制由Servlet规范定制，Servlet容器已实现，用户通过HttpSession的操作方法即可实现，如
下是HttpSession相关的操作API。</p> <table><thead><tr><th>方法</th> <th>含义</th></tr></thead> <tbody><tr><td>HttpSession getSession(Boolean create)</td> <td>获取当前HttpSession对象</td></tr> <tr><td>void setAttribute(String name,Object value)</td> <td>向session中存放对象</td></tr> <tr><td>object getAttribute(String name)</td> <td>从session中获取对象</td></tr> <tr><td>void removeAttribute(String name);</td> <td>移除session中对象</td></tr> <tr><td>void invalidate()</td> <td>使HttpSession失效</td></tr> <tr><td>略...</td> <td></td></tr></tbody></table> <h3 id="_2-2-创建工程"><a href="#_2-2-创建工程" class="header-anchor">#</a> 2.2.创建工程</h3> <p>本案例工程使用maven进行构建，使用SpringMVC、Servlet3.0实现。</p> <h4 id="_2-2-1-创建maven工程"><a href="#_2-2-1-创建maven工程" class="header-anchor">#</a> 2.2.1 创建maven工程</h4> <p>创建maven工程 security-springmvc，工程结构如下：</p> <p><img src="/assets/img/Snipaste_2020-03-28_17-46-37.bdb78e87.jpg" alt="img"></p> <p>引入如下依赖如下，注意：
1、由于是web工程，packaging设置为war
2、使用tomcat7-maven-plugin插件来运行工程</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.jjane.security<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>security-springmvc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>packaging</span><span class="token punctuation">&gt;</span></span>war<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>packaging</span><span class="token punctuation">&gt;</span></span>


    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project.build.sourceEncoding</span><span class="token punctuation">&gt;</span></span>UTF‐8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project.build.sourceEncoding</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>


    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-webmvc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>5.1.14.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>javax.servlet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>javax.servlet-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.1.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>provided<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.18.12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>


    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>finalName</span><span class="token punctuation">&gt;</span></span>security‐springmvc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>finalName</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pluginManagement</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.tomcat.maven<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>tomcat7‐maven‐plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>

                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.maven.plugins<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>maven‐compiler‐plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>source</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>source</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>target</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>target</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>maven‐resources‐plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>encoding</span><span class="token punctuation">&gt;</span></span>utf‐8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>encoding</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>useDefaultDelimiters</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>useDefaultDelimiters</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resources</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resource</span><span class="token punctuation">&gt;</span></span>
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>directory</span><span class="token punctuation">&gt;</span></span>src/main/resources<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>directory</span><span class="token punctuation">&gt;</span></span>
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filtering</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filtering</span><span class="token punctuation">&gt;</span></span>
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>includes</span><span class="token punctuation">&gt;</span></span>
                                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span><span class="token punctuation">&gt;</span></span>**/*<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>include</span><span class="token punctuation">&gt;</span></span>
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>includes</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resource</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resource</span><span class="token punctuation">&gt;</span></span>
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>directory</span><span class="token punctuation">&gt;</span></span>src/main/java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>directory</span><span class="token punctuation">&gt;</span></span>
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>includes</span><span class="token punctuation">&gt;</span></span>
                                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span><span class="token punctuation">&gt;</span></span>**/*.xml<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>include</span><span class="token punctuation">&gt;</span></span>
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>includes</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resource</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resources</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pluginManagement</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br></div></div><h4 id="_2-2-2-spring-容器配置"><a href="#_2-2-2-spring-容器配置" class="header-anchor">#</a> 2.2.2 Spring  容器配置</h4> <p>在config包下定义<code>ApplicationConfig.java</code>，它对应web.xml中ContextLoaderListener的配置</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>jjane<span class="token punctuation">.</span>security<span class="token punctuation">.</span>springmvc<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">ComponentScan</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">Configuration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">FilterType</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype</span><span class="token punctuation">.</span><span class="token class-name">Controller</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * Spring 容器配置  【相当于applicationContext.xml】
 */</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span>basePackages <span class="token operator">=</span> <span class="token string">&quot;com.jjane.security.springmvc&quot;</span><span class="token punctuation">,</span> excludeFilters <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">.</span><span class="token class-name">Filter</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">FilterType</span><span class="token punctuation">.</span>ANNOTATION<span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token class-name">Controller</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ApplicationConfig</span> <span class="token punctuation">{</span>
    <span class="token comment">//在此配置除了Controller的其它bean，比如：数据库链接池、事务管理器、业务bean等</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h4 id="_2-2-3-servletcontext配置"><a href="#_2-2-3-servletcontext配置" class="header-anchor">#</a> 2.2.3 servletContext配置</h4> <p>本案例采用Servlet3.0无web.xml方式，在config包下定义<code>WebConfig.java</code>，它对应于DispatcherServlet配
置。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>jjane<span class="token punctuation">.</span>security<span class="token punctuation">.</span>springmvc<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">Bean</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">ComponentScan</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">Configuration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">FilterType</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype</span><span class="token punctuation">.</span><span class="token class-name">Controller</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>config<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">EnableWebMvc</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>config<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">WebMvcConfigurer</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>view</span><span class="token punctuation">.</span><span class="token class-name">InternalResourceViewResolver</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * SpringMVC的servletContext配置  【相当于springmvc.xml】
 */</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@EnableWebMvc</span>
<span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span>basePackages <span class="token operator">=</span> <span class="token string">&quot;com.jjane.security.springmvc&quot;</span><span class="token punctuation">,</span> includeFilters <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">.</span><span class="token class-name">Filter</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">FilterType</span><span class="token punctuation">.</span>ANNOTATION<span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token class-name">Controller</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebConfig</span> <span class="token keyword">implements</span> <span class="token class-name">WebMvcConfigurer</span> <span class="token punctuation">{</span>

    <span class="token comment">/**
     * 视图解析器
     *
     * @return
     */</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">InternalResourceViewResolver</span> <span class="token function">viewResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">InternalResourceViewResolver</span> viewResolver <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InternalResourceViewResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        viewResolver<span class="token punctuation">.</span><span class="token function">setPrefix</span><span class="token punctuation">(</span><span class="token string">&quot;/WEB‐INF/views/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        viewResolver<span class="token punctuation">.</span><span class="token function">setSuffix</span><span class="token punctuation">(</span><span class="token string">&quot;.jsp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> viewResolver<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><h4 id="_2-2-4-加载-spring容器"><a href="#_2-2-4-加载-spring容器" class="header-anchor">#</a> 2.2.4 加载 Spring容器</h4> <p>在init包下定义Spring容器初始化类<code>SpringApplicationInitializer</code>，此类实现WebApplicationInitializer接口，Spring容器启动时加载WebApplicationInitializer接口的所有实现类。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>jjane<span class="token punctuation">.</span>security<span class="token punctuation">.</span>springmvc<span class="token punctuation">.</span>init</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>jjane<span class="token punctuation">.</span>security<span class="token punctuation">.</span>springmvc<span class="token punctuation">.</span>config</span><span class="token punctuation">.</span><span class="token class-name">ApplicationConfig</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>jjane<span class="token punctuation">.</span>security<span class="token punctuation">.</span>springmvc<span class="token punctuation">.</span>config</span><span class="token punctuation">.</span><span class="token class-name">WebConfig</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>support</span><span class="token punctuation">.</span><span class="token class-name">AbstractAnnotationConfigDispatcherServletInitializer</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 容器启动类
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringApplicationInitializer</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractAnnotationConfigDispatcherServletInitializer</span> <span class="token punctuation">{</span>

    <span class="token comment">/**
     * 加载Spring容器，相当于加载applicationContext.xml
     *
     * @return
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getRootConfigClasses</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token class-name">ApplicationConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 加载SpringMvc的servletContext容器，相当于加载springmvc.xml
     *
     * @return
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getServletConfigClasses</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token class-name">WebConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * url-mapping 配置
     *
     * @return
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getServletMappings</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div></div><p>SpringApplicationInitializer相当于web.xml，使用了servlet3.0开发则不需要再定义web.xml。
ApplicationConfig.class对应以下配置的application-context.xml，WebConfig.class对应以下配置的spring-
mvc.xml，web.xml的内容参考：</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>web‐app</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>listener</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>listener‐class</span><span class="token punctuation">&gt;</span></span>org.springframework.web.context.ContextLoaderListener<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>listener‐class</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>listener</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>context‐param</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param‐name</span><span class="token punctuation">&gt;</span></span>contextConfigLocation<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param‐name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param‐value</span><span class="token punctuation">&gt;</span></span>/WEB‐INF/application‐context.xml<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param‐value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>context‐param</span><span class="token punctuation">&gt;</span></span>
 
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet‐name</span><span class="token punctuation">&gt;</span></span>springmvc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet‐name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet‐class</span><span class="token punctuation">&gt;</span></span>org.springframework.web.servlet.DispatcherServlet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet‐class</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>init‐param</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param‐name</span><span class="token punctuation">&gt;</span></span>contextConfigLocation<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param‐name</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param‐value</span><span class="token punctuation">&gt;</span></span>/WEB‐INF/spring‐mvc.xml<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param‐value</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>init‐param</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>load‐on‐startup</span><span class="token punctuation">&gt;</span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>load‐on‐startup</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet‐mapping</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet‐name</span><span class="token punctuation">&gt;</span></span>springmvc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet‐name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url‐pattern</span><span class="token punctuation">&gt;</span></span>/<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url‐pattern</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet‐mapping</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>web‐app</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h3 id="_2-3-实现认证功能"><a href="#_2-3-实现认证功能" class="header-anchor">#</a> 2.3.实现认证功能</h3> <h4 id="_2-3-1-认证页面"><a href="#_2-3-1-认证页面" class="header-anchor">#</a> 2.3.1  认证页面</h4> <p>在webapp/WEB-INF/views下定义认证页面login.jsp。本案例只是测试认证流程，页面没有添加css样式，页面实
现可填入用户名，密码，触发登录将提交表单信息至/login。</p> <p><code>login.jsp</code> 文件内容如下：</p> <div class="language-jsp line-numbers-mode"><pre class="language-text"><code>&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;用户登录&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;form action=&quot;login&quot;  method=&quot;post&quot;&gt;
        用户名：&lt;input type=&quot;text&quot;  name=&quot;username&quot;&gt;&lt;br&gt;
        密&amp;nbsp;&amp;nbsp;&amp;nbsp;码:
        &lt;input type=&quot;password&quot;  name=&quot;password&quot;&gt;&lt;br&gt;
        &lt;input type=&quot;submit&quot;  value=&quot;登录&quot;&gt;
&lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>在 WebConfig 中新增如下配置，将 / 直接导向login.jsp页面：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addViewControllers</span><span class="token punctuation">(</span><span class="token class-name">ViewControllerRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    registry<span class="token punctuation">.</span><span class="token function">addViewController</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setViewName</span><span class="token punctuation">(</span><span class="token string">&quot;login&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>启动项目，访问/路径地址，进行测试</p> <p><img src="data:image/jpeg;base64,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v93W9ultz3Tz/pR5/wBK+LJfg7dCR9vwM8UOMnDf8LPmGffH2msPSvD+p+Bv2hvhQieCde8C2t9e3cU5vfGMurx3YFnOwQxmZwMEBskfw1pSh7Wajte/4Jv9BSfLFy7H3f5/0rGt5N/xK0//ALBdx/6Miqx59Zumyb/iZYf9gu4/9GRVmM9BooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACvNb+TZ8RNeGf+XW0/9q16VXlesybPiRrw/wCnS0/9q0AaVysV5bywTKHilQo6nupGCK+SfjE+o+APjBZabbN490TwLc6ZDHZReBEiAlvjJL5gkMgOW2mOvqeaV3idUfy3KkK+M7T2OO9eC/EX9n3xr8TtKk03WfiuzWfnefB5fhy1WW3cHKtHIGyrD+8Oai3vxf3+m34XuvM0jJKMk+qt6bP8bWfkeS/E7xxN4N8I3102sfHzT76SJ0sm1NLUQvNtJUMAuSODnHYGvadI+DHhbx38GdO1LU9N0+LxBq+j2s91qOoLIYzc+ShEkkayIDhsEgFc1jeIf2bfGfizxFomtav8WDqF3owY2SXHhq1eKNzx5mwtjeBkBuoBPrXap8H9R8T6dJp3xD8WSeONNMgcWLafHZQOBjKypGSJVOPutxzWj1puLSu3+C/q/TZepm21KLXRfj/krfiz5Y+Ingz4fR/DDxbotho2m6j4x0tFRvEHh5rhbeJ/MUAyo0h8otk4UM+cNyMV1Gn/AAX8PeIPFuk+EIvhnoGm6rpaxPqeuaxcznzRgbmtYd43+YMjdvGzd0bHPt3i74DXfiLT4vDmn+KU8O+AEWNP+EZ07SIUQIrbtqyghlBOOg7V3vjHwBoHju0totXskmmtCWs7xDsuLRypXfDIPmRsEjcOeatSUUpLV31v6K22i1u7bPZhP3korS19fVr8kt+nQ6nRdPtNA0q106xhW2tLaMRxwqSQgHYE80uhyb/idY/9gq4/9GxVn6RZpo2mW1kk9xcpAgQTXczTSv7s7csfc1P4Zk3/ABRsv+wVcf8Ao2Gobu2yYqySPU6KKKRQUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFefeKPAWs3/AIoutW0q9sYluYYopI7yN2I2bsEbSP7xr0GigDy7/hAvF/8A0ENE/wC/M3/xVH/CBeL/APoIaJ/35m/+Kr1GigDy7/hAvF//AEENE/78zf8AxVH/AAgXi/8A6CGif9+Zv/iq9RooA8u/4QLxf/0ENE/78zf/ABVH/CBeL/8AoIaJ/wB+Zv8A4qvUaKAPLv8AhAvF/wD0ENE/78zf/FVp+EfAer6V4oXWNVvLKYx2r2yR2cbr95lYk7if7n6131FABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAf/9k=" alt="img"></p> <h4 id="_2-3-2-认证接口"><a href="#_2-3-2-认证接口" class="header-anchor">#</a> 2.3.2 认证接口</h4> <p>用户进入认证页面，输入账号和密码，点击登录，请求/login进行身份认证。</p> <p>（1）定义认证接口，此接口用于对传来的用户名、密码校验，若成功则返回该用户的详细信息，否则抛出错误异
常：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>jjane<span class="token punctuation">.</span>security<span class="token punctuation">.</span>springmvc<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>jjane<span class="token punctuation">.</span>security<span class="token punctuation">.</span>springmvc<span class="token punctuation">.</span>model</span><span class="token punctuation">.</span><span class="token class-name">AuthenticationRequest</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>jjane<span class="token punctuation">.</span>security<span class="token punctuation">.</span>springmvc<span class="token punctuation">.</span>model</span><span class="token punctuation">.</span><span class="token class-name">UserDto</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 认证服务
 */</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">AuthenticationService</span> <span class="token punctuation">{</span>

    <span class="token comment">/**
     * 用户认证
     *
     * @param authenticationRequest 用户认证请求
     * @return 认证成功的用户信息      
     */</span>
    <span class="token class-name">UserDto</span> <span class="token function">authentication</span><span class="token punctuation">(</span><span class="token class-name">AuthenticationRequest</span> authenticationRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>认证请求结构：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>jjane<span class="token punctuation">.</span>security<span class="token punctuation">.</span>springmvc<span class="token punctuation">.</span>model</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> lombok<span class="token punctuation">.</span><span class="token class-name">Data</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 登录认证请求
 */</span>
<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AuthenticationRequest</span> <span class="token punctuation">{</span>

    <span class="token comment">/**
     * 用户名
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 密码
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>认证成功后返回的用户详细信息，也就是当前登录用户的信息：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>jjane<span class="token punctuation">.</span>security<span class="token punctuation">.</span>springmvc<span class="token punctuation">.</span>model</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> lombok<span class="token punctuation">.</span><span class="token class-name">AllArgsConstructor</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> lombok<span class="token punctuation">.</span><span class="token class-name">Data</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 登录用户信息
 */</span>
<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserDto</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> id<span class="token punctuation">;</span>

    <span class="token comment">/** 用户名 */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span>

    <span class="token comment">/** 密码 */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span>

    <span class="token comment">/** 全名 */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> fullname<span class="token punctuation">;</span>
    
    <span class="token comment">/** 手机号 */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> mobile<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p>（2）认证实现类，根据用户名查找用户信息，并校验密码，这里模拟了两个用户：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>jjane<span class="token punctuation">.</span>security<span class="token punctuation">.</span>springmvc<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>jjane<span class="token punctuation">.</span>security<span class="token punctuation">.</span>springmvc<span class="token punctuation">.</span>model</span><span class="token punctuation">.</span><span class="token class-name">AuthenticationRequest</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>jjane<span class="token punctuation">.</span>security<span class="token punctuation">.</span>springmvc<span class="token punctuation">.</span>model</span><span class="token punctuation">.</span><span class="token class-name">UserDto</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>jjane<span class="token punctuation">.</span>security<span class="token punctuation">.</span>springmvc<span class="token punctuation">.</span>service</span><span class="token punctuation">.</span><span class="token class-name">AuthenticationService</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype</span><span class="token punctuation">.</span><span class="token class-name">Service</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>util</span><span class="token punctuation">.</span><span class="token class-name">StringUtils</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util</span><span class="token punctuation">.</span><span class="token class-name">HashMap</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util</span><span class="token punctuation">.</span><span class="token class-name">Map</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 认证实现类
 */</span>
<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AuthenticationServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">AuthenticationService</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">UserDto</span> <span class="token function">authentication</span><span class="token punctuation">(</span><span class="token class-name">AuthenticationRequest</span> authenticationRequest<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//校验参数是否为空</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>authenticationRequest <span class="token operator">==</span> <span class="token keyword">null</span>
                <span class="token operator">||</span> <span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>authenticationRequest<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token operator">||</span> <span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>authenticationRequest<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;账号和密码为空&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//根据账号去查询数据库,这里测试程序采用模拟方法</span>
        <span class="token class-name">UserDto</span> user <span class="token operator">=</span> <span class="token function">getUserDto</span><span class="token punctuation">(</span>authenticationRequest<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//判断用户是否为空</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>user <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;查询不到该用户&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//校验密码</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>authenticationRequest<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;账号或密码错误&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//认证通过，返回用户身份信息</span>
        <span class="token keyword">return</span> user<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token comment">//模拟用户查询</span>
    <span class="token keyword">public</span> <span class="token class-name">UserDto</span> <span class="token function">getUserDto</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> userMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//用户信息</span>
    <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">UserDto</span><span class="token punctuation">&gt;</span></span> userMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">{</span>
        userMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;zhangsan&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">UserDto</span><span class="token punctuation">(</span><span class="token string">&quot;1010&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;zhangsan&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;123&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;张三&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;133443&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        userMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;lisi&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">UserDto</span><span class="token punctuation">(</span><span class="token string">&quot;1011&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;lisi&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;456&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;李四&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;144553&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br></div></div><p>（ 3）登录Controller，对/login请求处理，它调用AuthenticationService完成认证并返回登录结果提示信息：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>jjane<span class="token punctuation">.</span>security<span class="token punctuation">.</span>springmvc<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>jjane<span class="token punctuation">.</span>security<span class="token punctuation">.</span>springmvc<span class="token punctuation">.</span>model</span><span class="token punctuation">.</span><span class="token class-name">AuthenticationRequest</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>jjane<span class="token punctuation">.</span>security<span class="token punctuation">.</span>springmvc<span class="token punctuation">.</span>model</span><span class="token punctuation">.</span><span class="token class-name">UserDto</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>jjane<span class="token punctuation">.</span>security<span class="token punctuation">.</span>springmvc<span class="token punctuation">.</span>service</span><span class="token punctuation">.</span><span class="token class-name">AuthenticationService</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">GetMapping</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">RequestMapping</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">RestController</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http</span><span class="token punctuation">.</span><span class="token class-name">HttpSession</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 登录Controller
 *
 * @author RyuZheng
 * @version 1.0
 **/</span>
<span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LoginController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">AuthenticationService</span> authenticationService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/login&quot;</span><span class="token punctuation">,</span> produces <span class="token operator">=</span> <span class="token string">&quot;text/plain;charset=utf-8&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token class-name">AuthenticationRequest</span> authenticationRequest<span class="token punctuation">,</span> <span class="token class-name">HttpSession</span> session<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">UserDto</span> userDto <span class="token operator">=</span> authenticationService<span class="token punctuation">.</span><span class="token function">authentication</span><span class="token punctuation">(</span>authenticationRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//存入session</span>
        session<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token class-name">UserDto</span><span class="token punctuation">.</span>SESSION_USER_KEY<span class="token punctuation">,</span> userDto<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> userDto<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;登录成功&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/logout&quot;</span><span class="token punctuation">,</span> produces <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;text/plain;charset=UTF-8&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">logout</span><span class="token punctuation">(</span><span class="token class-name">HttpSession</span> session<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        session<span class="token punctuation">.</span><span class="token function">invalidate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">&quot;退出成功&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/r/r1&quot;</span><span class="token punctuation">,</span> produces <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;text/plain;charset=UTF-8&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">r1</span><span class="token punctuation">(</span><span class="token class-name">HttpSession</span> session<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> fullname <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token class-name">Object</span> object <span class="token operator">=</span> session<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token class-name">UserDto</span><span class="token punctuation">.</span>SESSION_USER_KEY<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>object <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            fullname <span class="token operator">=</span> <span class="token string">&quot;匿名&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token class-name">UserDto</span> userDto <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">UserDto</span><span class="token punctuation">)</span> object<span class="token punctuation">;</span>
            fullname <span class="token operator">=</span> userDto<span class="token punctuation">.</span><span class="token function">getFullname</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> fullname <span class="token operator">+</span> <span class="token string">&quot;访问资源r1&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/r/r2&quot;</span><span class="token punctuation">,</span> produces <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;text/plain;charset=UTF-8&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">r2</span><span class="token punctuation">(</span><span class="token class-name">HttpSession</span> session<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> fullname <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token class-name">Object</span> userObj <span class="token operator">=</span> session<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token class-name">UserDto</span><span class="token punctuation">.</span>SESSION_USER_KEY<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>userObj <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            fullname <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">UserDto</span><span class="token punctuation">)</span> userObj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getFullname</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            fullname <span class="token operator">=</span> <span class="token string">&quot;匿名&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> fullname <span class="token operator">+</span> <span class="token string">&quot; 访问资源2&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br></div></div><p>（4）测试
启动项目，访问/路径地址，进行测试</p> <p><img src="data:image/jpeg;base64,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beKdJsrSz02W30nxVrp1WaEubjc6yebIAG2rwG/hrxzxB4V8F+NPFHw6l8C6LfS2U9zcnUIrfWr6e01KOKHeyQTCb5yMEAr0YEHOK9L+B/wp8LeMfHMnizSPAcHhzQrVvKWe61q9m1G5mU/KXQzARhMt8jq2d4wRznppe7zKXVP7k1r96sv0WpjVVopdXZr73p+GvkfYfn1D8N233Xik/wDUU/8AaEVVvPFSfC5t8vik/wDUVP8A6IirnLO6ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAK8Y8JTY0dhn/l7uv/R8lez15TB8NfE2m+dDZXuktamaWVDOsu/Duz4OOP4qAKPim31fVNEnt9E1ePQ9SfHl30loLpY/+2ZZQfzrxLU/2fviFqnjfS/Fr/Fm1h1zT0eJJ4PC0SebGykFJB5/zKM5A9QDXv8A/wAIJ4w/5+9E/wC+JqP+EE8Yf8/eif8AfE1C0fMt/wCl+Q27qx896T+zn470jxrqvixPinZXGv6jtWS8ufCkUjRoo4jjzP8AKo5OB3Y+tdzN8EdP8UvY3vj27j8a6xZrmCW5tRFaxSAgrIluGYK4x1z3Nel/8IJ4w/5+9E/74mo/4QTxh/z96J/3xNRtby28vTsJ6u7PLNH+EevH4haV4l8ReMo9ag0cznTtOtdJSyWHzVKHcyyNvwpx0HTNdLq3wv0LU/EqeIIBc6RrWU8690uYwSXKLnbHKQPmT5jxXXf8IJ4w/wCfvRP++JqP+EE8Yf8AP3on/fE1O793y2++4mr3v1JPP96v/CV97eKT/wBRU/8AoiKsz/hBPGH/AD96J/3xNXT/AA+8J3nhWz1EX08E91e3RuX+zghF+RVwM8/w/rSGdXRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAf//Z" alt="img"></p> <p>填入错误的用户信息，页面返回错误信息：</p> <p><img src="/assets/img/Snipaste_2020-03-28_17-38-15.a9067b31.jpg" alt="img"></p> <p>填入正确的用户信息，页面提示登录成功：</p> <p><img src="data:image/jpeg;base64,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" alt="img"></p> <p>以上的测试全部符合预期，到目前为止最基础的认证功能已经完成，它仅仅实现了对用户身份凭证的校验，若某用
户认证成功，只能说明他是该系统的一个合法用户，仅此而已。</p> <h3 id="_2-4-实现会话功能"><a href="#_2-4-实现会话功能" class="header-anchor">#</a> 2.4.实现会话功能</h3> <p>会话是指用户登入系统后，系统会记住该用户的登录状态，他可以在系统连续操作直到退出系统的过程。</p> <p>认证的目的是对系统资源的保护，每次对资源的访问，系统必须得知道是谁在访问资源，才能对该请求进行合法性
拦截。因此，在认证成功后，一般会把认证成功的用户信息放入Session中，在后续的请求中，系统能够从Session中获取到当前用户，用这样的方式来实现会话机制。</p> <p>（1）增加会话控制
首先在UserDto中定义一个SESSION_USER_KEY，作为Session中存放登录用户信息的key。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> SESSION_USER_KEY <span class="token operator">=</span> <span class="token string">&quot;_user&quot;</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>然后修改LoginController，认证成功后，将用户信息放入当前会话。并增加用户登出方法，登出时将session置为
失效。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * 用户登录
 * @param authenticationRequest 登录请求
 * @param session http会话
 * @return
 */</span>
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/login&quot;</span><span class="token punctuation">,</span>produces <span class="token operator">=</span> <span class="token string">&quot;text/plain;charset=utf‐8&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token class-name">AuthenticationRequest</span> authenticationRequest<span class="token punctuation">,</span> <span class="token class-name">HttpSession</span> session<span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token class-name">UserDto</span> userDto <span class="token operator">=</span> authenticationService<span class="token punctuation">.</span><span class="token function">authentication</span><span class="token punctuation">(</span>authenticationRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//用户信息存入session</span>
      session<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token class-name">UserDto</span><span class="token punctuation">.</span>SESSION_USER_KEY<span class="token punctuation">,</span>userDto<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> userDto<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;登录成功&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;logout&quot;</span><span class="token punctuation">,</span>produces <span class="token operator">=</span> <span class="token string">&quot;text/plain;charset=utf‐8&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">logout</span><span class="token punctuation">(</span><span class="token class-name">HttpSession</span> session<span class="token punctuation">)</span><span class="token punctuation">{</span>
     session<span class="token punctuation">.</span><span class="token function">invalidate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">return</span> <span class="token string">&quot;退出成功&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>（2）增加测试资源
修改LoginController，增加测试资源1，它从当前会话session中获取当前登录用户，并返回提示信息给前台。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * 测试资源1
 *
 * @return
 * @param session
 */</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/r/r1&quot;</span><span class="token punctuation">,</span> produces <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;text/plain;charset=UTF-8&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">r1</span><span class="token punctuation">(</span><span class="token class-name">HttpSession</span> session<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> fullname <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token class-name">Object</span> object <span class="token operator">=</span> session<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token class-name">UserDto</span><span class="token punctuation">.</span>SESSION_USER_KEY<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>object <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        fullname <span class="token operator">=</span> <span class="token string">&quot;匿名&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token class-name">UserDto</span> userDto <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">UserDto</span><span class="token punctuation">)</span> object<span class="token punctuation">;</span>
        fullname <span class="token operator">=</span> userDto<span class="token punctuation">.</span><span class="token function">getFullname</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> fullname <span class="token operator">+</span> <span class="token string">&quot;访问资源r1&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>（3）测试
未登录情况下直接访问测试资源/r/r1：</p> <p><img src="data:image/jpeg;base64,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" alt="img"></p> <p>成功登录的情况下访问测试资源/r/r1：</p> <p><img src="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD//gAUU29mdHdhcmU6IFNuaXBhc3Rl/9sAQwADAgIDAgIDAwMDBAMDBAUIBQUEBAUKBwcGCAwKDAwLCgsLDQ4SEA0OEQ4LCxAWEBETFBUVFQwPFxgWFBgSFBUU/9sAQwEDBAQFBAUJBQUJFA0LDRQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQU/8AAEQgALwEdAwEiAAIRAQMRAf/EAB8AAAEFAQEBAQEBAAAAAAAAAAABAgMEBQYHCAkKC//EALUQAAIBAwMCBAMFBQQEAAABfQECAwAEEQUSITFBBhNRYQcicRQygZGhCCNCscEVUtHwJDNicoIJChYXGBkaJSYnKCkqNDU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6g4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2drh4uPk5ebn6Onq8fLz9PX29/j5+v/EAB8BAAMBAQEBAQEBAQEAAAAAAAABAgMEBQYHCAkKC//EALURAAIBAgQEAwQHBQQEAAECdwABAgMRBAUhMQYSQVEHYXETIjKBCBRCkaGxwQkjM1LwFWJy0QoWJDThJfEXGBkaJicoKSo1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoKDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uLj5OXm5+jp6vLz9PX29/j5+v/aAAwDAQACEQMRAD8A/VOiiigAooooAKKKKACiiigAooooAKikuoYpooXlRJZc+XGzAM+Bk4HfArjfi5b6g3hb7VZeP0+HENpKJbrWJra1mj8sgrsc3AKKCzLzwcgDvXxB4/8A+F8eJvjJ8NdV8L+P7jWdLSbVF0e71DQ7C2ur7y7bNy9umwJtdAY42m2gsN4+RlYgH6LUV4n8Br7WPEl4+pz/ABfm8bW8UGy68P3OkWVlcWUrH5fPWNFljYbXAVgM8nnivEfEHxC+L918NvEvjqw+KMumJb+OpfDdtpKaDYyRRW/9sixU72jLMwRt3J5I5oA+2qK+V7bT/jBP8b9e8DH41XgtNO8O2mtJdDw3p3mO809xEUI8vGAIAc9fmNeufs0+M9X+InwD8C+JdfuVvNa1PS4rm7uEiWISSEcsFUAL9AKAPTKKgvb230yznvLy4itLS3jaWaedwkcaKMszMeAAASSeleD2/iPX7rXvHerfC7x34O8YaZLFa3qaRfaq94LK4/ei5ctCXaNHRIAkYIUMkhwCxJAPeoLqG6DmGVJgjmNjGwbawOCpx0IPUUXF1DaKrTzRwq7iNTIwUFicBRnuTwBXyN+z7J8cvFWgSfEzRIPh9Y6V49tbPWo9FnmvlSydoiXYBUx5khfc7d2GcmvT/Guoanrd38PPh9490rSLu58WNqAvrjR5pkWzktoTNDLayNh0kHykPwysMqRgGgD2+ivjH4j678CIfG/iJda8XfFK2vbG++xajLpeoeIF0+2nG1SnmQ/uUxuXODjn3rtvB3hKy+CH7SN5p9jrninUdBbwPcarc2mr6ze6sRJHeRLvjSV3O7ZkAIMnOOc0AfS5OBUdtdQ3tvHPbypPBINySRMGVh6gjg18z/Dv4r694otNbsfhbBe+LtDtb97aW88XLLZS6XPMqv5DLMFuHSLf5zM6k7JlWPO3aPKvASfETwXbXPgjwb8WdRn0DT7WKy8HOPD9gIdVljJFzEtxMgRhGWRlO7MqCQpu2HAB95UV5h408XHwH8P/AA3YeO5ri5/tdLfQdX17SXMCw3lwqwLIgTEi+bO4VTGMoXBO0AkfHvxb1S/8D/E3VbP4k6/4m8RXGl6BoVlaweG/FM2h2z3N1d6kolkfzoYx+7ghVnc5+XOaAP0Ror82/gLrOhXPjXwR4d8Vz+OJvEuv6o6xXFh8U11GztpFjkuBEYYL55GhURMoaRfmyN3Jr7F+OPxo8QfCrWvCVrp/g2bVtJ1nWNO0y5117qJLezNzdLCVMe8Ss+GBBCleRk9aAPX6KKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA8c+Nr+EbHxP4f1HxD8P8AxP41vraKU2r6Jpk99bwgkBlmjRhGSc5AdT0yMYr5M+Mmp38muaDcaBq3x3tPGzz3Mfhm0ufDttHb2CyJido4vs2ZI4ojkx7slVwGB5r9Fq89m+EEN38WLLxtd63qF4tgJZLHS533RWs8sQhlZDnhGjVf3eMBtzZy2KAPKPh3d+FtZ8R+Dl1T4f8AxDufFli2P+Er1nw/NYCaYj5prp4tkbdOrqQO3U1w3wM0S8+KTal4euoWs/Bug/EPXtT1Zr35YtVkXULh7aCLoSI5fKmLg4DRbCDmvtKvEov2Lvgw17ql7f8AgLS9a1DU7+41K5vNThE0zyzStI/zH+EMxwOwwKAH/Er4e+JH8d3PjjwB4n0LSdbvNJj0jUI9fs3vLd7eGSWWMxLHLEVfdNJklmBG3AGDlf2L93/DKnwu3kM/9hwbiowCcdqVv2MPgaykf8Ku8NjIxkWS16N8O/AWk/C7wPonhLQo5ItH0e2S0tEmfe6xr0BbvQBu3NtDeW8tvcRJPBKpSSKRQyupGCCDwQR2r5A1Xxr4K+Cf7V/xOsriO00KDUfBOjeXb2NssaACfURJO6qAFRN0e5z03LmvsSvOfHnwQ0Lx/wCI4tSvo4Y7e4hS31i3S3G/VoY2LQQTSZz5KM8pMeCG8ztigD5Nh/Zw0H4Z/sXeC/ENxoWpaB4/sLbQPtTyajdxyQXDXlqkytEZdg4Z1K7cc9K+kfir/wAnE/A3/rtrX/pDXSeK/g/D408Vx32ra3qF34czFPN4akfNpLcREeU5GfuA/MY8YLqj5BQA6fij4dxeJviB4K8UvfPbyeGXvGS2EYYXH2iDyjls/Lt69DmgD4z+JPxGGlfC/wDaG8LHwx4mu5bzxndMuq2mkySafGGe0+/OPlXG3n0yPWvpWf8A5PJsf+xCuP8A04w17IYYyrKUUqxywxwT71wPhj4Qw+H/AIlap4yuNav9XvLi2ksbOK8fd9jt5JhPJEGz8w8xRt4GxQFGetAHz78VvgLZ/F39oHxt4OfxV4j8HeGJ9C0/xPf2/hu6S3+26g008BmkkdHYHyraFcKVHy8g1yeneEJPEvgf4E6hP418Wax4X8X6zbWlz4V1maz8qC2a0upAFe3t4ZEYNEuGRl4JHevo68+BeueM9RuB498d3PiPQTITHomn2K6bBLEScw3W12+0xlcDawHc961vGv7P/hjxZrCa/ZrceGPFcUSQR6/okn2e68pB8sLsPvxZwSnAO0UAZf7QHiHWvhL8F7++8I+DbHxTFoWmy3CwanfCOOyS2gLxSkOGaYqY1OAQxx94HmvkLVPhVpvijxBfeZ4l1SLRbSx8Lxf2pbwJf3l1qcc+oXM1hCHVlecLeREKythWTIOa+/NZ8Ix+LPAN94X8Q3LahFqWmPpuoXMC+QZxJEY5XUAnYWyxABOM98VyOifs8eEvDXhSLSNLS7tL6FJhDr/nltSSSVI0eXz+pcrDCpb0jUdqAPk74QfCa0Hxj8Larq/jnUvtnh7xzrNnYQ6jplnFa3qWyXFskCywQREXJRzJgkgrHIQoxkfR/wC1pPFH4R8FK8iK3/Cc+HmwzAHH9ow8113gz4L6P4e8FXWgav5fiRtQ1GTWNSnuoAqXN7JKJnlWPJEY8wBgoJ24HNP+InwC+HXxb1K11Dxn4N0jxLe2sQghn1G2ErRoGLBQT0GST+NAHeo6yKGRgynoQcg06szwz4Z0rwboNlomh2EGl6TZRiK2s7ZdscSD+FR2FadABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFAH//Z" alt="img"></p> <p>测试结果说明，在用户登录成功时，该用户信息已被成功放入session，并且后续请求可以正常从session中获取当
前登录用户信息，符合预期结果。</p> <h3 id="_2-5-实现授权功能"><a href="#_2-5-实现授权功能" class="header-anchor">#</a> 2.5.实现授权功能</h3> <p>现在我们已经完成了用户身份凭证的校验以及登录的状态保持，并且我们也知道了如何获取当前登录用户(从
Session中获取)的信息，接下来，用户访问系统需要经过授权，即需要完成如下功能：</p> <ul><li><p>匿名用户（未登录用户）访问拦截：禁止匿名用户访问某些资源。</p></li> <li><p>登录用户访问拦截：根据用户的权限决定是否能访问某些资源。</p></li></ul> <p>（1）增加权限数据
为了实现这样的功能，我们需要在UserDto里增加权限属性，用于表示该登录用户所拥有的权限，同时修改
UserDto的构造方法。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserDto</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> SESSION_USER_KEY <span class="token operator">=</span> <span class="token string">&quot;_user&quot;</span><span class="token punctuation">;</span>
    
    <span class="token keyword">private</span> <span class="token class-name">String</span> id<span class="token punctuation">;</span>
    
    <span class="token comment">/** 用户名 */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span>

    <span class="token comment">/** 密码 */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span>

    <span class="token comment">/** 全名 */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> fullname<span class="token punctuation">;</span>
    
    <span class="token comment">/**
     * 用户权限
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> authorities<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>并在AuthenticationServiceImpl中为模拟用户初始化权限，其中张三给了p1权限，李四给了p2权限。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//用户信息</span>
    <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">UserDto</span><span class="token punctuation">&gt;</span></span> userMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">{</span>
        <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> authorities1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        authorities1<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;p1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//这个p1我们人为让它和/r/r1对应</span>
        <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> authorities2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        authorities2<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;p2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//这个p2我们人为让它和/r/r2对应</span>
        userMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;zhangsan&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">UserDto</span><span class="token punctuation">(</span><span class="token string">&quot;1010&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;zhangsan&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;123&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;张三&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;133443&quot;</span><span class="token punctuation">,</span> authorities1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        userMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;lisi&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">UserDto</span><span class="token punctuation">(</span><span class="token string">&quot;1011&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;lisi&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;456&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;李四&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;144553&quot;</span><span class="token punctuation">,</span> authorities2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>（2）增加测试资源
我们想实现针对不同的用户能访问不同的资源，前提是得有多个资源，因此在LoginController中增加测试资源2。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * 测试资源2
 * @param session
 * @return
 */</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/r/r2&quot;</span><span class="token punctuation">,</span>produces <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;text/plain;charset=UTF‐8&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">r2</span><span class="token punctuation">(</span><span class="token class-name">HttpSession</span> session<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">String</span> fullname <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token class-name">Object</span> userObj <span class="token operator">=</span> session<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token class-name">UserDto</span><span class="token punctuation">.</span>SESSION_USER_KEY<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>userObj <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        fullname <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">UserDto</span><span class="token punctuation">)</span>userObj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getFullname</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
        fullname <span class="token operator">=</span> <span class="token string">&quot;匿名&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> fullname <span class="token operator">+</span> <span class="token string">&quot; 访问资源2&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>（3）实现授权拦截器
在interceptor包下定义SimpleAuthenticationInterceptor拦截器，实现授权拦截：
1、校验用户是否登录
2、校验用户是否拥有操作权限</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * 授权拦截器
 *
 * @author RyuZheng
 * @version 1.0
 **/</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SimpleAuthenticationInterceptor</span> <span class="token keyword">implements</span> <span class="token class-name">HandlerInterceptor</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">preHandle</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">Object</span> handler<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">//在这个方法中校验用户请求的url是否在用户的权限范围内</span>
        <span class="token comment">//取出用户身份信息</span>
        <span class="token class-name">Object</span> object <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token class-name">UserDto</span><span class="token punctuation">.</span>SESSION_USER_KEY<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>object <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">//没有认证，提示登录</span>
            <span class="token function">writeContent</span><span class="token punctuation">(</span>response<span class="token punctuation">,</span><span class="token string">&quot;请登录&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">UserDto</span> userDto <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">UserDto</span><span class="token punctuation">)</span> object<span class="token punctuation">;</span>
        <span class="token comment">//请求的url</span>
        <span class="token class-name">String</span> requestURI <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getRequestURI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span> userDto<span class="token punctuation">.</span><span class="token function">getAuthorities</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">&quot;p1&quot;</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> requestURI<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">&quot;/r/r1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span> userDto<span class="token punctuation">.</span><span class="token function">getAuthorities</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">&quot;p2&quot;</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> requestURI<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">&quot;/r/r2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">writeContent</span><span class="token punctuation">(</span>response<span class="token punctuation">,</span><span class="token string">&quot;没有权限，拒绝访问&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//响应信息给客户端</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">writeContent</span><span class="token punctuation">(</span><span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">String</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">&quot;text/html;charset=utf-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">PrintWriter</span> writer <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        writer<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        writer<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><p>在 WebConfig中配置拦截器，匹配/r/**的资源为受保护的系统资源，访问该资源的请求进入SimpleAuthenticationInterceptor拦截器。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Autowired</span>
<span class="token class-name">SimpleAuthenticationInterceptor</span> simpleAuthenticationInterceptor<span class="token punctuation">;</span>

<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addInterceptors</span><span class="token punctuation">(</span><span class="token class-name">InterceptorRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>            registry<span class="token punctuation">.</span><span class="token function">addInterceptor</span><span class="token punctuation">(</span>simpleAuthenticationInterceptor<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addPathPatterns</span><span class="token punctuation">(</span><span class="token string">&quot;/r/**&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>（4）测试
未登录情况下，/r/r1与/r/r2均提示 “请先登录”。
张三登录情况下，由于张三有p1权限，因此可以访问/r/r1，张三没有p2权限，访问/r/r2时提示 “权限不足 “。
李四登录情况下，由于李四有p2权限，因此可以访问/r/r2，李四没有p1权限，访问/r/r1时提示 “权限不足 “。
测试结果全部符合预期结果。</p> <h3 id="_2-6-小结"><a href="#_2-6-小结" class="header-anchor">#</a> 2.6.小结</h3> <p>基于Session的认证方式是一种常见的认证方式，至今还有非常多的系统在使用。我们在此小节使用Spring mvc技
术对它进行简单实现，旨在让大家更清晰实在的了解用户认证、授权以及会话的功能意义及实现套路，也就是它们
分别干了哪些事儿？大概需要怎么做？</p> <p>而在正式生产项目中，我们往往会考虑使用第三方安全框架（如 spring security，shiro等安全框架）来实现认证
授权功能，因为这样做能一定程度提高生产力，提高软件标准化程度，另外往往这些框架的可扩展性考虑的非常全
面。但是缺点也非常明显，这些通用化组件为了提高支持范围会增加很多可能我们不需要的功能，结构上也会比较
抽象，如果我们不够了解它，一旦出现问题，将会很难定位。</p> <h2 id="_3-spring-security-快速上手"><a href="#_3-spring-security-快速上手" class="header-anchor">#</a> 3. Spring Security 快速上手</h2> <h3 id="_3-1-spring-security介绍"><a href="#_3-1-spring-security介绍" class="header-anchor">#</a> 3.1 Spring Security介绍</h3> <p>Spring Security是一个能够为基于Spring的企业应用系统提供声明式的安全访问控制解决方案的安全框架。由于它
是Spring生态系统中的一员，因此它伴随着整个Spring生态系统不断修正、升级，在spring boot项目中加入spring security更是十分简单，使用Spring Security 减少了为企业系统安全控制编写大量重复代码的工作。</p> <h3 id="_3-2-创建工程"><a href="#_3-2-创建工程" class="header-anchor">#</a> 3.2 创建工程</h3> <h4 id="_3-2-1-创建maven工程"><a href="#_3-2-1-创建maven工程" class="header-anchor">#</a> 3.2.1 创建maven工程</h4> <p>创建maven工程 security-spring-security，工程结构如下：</p> <p><img src="/assets/img/Snipaste_2020-03-29_17-11-24.d7be212b.jpg" alt="img"></p> <p>引入以下依赖：
在security-springmvc的基础上增加spring-security的依赖：</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.security<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-security-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>5.1.4.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.security<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-security-config<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>5.1.4.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h4 id="_3-2-2-spring容器配置"><a href="#_3-2-2-spring容器配置" class="header-anchor">#</a> 3.2.2 Spring容器配置</h4> <p>同security-springmvc.</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * Spring 容器配置  【相当于applicationContext.xml】
 *
 * @author RyuZheng
 * @version 1.0
 **/</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span>basePackages <span class="token operator">=</span> <span class="token string">&quot;com.jjane.security.springmvc&quot;</span><span class="token punctuation">,</span> excludeFilters <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">.</span><span class="token class-name">Filter</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">FilterType</span><span class="token punctuation">.</span>ANNOTATION<span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token class-name">Controller</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ApplicationConfig</span> <span class="token punctuation">{</span>
    <span class="token comment">//在此配置除了Controller的其它bean，比如：数据库链接池、事务管理器、业务bean等</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h4 id="_3-2-3-servlet-context配置"><a href="#_3-2-3-servlet-context配置" class="header-anchor">#</a> 3.2.3 Servlet Context配置</h4> <p>同security-springmvc.</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * SpringMVC的servletContext配置  【相当于springmvc.xml】
 *
 * @author RyuZheng
 * @version 1.0
 **/</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@EnableWebMvc</span>
<span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span>basePackages <span class="token operator">=</span> <span class="token string">&quot;com.jjane.security.springmvc&quot;</span><span class="token punctuation">,</span> includeFilters <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">.</span><span class="token class-name">Filter</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">FilterType</span><span class="token punctuation">.</span>ANNOTATION<span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token class-name">Controller</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebConfig</span> <span class="token keyword">implements</span> <span class="token class-name">WebMvcConfigurer</span> <span class="token punctuation">{</span>

    <span class="token comment">/**
     * 视图解析器
     *
     * @return
     */</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">InternalResourceViewResolver</span> <span class="token function">viewResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">InternalResourceViewResolver</span> viewResolver <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InternalResourceViewResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        viewResolver<span class="token punctuation">.</span><span class="token function">setPrefix</span><span class="token punctuation">(</span><span class="token string">&quot;/WEB-INF/view/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        viewResolver<span class="token punctuation">.</span><span class="token function">setSuffix</span><span class="token punctuation">(</span><span class="token string">&quot;.jsp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> viewResolver<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h4 id="_3-2-4-加载-spring容器"><a href="#_3-2-4-加载-spring容器" class="header-anchor">#</a> 3.2.4  加载 Spring容器</h4> <p>在init包下定义Spring容器初始化类SpringApplicationInitializer，此类实现WebApplicationInitializer接口，
Spring容器启动时加载WebApplicationInitializer接口的所有实现类。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * 容器启动类
 *
 * @author RyuZheng
 * @version 1.0
 **/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringApplicationInitializer</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractAnnotationConfigDispatcherServletInitializer</span> <span class="token punctuation">{</span>

    <span class="token comment">/**
     * 加载Spring容器，相当于加载applicationContext.xml
     *
     * @return
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getRootConfigClasses</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token class-name">ApplicationConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 加载SpringMvc的servletContext容器，相当于加载springmvc.xml
     *
     * @return
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getServletConfigClasses</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token class-name">WebConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//url-mapping</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getServletMappings</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><h3 id="_3-3-认证"><a href="#_3-3-认证" class="header-anchor">#</a> 3.3 认证</h3> <h4 id="_3-3-1-认证页面"><a href="#_3-3-1-认证页面" class="header-anchor">#</a> 3.3.1 认证页面</h4> <p>springSecurity默认提供认证页面，不需要额外开发。</p> <p><img src="/assets/img/Snipaste_2020-03-29_15-49-37.11da246f.jpg" alt="img"></p> <h4 id="_3-3-2-安全配置"><a href="#_3-3-2-安全配置" class="header-anchor">#</a> 3.3.2.安全配置</h4> <p>spring security提供了用户名密码登录、退出、会话管理等认证功能，只需要配置即可使用。</p> <ol><li>在config包下定义WebSecurityConfig，安全配置的内容包括：用户信息、密码编码器、安全拦截机制。</li></ol> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * Security 安全配置
 *
 * @author RyuZheng
 * @version 1.0
 **/</span>
<span class="token annotation punctuation">@EnableWebSecurity</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebSecurityConfig</span> <span class="token keyword">extends</span> <span class="token class-name">WebSecurityConfigurerAdapter</span> <span class="token punctuation">{</span>

    <span class="token comment">//定义用户信息服务（即：查询用户信息）</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">UserDetailsService</span> <span class="token function">userDetailsService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">InMemoryUserDetailsManager</span> userDetailsManager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InMemoryUserDetailsManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        userDetailsManager<span class="token punctuation">.</span><span class="token function">createUser</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token function">withUsername</span><span class="token punctuation">(</span><span class="token string">&quot;zhangsan&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">password</span><span class="token punctuation">(</span><span class="token string">&quot;123&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authorities</span><span class="token punctuation">(</span><span class="token string">&quot;p1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        userDetailsManager<span class="token punctuation">.</span><span class="token function">createUser</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token function">withUsername</span><span class="token punctuation">(</span><span class="token string">&quot;lisi&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">password</span><span class="token punctuation">(</span><span class="token string">&quot;456&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authorities</span><span class="token punctuation">(</span><span class="token string">&quot;p2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> userDetailsManager<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//密码编码器</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">PasswordEncoder</span> <span class="token function">passwordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">NoOpPasswordEncoder</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//安全拦截机制</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        http<span class="token punctuation">.</span><span class="token function">authorizeRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/r/**&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span>     （<span class="token number">1</span>）
                <span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                 （<span class="token number">2</span>）
                <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">formLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">successForwardUrl</span><span class="token punctuation">(</span><span class="token string">&quot;/login-success&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   （<span class="token number">3</span>）
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><p>在 <strong>userDetailsService()</strong> 方法中，我们返回了一个UserDetailsService给Spring容器，Spring Security会使用它来获取用户信息。我们暂时使用InMemoryUserDetailsManager实现类，并在其中分别创建了zhangsan、lisi两个用户，并设置密码和权限。</p> <p>而在**configure()**中，我们通过HttpSecurity设置了安全拦截规则，其中包含了以下内容：</p> <p>（1）url匹配/r/**的资源，经过认证后才能访问。
（2）其他url完全开放。
（3）支持form表单认证，认证成功后转向/login-success。</p> <p>关于HttpSecurity的配置清单请参考附录 HttpSecurity。</p> <ol start="2"><li>加载 WebSecurityConfig
修改SpringApplicationInitializer的getRootConfigClasses()方法，添加WebSecurityConfig.class：</li></ol> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * 加载Spring容器，相当于加载applicationContext.xml
 *
 * @return
*/</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">protected</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getRootConfigClasses</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token class-name">ApplicationConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">WebSecurityConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="_3-3-3-spring-security初始化"><a href="#_3-3-3-spring-security初始化" class="header-anchor">#</a> 3.3.3. Spring Security初始化</h4> <p>Spring Security 初始化，这里有两种情况</p> <ul><li><p>若当前环境没有使用 Spring或Spring MVC，则需要将 WebSecurityConfig(Spring Security配置类) 传入超
类，以确保获取配置，并创建spring context。</p></li> <li><p>相反，若当前环境已经使用 spring，我们应该在现有的springContext中注册Spring Security【上一步已经做将WebSecurityConfig加载至rootcontext】，此方法可以什么都不做。</p></li></ul> <p>接下来，在init包下定义 <code>SpringSecurityApplicationInitializer</code> 类：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * Spring Security初始化
 *
 * @author RyuZheng
 * @version 1.0
 **/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringSecurityApplicationInitializer</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractSecurityWebApplicationInitializer</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token class-name">SpringSecurityApplicationInitializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//super(WebSecurityConfig.class);如果当前环境没有使用Spring或Spring MVC，则需要该代码</span>
    <span class="token punctuation">}</span>
    
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h4 id="_3-3-4-默认根路径请求"><a href="#_3-3-4-默认根路径请求" class="header-anchor">#</a> 3.3.4. 默认根路径请求</h4> <p>在 <code>WebConfig.java</code> 中添加默认请求根路径跳转到/login，此url为spring security提供：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 默认Url根路径跳转到/login，此url为spring security提供</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addViewControllers</span><span class="token punctuation">(</span><span class="token class-name">ViewControllerRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    registry<span class="token punctuation">.</span><span class="token function">addViewController</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setViewName</span><span class="token punctuation">(</span><span class="token string">&quot;redirect:/login&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>spring security默认提供的登录页面。</p> <h4 id="_3-3-5-认证成功页面"><a href="#_3-3-5-认证成功页面" class="header-anchor">#</a> 3.3.5. 认证成功页面</h4> <p>在安全配置中，认证成功将跳转到/login-success，代码如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    http<span class="token punctuation">.</span><span class="token function">authorizeRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/r/**&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                 
        <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">formLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">successForwardUrl</span><span class="token punctuation">(</span><span class="token string">&quot;/login-success&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>spring security支持form表单认证，认证成功后转向/login-success。</p> <p>在LoginController中定义/login-success：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/login-success&quot;</span><span class="token punctuation">,</span> produces <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;text/plain;charset=UTF-8&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">loginSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot; 登录成功&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="_3-3-6-测试"><a href="#_3-3-6-测试" class="header-anchor">#</a> 3.3.6 测试</h4> <p><strong>（1）启动项目，访问http://localhost:8080/security-spring-security/路径地址</strong></p> <p><img src="/assets/img/Snipaste_2020-03-29_15-50-10.f1b48a69.jpg" alt="img"></p> <p>页面会根据WebConfig中addViewControllers配置规则，跳转至/login，/login是pring Security提供的登录页面。</p> <p><strong>（2）登录</strong>
1、输入错误的用户名、密码</p> <p><img src="/assets/img/Snipaste_2020-03-29_15-51-11.9b077760.jpg" alt="img"></p> <p>2、输入正确的用户名、密码，登录成功。</p> <p><img src="data:image/jpeg;base64,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" alt="img"></p> <p><strong>（3）退出</strong></p> <p>1、请求/logout退出</p> <p><img src="/assets/img/Snipaste_2020-03-29_15-59-17.841e4225.jpg" alt="img"></p> <p>2、退出 后再访问资源自动跳转到登录页面</p> <h3 id="_3-4-授权"><a href="#_3-4-授权" class="header-anchor">#</a> 3.4 授权</h3> <p>实现授权需要对用户的访问进行拦截校验，校验用户的权限是否可以操作指定的资源，Spring Security默认提供授
权实现方法。</p> <p>在LoginController添加/r/r1或/r/r2</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
     * 测试资源1
     *
     * @return
     */</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/r/r1&quot;</span><span class="token punctuation">,</span> produces <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;text/plain;charset=UTF-8&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">r1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot; 访问资源1&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
* 测试资源2
*
* @return
*/</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/r/r2&quot;</span><span class="token punctuation">,</span> produces <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;text/plain;charset=UTF-8&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">r2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot; 访问资源2&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>在安全配置类 <code>WebSecurityConfig.java</code> 中配置授权规则：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/r/r1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hasAuthority</span><span class="token punctuation">(</span><span class="token string">&quot;p1&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/r/r2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hasAuthority</span><span class="token punctuation">(</span><span class="token string">&quot;p2&quot;</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>.antMatchers(&quot;/r/r1&quot;).hasAuthority(&quot;p1&quot;)表示：访问/r/r1资源的 url需要拥有p1权限。
.antMatchers(&quot;/r/r2&quot;).hasAuthority(&quot;p2&quot;)表示：访问/r/r2资源的 url需要拥有p2权限。</p> <p>完整的WebSecurityConfig方法如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    http<span class="token punctuation">.</span><span class="token function">authorizeRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/r/r1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hasAuthority</span><span class="token punctuation">(</span><span class="token string">&quot;p1&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/r/r2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hasAuthority</span><span class="token punctuation">(</span><span class="token string">&quot;p2&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/r/**&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//所有/r/**的请求必须认证通过</span>
        <span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token operator">/</span>除了<span class="token operator">/</span>r<span class="token comment">/**，其它的请求可以访问
        .and()
        .formLogin()//允许表单登录
        .successForwardUrl(&quot;/login-success&quot;);//自定义登录成功的页面地址
}
</span></code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>测试：
1、登录成功
2、访问/r/r1和/r/r2，有权限时则正常访问，否则返回403（拒绝访问）</p> <p><img src="/assets/img/Snipaste_2020-03-29_17-24-29.21259d9c.jpg" alt="img"></p> <h3 id="_3-5-小结"><a href="#_3-5-小结" class="header-anchor">#</a> 3.5 小结</h3> <p>通过快速上手，咱们使用Spring Security实现了认证和授权，Spring Security提供了基于账号和密码的认证方式，
通过安全配置即可实现请求拦截，授权功能，Spring Security能完成的不仅仅是这些。</p> <h2 id="_4-spring-security-应用详解"><a href="#_4-spring-security-应用详解" class="header-anchor">#</a> 4. Spring Security  应用详解</h2> <h3 id="_4-1-集成springboot"><a href="#_4-1-集成springboot" class="header-anchor">#</a> 4.1 集成SpringBoot</h3> <h4 id="_4-1-1-spring-boot-介绍"><a href="#_4-1-1-spring-boot-介绍" class="header-anchor">#</a> 4.1.1 Spring Boot 介绍</h4> <p>Spring Boot是一套Spring的快速开发框架，基于Spring 4.0设计，使用Spring Boot开发可以避免一些繁琐的工程搭建和配置，同时它集成了大量的常用框架，快速导入依赖包，避免依赖包的冲突。基本上常用的开发框架都支持
Spring Boot开发，例如：MyBatis、Dubbo等，Spring 家族更是如此，例如：Spring cloud、Spring mvc、Spring security等，使用Spring Boot开发可以大大提高生产率，所以Spring Boot的使用率非常高。</p> <p>本章节讲解如何通过Spring Boot开发Spring Security应用，Spring Boot提供spring-boot-starter-security用于开
发Spring Security应用。</p> <h4 id="_4-1-2-创建maven工程"><a href="#_4-1-2-创建maven工程" class="header-anchor">#</a> 4.1.2  创建maven工程</h4> <p>1）创建maven工程 security-spring-boot，工程结构如下：</p> <p><img src="/assets/img/Snipaste_2020-04-05_20-09-40.3b85a7cc.jpg" alt="img"></p> <p>2）引入以下依赖：</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-parent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.2.6.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>relativePath</span><span class="token punctuation">/&gt;</span></span> <span class="token comment">&lt;!-- lookup parent from repository --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.jjane.security<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>security-springboot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>0.0.1-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>security-springboot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">&gt;</span></span>Spring Security project for Spring Boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>java.version</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>java.version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- Spring Security 依赖 --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-security<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>


        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusions</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.junit.vintage<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>junit-vintage-engine<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusions</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.security<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-security-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br></div></div><h4 id="_4-1-3-spring-容器配置"><a href="#_4-1-3-spring-容器配置" class="header-anchor">#</a> 4.1.3 spring 容器配置</h4> <p>SpringBoot工程启动会自动扫描启动类所在包下的所有Bean，加载到spring容器。</p> <p>1）Spring Boot配置文件</p> <p>在resources下添加application.yml，内容如下：</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8080</span>
  <span class="token key atrule">servlet</span><span class="token punctuation">:</span>
    <span class="token key atrule">context-path</span><span class="token punctuation">:</span> /security<span class="token punctuation">-</span>springboot

<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> security<span class="token punctuation">-</span>springboot
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>2 ）Spring Boot 启动类</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SecuritySpringbootApplication</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">SecuritySpringbootApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="_4-1-4-servlet-context配置"><a href="#_4-1-4-servlet-context配置" class="header-anchor">#</a> 4.1.4 Servlet Context配置</h4> <p>由于Spring boot starter自动装配机制，这里无需使用<code>@EnableWebMvc</code>与<code>@ComponentScan</code>，WebConfig 如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebConfig</span> <span class="token keyword">implements</span> <span class="token class-name">WebMvcConfigurer</span> <span class="token punctuation">{</span>

    <span class="token comment">//默认Url根路径跳转到/login，此url为Spring Security提供</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addViewControllers</span><span class="token punctuation">(</span><span class="token class-name">ViewControllerRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        registry<span class="token punctuation">.</span><span class="token function">addViewController</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setViewName</span><span class="token punctuation">(</span><span class="token string">&quot;redirect:/login&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>视图解析器配置在 application.yml 中</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>  
  <span class="token key atrule">mvc</span><span class="token punctuation">:</span>
    <span class="token key atrule">view</span><span class="token punctuation">:</span>
      <span class="token key atrule">prefix</span><span class="token punctuation">:</span> /WEB<span class="token punctuation">-</span>INF/views/
      <span class="token key atrule">suffix</span><span class="token punctuation">:</span> .jsp
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="_4-1-5-安全配置"><a href="#_4-1-5-安全配置" class="header-anchor">#</a> 4.1.5 安全配置</h4> <p>由于Spring boot starter自动装配机制，这里无需使用<code>@EnableWebSecurity</code>，WebSecurityConfig内容如下:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//===========================================</span>
<span class="token comment">//内容跟Spring security入门程序一致</span>
<span class="token comment">//===========================================</span>


<span class="token comment">/**
 * Security 安全配置
 *
 * @author RyuZheng
 * @version 1.0
 **/</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebSecurityConfig</span> <span class="token keyword">extends</span> <span class="token class-name">WebSecurityConfigurerAdapter</span> <span class="token punctuation">{</span>

    <span class="token comment">//定义用户信息服务（即：查询用户信息）</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">UserDetailsService</span> <span class="token function">userDetailsService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">InMemoryUserDetailsManager</span> userDetailsManager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InMemoryUserDetailsManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        userDetailsManager<span class="token punctuation">.</span><span class="token function">createUser</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token function">withUsername</span><span class="token punctuation">(</span><span class="token string">&quot;zhangsan&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">password</span><span class="token punctuation">(</span><span class="token string">&quot;123&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authorities</span><span class="token punctuation">(</span><span class="token string">&quot;p1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        userDetailsManager<span class="token punctuation">.</span><span class="token function">createUser</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token function">withUsername</span><span class="token punctuation">(</span><span class="token string">&quot;lisi&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">password</span><span class="token punctuation">(</span><span class="token string">&quot;456&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authorities</span><span class="token punctuation">(</span><span class="token string">&quot;p2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> userDetailsManager<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//密码编码器</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">PasswordEncoder</span> <span class="token function">passwordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">NoOpPasswordEncoder</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//安全拦截机制</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        http<span class="token punctuation">.</span><span class="token function">authorizeRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/r/r1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hasAuthority</span><span class="token punctuation">(</span><span class="token string">&quot;p1&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/r/r2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hasAuthority</span><span class="token punctuation">(</span><span class="token string">&quot;p2&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/r/**&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//所有/r/**的请求必须认证通过</span>
                <span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token operator">/</span>除了<span class="token operator">/</span>r<span class="token comment">/**，其它的请求可以访问
                .and()
                .formLogin()//允许表单登录
                .successForwardUrl(&quot;/login-success&quot;);//自定义登录成功的页面地址
    }
}
</span></code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><h4 id="_4-1-6-测试"><a href="#_4-1-6-测试" class="header-anchor">#</a> 4.1.6 测试</h4> <p>LoginController 的内容同Spring security入门程序。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//===========================================</span>
<span class="token comment">//内容跟Spring security入门程序一致</span>
<span class="token comment">//===========================================</span>

<span class="token comment">/**
 * 登录 Controller
 *
 * @author RyuZheng
 * @version 1.0
 **/</span>
<span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LoginController</span> <span class="token punctuation">{</span>


    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/login-success&quot;</span><span class="token punctuation">,</span> produces <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;text/plain;charset=UTF-8&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">loginSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot; 登录成功&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 测试资源1
     *
     * @return
     */</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/r/r1&quot;</span><span class="token punctuation">,</span> produces <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;text/plain;charset=UTF-8&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">r1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot; 访问资源1&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 测试资源2
     *
     * @return
     */</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/r/r2&quot;</span><span class="token punctuation">,</span> produces <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;text/plain;charset=UTF-8&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">r2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot; 访问资源2&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><p>测试过程：
1、测试认证
2、测试退出
3、测试授权</p> <h3 id="_4-2-工作原理"><a href="#_4-2-工作原理" class="header-anchor">#</a> 4.2 工作原理</h3> <h4 id="_4-2-1-结构总览"><a href="#_4-2-1-结构总览" class="header-anchor">#</a> 4.2.1 结构总览</h4> <p>Spring Security所解决的问题就是安全访问控制，而安全访问控制功能其实就是对所有进入系统的请求进行拦截，校验每个请求是否能够访问它所期望的资源。根据前边知识的学习，可以通过Filter或AOP等技术来实现，SpringSecurity对Web资源的保护是靠Filter实现的，所以从这个Filter来入手，逐步深入Spring Security原理。</p> <p>当初始化Spring Security时，会创建一个名为 SpringSecurityFilterChain 的Servlet过滤器，类型为org.springframework.security.web.FilterChainProxy，它实现了javax.servlet.Filter，因此外部的请求会经过此
类，下图是Spring Security过虑器链结构图：</p> <p><img src="/assets/img/Snipaste_2020-04-05_20-20-21.70c6a5be.jpg" alt="img"></p> <p>FilterChainProxy 是一个代理，真正起作用的是FilterChainProxy中SecurityFilterChain所包含的各个Filter，同时这些Filter作为Bean被Spring管理，它们是Spring Security核心，各有各的职责，但他们并不直接处理用户的认证，也不直接处理用户的授权，而是把它们交给了认证管理器（AuthenticationManager）和决策管理器（AccessDecisionManager）进行处理，下图是FilterChainProxy相关类的UML图示。</p> <p><img src="/assets/img/Snipaste_2020-04-05_20-21-51.0b65e639.jpg" alt="img"></p> <p>spring Security功能的实现主要是由一系列过滤器链相互配合完成。</p> <p><img src="/assets/img/Snipaste_2020-04-05_20-22-47.7d837b34.jpg" alt="img"></p> <p>下面介绍过滤器链中主要的几个过滤器及其作用：</p> <p><strong>SecurityContextPersistenceFilter</strong> 这个Filter是整个拦截过程的入口和出口（也就是第一个和最后一个拦截
器），会在请求开始时从配置好的 SecurityContextRepository 中获取 SecurityContext，然后把它设置给SecurityContextHolder。在请求完成后将 SecurityContextHolder 持有的 SecurityContext 再保存到配置好的 SecurityContextRepository，同时清除 securityContextHolder 所持有的 SecurityContext；</p> <p><strong>UsernamePasswordAuthenticationFilter</strong> 用于处理来自表单提交的认证。该表单必须提供对应的用户名和密
码，其内部还有登录成功或失败后进行处理的 AuthenticationSuccessHandler 和AuthenticationFailureHandler，这些都可以根据需求做相关改变；</p> <p><strong>FilterSecurityInterceptor</strong> 是用于保护web资源的，使用AccessDecisionManager对当前用户进行授权访问，前
面已经详细介绍过了；</p> <p><strong>ExceptionTranslationFilter</strong> 能够捕获来自 FilterChain 所有的异常，并进行处理。但是它只会处理两类异常：
AuthenticationException 和 AccessDeniedException，其它的异常它会继续抛出。</p> <h4 id="_4-2-2-认证流程"><a href="#_4-2-2-认证流程" class="header-anchor">#</a> 4.2.2.认证流程</h4> <h5 id="_4-2-2-1-认证流程"><a href="#_4-2-2-1-认证流程" class="header-anchor">#</a> 4.2.2.1  认证流程</h5> <p><img src="/assets/img/Snipaste_2020-04-05_20-26-01.a62ce95d.jpg" alt="img"></p> <p>让我们仔细分析认证过程：</p> <ol><li>用户提交用户名、密码被SecurityFilterChain中的 UsernamePasswordAuthenticationFilter 过滤器获取到，
封装为请求Authentication，通常情况下是UsernamePasswordAuthenticationToken这个实现类。</li> <li>然后过滤器将Authentication提交至认证管理器（AuthenticationManager）进行认证</li> <li>认证成功后， AuthenticationManager 身份管理器返回一个被填充满了信息的（包括上面提到的权限信息，
身份信息，细节信息，但密码通常会被移除） Authentication 实例。</li> <li>SecurityContextHolder 安全上下文容器将第3步填充了信息的 Authentication ，通过SecurityContextHolder.getContext().setAuthentication(…)方法，设置到其中。
可以看出AuthenticationManager接口（认证管理器）是认证相关的核心接口，也是发起认证的出发点，它
的实现类为ProviderManager。而Spring Security支持多种认证方式，因此ProviderManager维护着一个
List<AuthenticationProvider> 列表，存放多种认证方式，最终实际的认证工作是由
AuthenticationProvider完成的。咱们知道web表单的对应的AuthenticationProvider实现类为
DaoAuthenticationProvider，它的内部又维护着一个UserDetailsService负责UserDetails的获取。最终
AuthenticationProvider将UserDetails填充至Authentication。</AuthenticationProvider></li></ol> <p>认证核心组件的大体关系如下：</p> <p><img src="/assets/img/Snipaste_2020-04-05_20-27-42.7fd5de18.jpg" alt="img"></p> <h5 id="_4-2-2-2-authenticationprovider"><a href="#_4-2-2-2-authenticationprovider" class="header-anchor">#</a> 4.2.2.2.AuthenticationProvider</h5> <p>通过前面的Spring Security认证流程我们得知，认证管理器（AuthenticationManager）委托
AuthenticationProvider完成认证工作。</p> <p>AuthenticationProvider是一个接口，定义如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">AuthenticationProvider</span> <span class="token punctuation">{</span>
    <span class="token class-name">Authentication</span> <span class="token function">authenticate</span><span class="token punctuation">(</span><span class="token class-name">Authentication</span> var1<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">AuthenticationException</span><span class="token punctuation">;</span>

    <span class="token keyword">boolean</span> <span class="token function">supports</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> var1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>authenticate()<strong>方法定义了</strong>认证的实现过程</strong>，它的参数是一个Authentication，里面包含了登录用户所提交的用
户、密码等。而返回值也是一个Authentication，这个Authentication则是在认证成功后，将用户的权限及其他信
息重新组装后生成。</p> <p>Spring Security中维护着一个 List<AuthenticationProvider> 列表，存放多种认证方式，不同的认证方式使用不同的AuthenticationProvider。如使用用户名密码登录时，使用AuthenticationProvider1，短信登录时使用AuthenticationProvider2等等这样的例子很多。</AuthenticationProvider></p> <p>每个AuthenticationProvider需要实现 <strong>supports()</strong> 方法来表明自己支持的认证方式，如我们使用表单方式认证，
在提交请求时Spring Security会生成UsernamePasswordAuthenticationToken，它是一个Authentication，里面
封装着用户提交的用户名、密码信息。而对应的，哪个AuthenticationProvider来处理它？</p> <p>我们在<strong>DaoAuthenticationProvider</strong>的基类AbstractUserDetailsAuthenticationProvider发现以下代码：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">supports</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> authentication<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">UsernamePasswordAuthenticationToken</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>authentication<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>也就是说当web表单提交用户名密码时，Spring Security由DaoAuthenticationProvider处理。</strong></p> <p>最后，我们来看一下 **Authentication(认证信息)**的结构，它是一个接口，我们之前提到的UsernamePasswordAuthenticationToken就是它的实现之一：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Authentication</span> <span class="token keyword">extends</span> <span class="token class-name">Principal</span><span class="token punctuation">,</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>   <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">GrantedAuthority</span><span class="token punctuation">&gt;</span></span> <span class="token function">getAuthorities</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    
    <span class="token class-name">Object</span> <span class="token function">getCredentials</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                        <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
    
    <span class="token class-name">Object</span> <span class="token function">getDetails</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                            <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
    
    <span class="token class-name">Object</span> <span class="token function">getPrincipal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                          <span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
    
    <span class="token keyword">boolean</span> <span class="token function">isAuthenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">void</span> <span class="token function">setAuthenticated</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> isAuthenticated<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>（1）Authentication是spring security包中的接口，直接继承自Principal类，而Principal是位于 java.security
包中的。它是表示着一个抽象主体身份，任何主体都有一个名称，因此包含一个getName()方法。</p> <p>（2）getAuthorities()，权限信息列表，默认是GrantedAuthority接口的一些实现类，通常是代表权限信息的一系
列字符串。</p> <p>（3）getCredentials()，凭证信息，用户输入的密码字符串，在认证过后通常会被移除，用于保障安全。</p> <p>（4）getDetails()，细节信息，web应用中的实现接口通常为 WebAuthenticationDetails，它记录了访问者的ip地
址和sessionId的值。</p> <p>（5）<strong>getPrincipal()</strong>，身份信息，大部分情况下返回的是UserDetails接口的实现类，UserDetails代表用户的详细
信息，那从Authentication中取出来的UserDetails就是当前登录用户信息，它也是框架中的常用接口之一。</p> <h5 id="_4-2-2-3-userdetailsservice"><a href="#_4-2-2-3-userdetailsservice" class="header-anchor">#</a> 4.2.2.3.UserDetailsService</h5> <p>1）认识UserDetailsService
现在咱们现在知道DaoAuthenticationProvider处理了web表单的认证逻辑，认证成功后既得到一个Authentication(UsernamePasswordAuthenticationToken实现)，里面包含了身份信息（Principal）。这个身份
信息就是一个 Object ，大多数情况下它可以被强转为UserDetails对象。</p> <p>DaoAuthenticationProvider中包含了一个UserDetailsService实例，它负责根据用户名提取用户信息
UserDetails(包含密码)，而后DaoAuthenticationProvider会去对比UserDetailsService提取的用户密码与用户提交的密码是否匹配作为认证成功的关键依据，因此可以通过将自定义的 UserDetailsService 公开为spring bean来定义自定义身份验证。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserDetailsService</span> <span class="token punctuation">{</span>
    <span class="token class-name">UserDetails</span> <span class="token function">loadUserByUsername</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">UsernameNotFoundException</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>很多人把 DaoAuthenticationProvider和UserDetailsService的职责搞混淆，其实UserDetailsService只负责从特定的地方（通常是数据库）加载用户信息，仅此而已。而DaoAuthenticationProvider的职责更大，它完成完整的认证流程，同时会把UserDetails填充至Authentication。</p> <p>上面一直提到UserDetails是用户信息，咱们看一下它的真面目：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserDetails</span> <span class="token keyword">extends</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>
    <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">GrantedAuthority</span><span class="token punctuation">&gt;</span></span> <span class="token function">getAuthorities</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token class-name">String</span> <span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token class-name">String</span> <span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">boolean</span> <span class="token function">isAccountNonExpired</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">boolean</span> <span class="token function">isAccountNonLocked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">boolean</span> <span class="token function">isCredentialsNonExpired</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">boolean</span> <span class="token function">isEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>它和Authentication接口很类似，比如它们都拥有username，authorities。Authentication的getCredentials()与
UserDetails中的getPassword()需要被区分对待，前者是用户提交的密码凭证，后者是用户实际存储的密码，认证
其实就是对这两者的比对。Authentication中的getAuthorities()实际是由UserDetails的getAuthorities()传递而形
成的。还记得Authentication接口中的getDetails()方法吗？其中的UserDetails用户详细信息便是经过了
AuthenticationProvider认证之后被填充的。</p> <p>通过实现UserDetailsService和UserDetails，我们可以完成对用户信息获取方式以及用户信息字段的扩展。</p> <p>Spring Security提供的InMemoryUserDetailsManager(内存认证)，JdbcUserDetailsManager(jdbc认证)就是
UserDetailsService的实现类，主要区别无非就是从内存还是从数据库加载用户。</p> <p>2）测试
自定义UserDetailsService</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span> 
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringDataUserDetailsService</span> <span class="token keyword">implements</span> <span class="token class-name">UserDetailsService</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">UserDetails</span> <span class="token function">loadUserByUsername</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">UsernameNotFoundException</span> <span class="token punctuation">{</span>
        <span class="token comment">//登录账号</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;username=&quot;</span><span class="token operator">+</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//根据账号去数据库查询...</span>
        <span class="token comment">//这里暂时使用静态数据</span>
        <span class="token class-name">UserDetails</span> userDetails <span class="token operator">=</span>
<span class="token class-name">User</span><span class="token punctuation">.</span><span class="token function">withUsername</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">password</span><span class="token punctuation">(</span><span class="token string">&quot;123&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authorities</span><span class="token punctuation">(</span><span class="token string">&quot;p1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> userDetails<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>屏蔽安全配置类中 UserDetailsService的定义</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/*@Bean
    public UserDetailsService userDetailsService() {
        InMemoryUserDetailsManager userDetailsManager = new InMemoryUserDetailsManager();
        userDetailsManager.createUser(User.withUsername(&quot;zhangsan&quot;).password(&quot;123&quot;).authorities(&quot;p1&quot;).build());
        userDetailsManager.createUser(User.withUsername(&quot;lisi&quot;).password(&quot;456&quot;).authorities(&quot;p2&quot;).build());
        return userDetailsManager;
    }*/</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>重启工程，请求认证，SpringDataUserDetailsService的loadUserByUsername方法被调用 ，查询用户信息。</p> <h5 id="_4-2-2-4-passwordencoder"><a href="#_4-2-2-4-passwordencoder" class="header-anchor">#</a> 4.2.2.4.PasswordEncoder</h5> <p>1）认识PasswordEncoder</p> <p>DaoAuthenticationProvider认证处理器通过UserDetailsService获取到UserDetails后，它是如何与请求Authentication中的密码做对比呢？</p> <p>在这里Spring Security为了适应多种多样的加密类型，又做了抽象，DaoAuthenticationProvider通过
PasswordEncoder接口的matches方法进行密码的对比，而具体的密码对比细节取决于实现：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">PasswordEncoder</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> <span class="token function">encode</span><span class="token punctuation">(</span><span class="token class-name">CharSequence</span> var1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">boolean</span> <span class="token function">matches</span><span class="token punctuation">(</span><span class="token class-name">CharSequence</span> var1<span class="token punctuation">,</span> <span class="token class-name">String</span> var2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">default</span> <span class="token keyword">boolean</span> <span class="token function">upgradeEncoding</span><span class="token punctuation">(</span><span class="token class-name">String</span> encodedPassword<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>而Spring Security提供很多内置的PasswordEncoder，能够开箱即用，使用某种PasswordEncoder只需要进行如
下声明即可，如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span> 
<span class="token keyword">public</span> <span class="token class-name">PasswordEncoder</span> <span class="token function">passwordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span>  <span class="token class-name">NoOpPasswordEncoder</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>NoOpPasswordEncoder采用字符串匹配方法，不对密码进行加密比较处理，密码比较流程如下：</p> <p>1、用户输入密码（明文 ）
2、DaoAuthenticationProvider获取UserDetails（其中存储了用户的正确密码）
3、DaoAuthenticationProvider使用PasswordEncoder对输入的密码和正确的密码进行校验，密码一致则校验通
过，否则校验失败。</p> <p>NoOpPasswordEncoder 的校验规则拿 输入的密码和UserDetails中的正确密码进行字符串比较，字符串内容一致
则校验通过，否则校验失败。</p> <p>实际项目中推荐使用BCryptPasswordEncoder, Pbkdf2PasswordEncoder, SCryptPasswordEncoder等，感兴趣
的大家可以看看这些PasswordEncoder的具体实现。</p> <p>2）使用BCryptPasswordEncoder</p> <p>1、配置BCryptPasswordEncoder
在安全配置类中定义：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span> 
<span class="token keyword">public</span> <span class="token class-name">PasswordEncoder</span> <span class="token function">passwordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">BCryptPasswordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>测试发现认证失败，提示：Encoded password does not look like BCrypt。</p> <p>原因：</p> <p>由于UserDetails中存储的是原始密码（比如：123），它不是BCrypt格式。
跟踪 DaoAuthenticationProvider第33行代码查看 userDetails中的内容 ，跟踪第38行代码查看PasswordEncoder的类型。</p> <p>2、测试BCrypt
通过下边的代码测试BCrypt加密及校验的方法</p> <p>添加依赖：</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>编写测试方法：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestBCrypt</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//对原始密码加密</span>
        <span class="token class-name">String</span> hashpw <span class="token operator">=</span> <span class="token class-name">BCrypt</span><span class="token punctuation">.</span><span class="token function">hashpw</span><span class="token punctuation">(</span><span class="token string">&quot;123&quot;</span><span class="token punctuation">,</span> <span class="token class-name">BCrypt</span><span class="token punctuation">.</span><span class="token function">gensalt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>hashpw<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//校验原始密码和BCrypt密码是否一致</span>
        <span class="token keyword">boolean</span> checkpw <span class="token operator">=</span> <span class="token class-name">BCrypt</span><span class="token punctuation">.</span><span class="token function">checkpw</span><span class="token punctuation">(</span><span class="token string">&quot;123&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;$2a$10$NlBC84MVb7F95EXYTXwLneXgCca6/GipyWR5NHm8K0203bSQMLpvm&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>checkpw<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>3、修改安全配置类</p> <p>将UserDetails中的原始密码修改为BCrypt格式</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>manager<span class="token punctuation">.</span><span class="token function">createUser</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token function">withUsername</span><span class="token punctuation">(</span><span class="token string">&quot;zhangsan&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">password</span><span class="token punctuation">(</span>&quot;$<span class="token number">2</span>a$<span class="token number">10</span>$<span class="token number">1</span>b5mIkehqv5c4KRrX9bUj<span class="token punctuation">.</span><span class="token class-name">A4Y2hug3I</span>
<span class="token class-name">GCnMCL5i4RpQrYV12xNKye</span><span class="token string">&quot;).authorities(&quot;</span>p1&quot;<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>实际项目中存储在数据库中的密码并不是原始密码，都是经过加密处理的密码。</p> <h4 id="_4-2-3-授权流程"><a href="#_4-2-3-授权流程" class="header-anchor">#</a> 4.2.3.授权流程</h4> <h6 id="_4-2-3-1-授权流程"><a href="#_4-2-3-1-授权流程" class="header-anchor">#</a> 4.2.3.1 授权流程</h6> <p>通过快速上手我们知道，Spring Security可以通过 http.authorizeRequests() 对web请求进行授权保护。Spring
Security使用标准Filter建立了对web请求的拦截，最终实现对资源的授权访问。</p> <p>Spring Security的授权流程如下：</p> <p><img src="/assets/img/Snipaste_2020-04-05_20-59-51.5d71e390.jpg" alt="img"></p> <p>分析授权流程：</p> <ol><li><p><strong>拦截请求</strong>，已认证用户访问受保护的web资源将被SecurityFilterChain中的 FilterSecurityInterceptor 的子
类拦截。</p></li> <li><p><strong>获取资源访问策略</strong>，FilterSecurityInterceptor会从 SecurityMetadataSource 的子类
DefaultFilterInvocationSecurityMetadataSource 获取要访问当前资源所需要的权限
Collection<ConfigAttribute> 。
SecurityMetadataSource其实就是读取访问策略的抽象，而读取的内容，其实就是我们配置的访问规则， 读
取访问策略如：</ConfigAttribute></p></li></ol> <div class="language-java line-numbers-mode"><pre class="language-java"><code>http
<span class="token punctuation">.</span><span class="token function">authorizeRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                                                               
        <span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/r/r1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hasAuthority</span><span class="token punctuation">(</span><span class="token string">&quot;p1&quot;</span><span class="token punctuation">)</span>                                     
        <span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/r/r2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hasAuthority</span><span class="token punctuation">(</span><span class="token string">&quot;p2&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ol start="3"><li>最后，FilterSecurityInterceptor会调用 AccessDecisionManager 进行授权决策，若决策通过，则允许访问资
源，否则将禁止访问。</li></ol> <p>AccessDecisionManager（访问决策管理器）的核心接口如下:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">AccessDecisionManager</span> <span class="token punctuation">{</span>
   <span class="token comment">/**  
   * 通过传递的参数来决定用户是否有访问对应受保护资源的权限  
   */</span>  
    <span class="token keyword">void</span> <span class="token function">decide</span><span class="token punctuation">(</span><span class="token class-name">Authentication</span> authentication <span class="token punctuation">,</span> <span class="token class-name">Object</span> object<span class="token punctuation">,</span> <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ConfigAttribute</span><span class="token punctuation">&gt;</span></span>
configAttributes <span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">AccessDeniedException</span><span class="token punctuation">,</span> <span class="token class-name">InsufficientAuthenticationException</span><span class="token punctuation">;</span>
 <span class="token comment">//略..    </span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>这里着重说明一下decide的参数：
authentication：要访问资源的访问者的身份</p> <p>object：要访问的受保护资源，web请求对应FilterInvocation</p> <p>configAttributes：是受保护资源的访问策略，通过SecurityMetadataSource获取。</p> <p><strong>decide接口就是用来鉴定当前用户是否有访问对应受保护资源的权限。</strong></p> <h6 id="_4-2-3-2-授权决策"><a href="#_4-2-3-2-授权决策" class="header-anchor">#</a> 4.2.3.2 授权决策</h6> <p>AccessDecisionManager采用投票的方式来确定是否能够访问受保护资源。</p> <p><img src="/assets/img/Snipaste_2020-04-05_21-03-55.5c6e864e.jpg" alt="img"></p> <p>通过上图可以看出，AccessDecisionManager中包含的一系列AccessDecisionVoter将会被用来对Authentication
是否有权访问受保护对象进行投票，AccessDecisionManager根据投票结果，做出最终决策。</p> <p>AccessDecisionVoter是一个接口，其中定义有三个方法，具体结构如下所示。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">AccessDecisionVoter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> ACCESS_GRANTED <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> ACCESS_ABSTAIN <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> ACCESS_DENIED <span class="token operator">=</span> ‐<span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">boolean</span> <span class="token function">supports</span><span class="token punctuation">(</span><span class="token class-name">ConfigAttribute</span> var1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">boolean</span> <span class="token function">supports</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> var1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> <span class="token function">vote</span><span class="token punctuation">(</span><span class="token class-name">Authentication</span> var1<span class="token punctuation">,</span> <span class="token class-name">S</span> var2<span class="token punctuation">,</span> <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ConfigAttribute</span><span class="token punctuation">&gt;</span></span> var3<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>vote()方法的返回结果会是AccessDecisionVoter中定义的三个常量之一。ACCESS_GRANTED表示同意，
ACCESS_DENIED表示拒绝，ACCESS_ABSTAIN表示弃权。如果一个AccessDecisionVoter不能判定当前
Authentication是否拥有访问对应受保护对象的权限，则其vote()方法的返回值应当为弃权ACCESS_ABSTAIN。</p> <p>Spring Security内置了三个基于投票的AccessDecisionManager实现类如下，它们分别是<strong>AffirmativeBased</strong>、<strong>ConsensusBased</strong> 和 <strong>UnanimousBased</strong>。</p> <p><strong>AffirmativeBased</strong>的逻辑是：
（1）只要有AccessDecisionVoter的投票为ACCESS_GRANTED则同意用户进行访问；
（2）如果全部弃权也表示通过；
（3）如果没有一个人投赞成票，但是有人投反对票，则将抛出AccessDeniedException。</p> <p><strong>ConsensusBased</strong>的逻辑是：
（1）如果赞成票多于反对票则表示通过。
（2）反过来，如果反对票多于赞成票则将抛出AccessDeniedException。
（3）如果赞成票与反对票相同且不等于0，并且属性allowIfEqualGrantedDeniedDecisions的值为true，则表
示通过，否则将抛出异常AccessDeniedException。参数allowIfEqualGrantedDeniedDecisions的值默认为true。</p> <p>​     （4）如果所有的AccessDecisionVoter都弃权了，则将视参数allowIfAllAbstainDecisions的值而定，如果该值
为true则表示通过，否则将抛出异常AccessDeniedException。参数allowIfAllAbstainDecisions的值默认为false。</p> <p><strong>UnanimousBased</strong>的逻辑与另外两种实现有点不一样，另外两种会一次性把受保护对象的配置属性全部传递
给AccessDecisionVoter进行投票，而UnanimousBased会一次只传递一个ConfigAttribute给AccessDecisionVoter进行投票。这也就意味着如果我们的AccessDecisionVoter的逻辑是只要传递进来的
ConfigAttribute中有一个能够匹配则投赞成票，但是放到UnanimousBased中其投票结果就不一定是赞成了。</p> <p>UnanimousBased的逻辑具体来说是这样的：
（1）如果受保护对象配置的某一个ConfigAttribute被任意的AccessDecisionVoter反对了，则将抛出
AccessDeniedException。
（2）如果没有反对票，但是有赞成票，则表示通过。
（3）如果全部弃权了，则将视参数allowIfAllAbstainDecisions的值而定，true则通过，false则抛出
AccessDeniedException。</p> <p>Spring Security也内置一些投票者实现类如<strong>RoleVoter</strong>、<strong>AuthenticatedVoter</strong>和<strong>WebExpressionVoter</strong>等，可以自行查阅资料进行学习。</p> <h3 id="_4-3-自定义认证"><a href="#_4-3-自定义认证" class="header-anchor">#</a> 4.3 自定义认证</h3> <p>Spring Security提供了非常好的认证扩展方法，比如：快速上手中将用户信息存储到内存中，实际开发中用户信息
通常在数据库，Spring security可以实现从数据库读取用户信息，Spring security还支持多种授权方法。</p> <h4 id="_4-3-1-自定义登录页面"><a href="#_4-3-1-自定义登录页面" class="header-anchor">#</a> 4.3.1 自定义登录页面</h4> <p>在快速上手中，你可能会想知道登录页面从哪里来的？因为我们并没有提供任何的HTML或JSP文件。</p> <p>Spring Security的默认配置没有明确设定一个登录页面的URL，因此Spring Security会根据启用的功能自动生成一个登录页面URL，并使用默认URL处理登录的提交内容，登录后跳转的到默认URL等等。尽管自动生成的登录页面很方便快速启动和运行，但大多数应用程序都希望定义自己的登录页面。</p> <h5 id="_4-3-1-1-认证页面"><a href="#_4-3-1-1-认证页面" class="header-anchor">#</a> 4.3.1.1 认证页面</h5> <p>将security-springmvc工程的login.jsp拷贝到security-springboot下，目录保持一致。</p> <p><img src="/assets/img/Snipaste_2020-04-06_20-48-50.f1e8edfd.jpg" alt="img"></p> <h5 id="_4-3-1-2-配置认证页面"><a href="#_4-3-1-2-配置认证页面" class="header-anchor">#</a> 4.3.1.2 配置认证页面</h5> <p>在<code>WebConfig.java</code>中配置认证页面地址：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//默认Url根路径跳转到/login，此url为Spring Security提供</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addViewControllers</span><span class="token punctuation">(</span><span class="token class-name">ViewControllerRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    registry<span class="token punctuation">.</span><span class="token function">addViewController</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setViewName</span><span class="token punctuation">(</span><span class="token string">&quot;redirect:/login-view&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    registry<span class="token punctuation">.</span><span class="token function">addViewController</span><span class="token punctuation">(</span><span class="token string">&quot;/login-view&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setViewName</span><span class="token punctuation">(</span><span class="token string">&quot;login&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h5 id="_4-3-1-3-安全配置"><a href="#_4-3-1-3-安全配置" class="header-anchor">#</a> 4.3.1.3 安全配置</h5> <p>在 <code>WebSecurityConfig</code> 中配置表单登录信息：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 配置安全拦截机制</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    http<span class="token punctuation">.</span><span class="token function">authorizeRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/r/**&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span>              
            <span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                          
            <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">formLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                 <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">loginPage</span><span class="token punctuation">(</span><span class="token string">&quot;/login‐view&quot;</span><span class="token punctuation">)</span>        <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">loginProcessingUrl</span><span class="token punctuation">(</span><span class="token string">&quot;/login&quot;</span><span class="token punctuation">)</span>      <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">successForwardUrl</span><span class="token punctuation">(</span><span class="token string">&quot;/login‐success&quot;</span><span class="token punctuation">)</span>   <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>（1）允许表单登录
（2）指定我们自己的登录页,spring security以重定向方式跳转到/login-view
（3）指定登录处理的URL，也就是用户名、密码表单提交的目的路径
（4）指定登录成功后的跳转URL
（5）我们必须允许所有用户访问我们的登录页（例如为验证的用户），这个 formLogin().permitAll() 方法允许
任意用户访问基于表单登录的所有的URL。</p> <h5 id="_4-3-1-4-测试"><a href="#_4-3-1-4-测试" class="header-anchor">#</a> 4.3.1.4 测试</h5> <p>当用户没有认证时访问系统的资源会重定向到login-view页面</p> <p><img src="/assets/img/Snipaste_2020-04-06_21-00-00.cbe8f4be.jpg" alt="img"></p> <p>输入账号和密码，点击登录,报错：</p> <p><img src="/assets/img/Snipaste_2020-04-06_20-59-35.3cd6a474.jpg" alt="img"></p> <p><strong>问题解决：</strong>
spring security为防止CSRF（Cross-site request forgery跨站请求伪造）的发生，限制了除了get以外的大多数方
法。</p> <p>解决方法1：(本案例采用该解决方法)
屏蔽CSRF控制，即spring security不再限制CSRF。</p> <p>配置WebSecurityConfig</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span> 
<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    http<span class="token punctuation">.</span><span class="token function">csrf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">//屏蔽CSRF控制，即spring security不再限制CSRF</span>
            <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>解决方法2：
在login.jsp页面添加一个token，spring security会验证token，如果token合法则可以继续请求。</p> <p>修改login.jsp</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>login<span class="token punctuation">&quot;</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span> 
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>hidden<span class="token punctuation">&quot;</span></span>  <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>${_csrf.parameterName}<span class="token punctuation">&quot;</span></span>   <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>${_csrf.token}<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
   ...
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="_4-3-2-连接数据库认证"><a href="#_4-3-2-连接数据库认证" class="header-anchor">#</a> 4.3.2 连接数据库认证</h4> <p>前边的例子我们是将用户信息存储在内存中，实际项目中用户信息存储在数据库中，本节实现从数据库读取用户信
息。根据前边对认证流程研究，只需要重新定义UserDetailService即可实现根据用户账号查询数据库。</p> <h5 id="_4-3-2-1-创建数据库"><a href="#_4-3-2-1-创建数据库" class="header-anchor">#</a> 4.3.2.1 创建数据库</h5> <p>创建user_db数据库</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> spring_security <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> <span class="token string">'utf8'</span> <span class="token keyword">COLLATE</span> <span class="token string">'utf8_general_ci'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>创建t_user表</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>t_user<span class="token punctuation">`</span>  <span class="token punctuation">(</span>
  <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span> <span class="token string">'ID'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>username<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'用户名'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>password<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'密码'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>fullname<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'用户姓名'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>mobile<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'手机号'</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">USING</span> <span class="token keyword">BTREE</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">InnoDB</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> <span class="token operator">=</span> utf8 <span class="token keyword">COLLATE</span> <span class="token operator">=</span> utf8_general_ci <span class="token keyword">COMMENT</span> <span class="token operator">=</span> <span class="token string">'用户表'</span> ROW_FORMAT <span class="token operator">=</span> Dynamic<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h5 id="_4-3-2-2-代码实现"><a href="#_4-3-2-2-代码实现" class="header-anchor">#</a> 4.3.2.2 代码实现</h5> <p>1）定义dataSource</p> <p>在application.yml配置</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/spring_security
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> mysql
    <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>2）添加依赖</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-jdbc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>3）定义Dao</p> <p>定义模型类型，在 model包定义UserDto：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserDto</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> fullname<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> mobile<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>在Dao包定义UserDao：在Dao包定义UserDao：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Repository</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserDao</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">JdbcTemplate</span> jdbcTemplate<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 根据账号查询用户信息
     * @param username
     * @return
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">UserDto</span> <span class="token function">getUserByUsername</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">&quot;select id, username, password, fullname, mobile from t_user where username = ?&quot;</span><span class="token punctuation">;</span>
        <span class="token comment">//连接数据库查询用户</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">UserDto</span><span class="token punctuation">&gt;</span></span> userDtoList <span class="token operator">=</span> jdbcTemplate<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span>username<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">BeanPropertyRowMapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">UserDto</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>userDtoList <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> userDtoList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> userDtoList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h5 id="_4-3-2-3-定义userdetailservice"><a href="#_4-3-2-3-定义userdetailservice" class="header-anchor">#</a> 4.3.2.3 定义UserDetailService</h5> <p>在service包下定义SpringDataUserDetailsService：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringDataUserDetailsService</span> <span class="token keyword">implements</span> <span class="token class-name">UserDetailsService</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">UserDao</span> userDao<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">UserDetails</span> <span class="token function">loadUserByUsername</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">UsernameNotFoundException</span> <span class="token punctuation">{</span>
        <span class="token comment">//连接数据库查询用户信息</span>
        <span class="token class-name">UserDto</span> userDto <span class="token operator">=</span> userDao<span class="token punctuation">.</span><span class="token function">getUserByUsername</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//如果用户查不到，返回null，由DaoAuthenticationProvider来抛异常</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>userDto <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//返回用户信息</span>
        <span class="token class-name">UserDetails</span> userDetails <span class="token operator">=</span> <span class="token class-name">User</span><span class="token punctuation">.</span><span class="token function">withUsername</span><span class="token punctuation">(</span>userDto<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">password</span><span class="token punctuation">(</span>userDto<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authorities</span><span class="token punctuation">(</span><span class="token string">&quot;p1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> userDetails<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h5 id="_4-3-2-4-测试"><a href="#_4-3-2-4-测试" class="header-anchor">#</a> 4.3.2.4 测试</h5> <p>输入账号和密码请求认证，跟踪代码。</p> <h5 id="_4-3-2-5-使用bcryptpasswordencoder"><a href="#_4-3-2-5-使用bcryptpasswordencoder" class="header-anchor">#</a> 4.3.2.5 使用BCryptPasswordEncoder</h5> <p>按照我们前边讲的PasswordEncoder的使用方法，使用BCryptPasswordEncoder需要完成如下工作：</p> <p>1、在安全配置类中定义BCryptPasswordEncoder</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">PasswordEncoder</span> <span class="token function">passwordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">BCryptPasswordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>2、UserDetails中的密码存储BCrypt格式</p> <p>前边实现了从数据库查询用户信息，所以数据库中的密码应该存储BCrypt格式</p> <p><img src="/assets/img/Snipaste_2020-04-06_21-59-39.f9587f66.jpg" alt="img"></p> <h3 id="_4-4-会话"><a href="#_4-4-会话" class="header-anchor">#</a> 4.4 会话</h3> <p>用户认证通过后，为了避免用户的每次操作都进行认证可将用户的信息保存在会话中。Spring Security提供会话管
理，认证通过后将身份信息放入<strong>SecurityContextHolder</strong>上下文，SecurityContext与当前线程进行绑定，方便获取用户身份。</p> <h4 id="_4-4-1-获取用户身份"><a href="#_4-4-1-获取用户身份" class="header-anchor">#</a> 4.4.1.获取用户身份</h4> <p>编写LoginController，实现/r/r1、/r/r2的测试资源，并修改loginSuccess方法。</p> <p>注意<code>getUsername</code>方法，SpringSecurity获取当前登录用户信息的方法为 <code>SecurityContextHolder.getContext().getAuthentication()</code></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>测试</strong>
1, 登录前访问资源
2, 被重定向至登录页面。
3, 登录后访问资源</p> <p>成功访问资源，如下：</p> <p><img src="data:image/jpeg;base64,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" alt="img"></p> <h4 id="_4-4-2会话控制"><a href="#_4-4-2会话控制" class="header-anchor">#</a> 4.4.2会话控制</h4> <p>我们可以通过以下选项准确控制会话何时创建以及Spring Security如何与之交互：</p> <table><thead><tr><th>机制</th> <th>描述</th></tr></thead> <tbody><tr><td>always</td> <td>如果没有session存在就创建一个</td></tr> <tr><td>ifRequired</td> <td>如果需要就创建一个Session（默认）登录时</td></tr> <tr><td>never</td> <td>SpringSecurity 将不会创建Session，但是如果应用中其他地方创建了Session，那么Spring Security将会使用它。</td></tr> <tr><td>stateless</td> <td>SpringSecurity将绝对不会创建Session，也不使用Session</td></tr></tbody></table> <p>通过以下配置方式 (<code>WebSecurityConfig中配置</code>) 对该选项进行配置：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    http<span class="token punctuation">.</span><span class="token function">sessionManagement</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">sessionCreationPolicy</span><span class="token punctuation">(</span><span class="token class-name">SessionCreationPolicy</span><span class="token punctuation">.</span>IF_REQUIRED<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>默认情况下，Spring Security会为每个登录成功的用户会新建一个Session，就是ifRequired 。</p> <p>若选用<strong>never</strong>，则指示Spring Security对登录成功的用户不创建Session了，但若你的应用程序在某地方新建了
session，那么Spring Security会用它的。</p> <p>若使用<strong>stateless</strong>，则说明Spring Security对登录成功的用户不会创建Session了，你的应用程序也不会允许新建session。并且它不使用cookie，所以每个请求都需要重新进行身份验证。这种无状态架构适用于REST API及其无状态认证机制。</p> <p><strong>会话超时</strong>
可以在servlet容器中设置Session的超时时间，如下设置Session有效期为3600s；</p> <p>spring boot 配置文件：</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">servlet</span><span class="token punctuation">:</span>
    <span class="token key atrule">session</span><span class="token punctuation">:</span>
      <span class="token key atrule">timeout</span><span class="token punctuation">:</span> 3600s
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>session超时之后，可以通过Spring Security 设置跳转的路径。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>http<span class="token punctuation">.</span><span class="token function">sessionManagement</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">expiredUrl</span><span class="token punctuation">(</span><span class="token string">&quot;/login‐view?error=EXPIRED_SESSION&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">invalidSessionUrl</span><span class="token punctuation">(</span><span class="token string">&quot;/login‐view?error=INVALID_SESSION&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>expired指session过期，invalidSession指传入的sessionid无效。</p> <p><strong>安全会话cookie</strong></p> <p>我们可以使用httpOnly和secure标签来保护我们的会话cookie：</p> <ul><li>httpOnly ：如果为true，那么浏览器脚本将无法访问cookie</li> <li>secure ：如果为true，则cookie将仅通过HTTPS连接发送</li></ul> <p>spring boot 配置文件：</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">servlet</span><span class="token punctuation">:</span>
    <span class="token key atrule">session</span><span class="token punctuation">:</span>
      <span class="token key atrule">cookie</span><span class="token punctuation">:</span>
        <span class="token key atrule">http-only</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
        <span class="token key atrule">secure</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="_4-5-退出"><a href="#_4-5-退出" class="header-anchor">#</a> 4.5 退出</h3> <p>Spring security默认实现了logout退出，访问/logout，果然不出所料，退出功能Spring也替我们做好了。</p> <p><img src="/assets/img/Snipaste_2020-04-07_22-00-32.1fd22f97.jpg" alt="img"></p> <p>点击“Log Out”退出 成功。
退出 后访问其它url判断是否成功退出。</p> <p>这里也可以自定义退出成功的页面：
在WebSecurityConfig的protected void configure(HttpSecurity http)中配置：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">.</span><span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">logoutUrl</span><span class="token punctuation">(</span><span class="token string">&quot;/logout&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">logoutSuccessUrl</span><span class="token punctuation">(</span><span class="token string">&quot;/login‐view?logout&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>当退出操作出发时，将发生：</p> <ul><li>使 HTTP Session 无效</li> <li>清除 <code>SecurityContextHolder</code></li> <li>跳转到 <code>/login -view?logout</code></li></ul> <p>但是，类似于配置登录功能，咱们可以进一步自定义退出功能：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    http
           <span class="token punctuation">.</span><span class="token function">authorizeRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
       <span class="token comment">//...      </span>
           <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
           <span class="token punctuation">.</span><span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                                                <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
           <span class="token punctuation">.</span><span class="token function">logoutUrl</span><span class="token punctuation">(</span><span class="token string">&quot;/logout&quot;</span><span class="token punctuation">)</span>                                    <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
           <span class="token punctuation">.</span><span class="token function">logoutSuccessUrl</span><span class="token punctuation">(</span><span class="token string">&quot;/login‐view?logout&quot;</span><span class="token punctuation">)</span>                  <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
           <span class="token punctuation">.</span><span class="token function">logoutSuccessHandler</span><span class="token punctuation">(</span>logoutSuccessHandler<span class="token punctuation">)</span>              <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
           <span class="token punctuation">.</span><span class="token function">addLogoutHandler</span><span class="token punctuation">(</span>logoutHandler<span class="token punctuation">)</span>                         <span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>      
           <span class="token punctuation">.</span><span class="token function">invalidateHttpSession</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>
               
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>（1）提供系统退出支持，使用 <code>WebSecurityConfigurerAdapter</code> 会自动被应用
（2）设置触发退出操作的URL (默认是 <code>/logout</code> ).
（3）退出之后跳转的URL。默认是 <code>/login?logout</code> 。
（4）定制的  <code>LogoutSuccessHandler</code> ，用于实现用户退出成功时的处理。如果指定了这个选项那么<code>logoutSuccessUrl()</code> 的设置会被忽略。
（5）添加一个 <code>LogoutHandler</code> ，用于实现用户退出时的清理工作.默认 <code>SecurityContextLogoutHandler</code> 会被添加为最后一个 <code>LogoutHandler</code> 。
（6）指定是否在退出时让 <code>HttpSession</code> 无效。 默认设置为 true。</p> <p><strong>注意：如果让logout在GET请求下生效，必须关闭防止CSRF攻击csrf().disable()。如果开启了CSRF，必须使用</strong> <strong>post方式请求/logout</strong></p> <p><strong>logoutHandler：</strong>
一般来说， LogoutHandler 的实现类被用来执行必要的清理，因而他们不应该抛出异常。</p> <p>下面是Spring Security提供的一些实现：</p> <ul><li>PersistentTokenBasedRememberMeServices 基于持久化token的RememberMe功能的相关清理</li> <li>TokenBasedRememberMeService  基于token的RememberMe功能的相关清理</li> <li>CookieClearingLogoutHandler 退出时Cookie的相关清理</li> <li>CsrfLogoutHandler 负责在退出时移除csrfToken</li> <li>SecurityContextLogoutHandler 退出时SecurityContext的相关清理</li></ul> <p>链式API提供了调用相应的 <code>LogoutHandler</code> 实现的快捷方式，比如deleteCookies()。</p> <h3 id="_4-6-授权"><a href="#_4-6-授权" class="header-anchor">#</a> 4.6 授权</h3> <h4 id="_4-6-1-概述"><a href="#_4-6-1-概述" class="header-anchor">#</a> 4.6.1 概述</h4> <p>授权的方式包括 web授权和方法授权，web授权是通过 url拦截进行授权，方法授权是通过 方法拦截进行授权。他
们都会调用accessDecisionManager进行授权决策，若为web授权则拦截器为FilterSecurityInterceptor；若为方
法授权则拦截器为MethodSecurityInterceptor。如果同时通过web授权和方法授权则先执行web授权，再执行方
法授权，最后决策通过，则允许访问资源，否则将禁止访问。</p> <p>类关系如下：</p> <p><img src="/assets/img/Snipaste_2020-04-07_22-08-29.8c517abf.jpg" alt="img"></p> <h4 id="_4-6-2-准备环境"><a href="#_4-6-2-准备环境" class="header-anchor">#</a> 4.6.2.准备环境</h4> <h5 id="_4-6-2-1-数据库环境"><a href="#_4-6-2-1-数据库环境" class="header-anchor">#</a> 4.6.2.1 数据库环境</h5> <p>在t_user数据库创建如下表：</p> <p>角色表：</p> <p>用户角色关系表：</p> <p>权限表：</p> <p>角色权限关系表：</p> <h5 id="_4-6-2-2-修改userdetailservice"><a href="#_4-6-2-2-修改userdetailservice" class="header-anchor">#</a> 4.6.2.2 修改UserDetailService</h5> <p>1、修改dao接口
在UserDao中添加：</p> <p>2、修改UserDetailService
实现从数据库读取权限</p> <h4 id="_4-6-3-web授权"><a href="#_4-6-3-web授权" class="header-anchor">#</a> 4.6.3.web授权</h4> <p>在上面例子中我们完成了认证拦截，并对/r/**下的某些资源进行简单的授权保护，但是我们想进行灵活的授权控
制该怎么做呢？通过给 http.authorizeRequests() 添加多个子节点来定制需求到我们的URL，如下代码：</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">4/7/2020, 2:13:44 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/zh/DevAdvance/SpringBoot/SpringSecurity/05-实现短信验证码+登录功能.html" class="prev">
        05-实现短信验证码+登录功能
      </a></span> <span class="next"><a href="/zh/DevAdvance/ProgramMethodology/01-敏捷宣言.html">
        01-敏捷软件开发宣言
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.4e1bd89e.js" defer></script><script src="/assets/js/3.3dfb1d3b.js" defer></script><script src="/assets/js/5.4601234e.js" defer></script>
  </body>
</html>
