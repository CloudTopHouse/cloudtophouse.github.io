(window.webpackJsonp=window.webpackJsonp||[]).push([[303],{1174:function(s,e,a){"use strict";a.r(e);var n=a(28),t=Object(n.a)({},(function(){var s=this,e=s.$createElement,a=s._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"在阿里云（centos）上部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#在阿里云（centos）上部署"}},[s._v("#")]),s._v(" 在阿里云（CentOS）上部署")]),s._v(" "),a("p",[s._v("推荐使用阿里云服务器部署，备案快，\b只需要在 APP 上即可完成备案")]),s._v(" "),a("h2",{attrs:{id:"环境介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#环境介绍"}},[s._v("#")]),s._v(" 环境介绍")]),s._v(" "),a("p",[s._v("阿里云 ECS CentOS 7.3 64 "),a("a",{attrs:{href:"https://promotion.aliyun.com/ntms/act/ambassador/sharetouser.html?userCode=3grpysgf&productCode=vm&utm_source=3grpysgf",target:"_blank",rel:"noopener noreferrer"}},[s._v("云服务器ECS优惠券领取链接"),a("OutboundLink")],1)]),s._v(" "),a("ul",[a("li",[s._v("推荐配置：4CPU、8G内存、4M宽带、40G系统盘\n推荐配置适合正式上线使用，你也可根据自身需要更改配置，如果图片多或是图片加载慢则推荐使用云存储和CDN。\n"),a("img",{attrs:{src:"https://upload-images.jianshu.io/upload_images/3985656-605a42f865339daa.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240",alt:"推荐配置20180813112415.png"}})]),s._v(" "),a("li",[s._v("最低配置：1CPU、1G内存、1M宽带、20G系统盘\n最低配置适合开发和测试阶段使用，正式环境不推荐使用。\n"),a("img",{attrs:{src:"https://upload-images.jianshu.io/upload_images/3985656-70a3089dcd017c1a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240",alt:"最低配置20180813110355.png"}})])]),s._v(" "),a("h2",{attrs:{id:"更新系统和安装-git、vim、curl"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#更新系统和安装-git、vim、curl"}},[s._v("#")]),s._v(" 更新系统和安装 git、vim、curl")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("yum update -y\nyum install curl git -y\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h2",{attrs:{id:"通过-nvm-安装-node-js"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#通过-nvm-安装-node-js"}},[s._v("#")]),s._v(" 通过 nvm 安装 Node.js")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("安装 nvm")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("curl -o- https://raw.githubusercontent.com/creationix/nvm/v0.33.5/install.sh | bash\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("验证安装是否成功")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("source ~/.bashrc\nnvm --version\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("看到输出版本信息 0.33.5 表示安装成功")])]),s._v(" "),a("li",[a("p",[s._v("查看最新 8.x 版本 Node.js 版本并安装")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("nvm ls-remote\nnvm install v8.2.1\nnode -v\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("看到输出版本信息 v8.2.1 表示安装成功")]),s._v(" "),a("blockquote",[a("p",[a("strong",[s._v("必须安装 Node.js 8.x 以上版本")])])])])]),s._v(" "),a("h2",{attrs:{id:"安装-mysql-5-7"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装-mysql-5-7"}},[s._v("#")]),s._v(" 安装 MySQL 5.7")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("yum install https://dev.mysql.com/get/mysql57-community-release-el7-11.noarch.rpm -y\nyum install mysql-community-server -y\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("启动 mysql")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("systemctl start mysqld\nsystemctl enable mysqld\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("查找 root 的初始密码")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("cat /var/log/mysqld.log | grep password\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("更改密码")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("mysql_secure_installation\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("回车后输入查找到的密码，然后按照料提示更改密码\n"),a("strong",[s._v("注意新密码必须包含特殊字符、数字、和大小写字母且不得少于8位，否则更改失败。")])]),s._v(" "),a("p",[s._v("验证 mysql 是否安装成功")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("mysql -uroot -p\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("回车后输入查找到的密码，登录成功后的样子")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://upload-images.jianshu.io/upload_images/3985656-b00597fe98f72ecd.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240",alt:"image.png"}})]),s._v(" "),a("h2",{attrs:{id:"开始运行-nideshop"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#开始运行-nideshop"}},[s._v("#")]),s._v(" 开始运行 NideShop")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("下载 NideShop 的源码")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("mkdir /var/www\ncd /var/www\ngit clone https://github.com/tumobi/nideshop\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("全局安装 ThinkJS 命令")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("npm install -g think-cli\nthinkjs -v\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("安装依赖")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("cd /var/www/nideshop\nnpm install\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("创建数据库并导入数据")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('mysql -uroot -p -e "create database nideshop character set utf8mb4"\nmysql -uroot -p nideshop < /var/www/nideshop/nideshop.sql\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("修改 Nideshop 的数据库配置")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("vim src/common/config/database.js\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])])]),s._v(" "),a("p",[s._v("修改后")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("const mysql = require('think-model-mysql');\n\nmodule.exports = {\n    handle: mysql,\n    database: 'nideshop',\n    prefix: 'nideshop_',\n    encoding: 'utf8mb4',\n    host: '127.0.0.1',\n    port: '3306',\n    user: 'root',\n    password: '你的密码',\n    dateStrings: true\n};\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("blockquote",[a("p",[s._v("注意 encoding，prefix 的值")])]),s._v(" "),a("p",[s._v("编译项目")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("npm run compile\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("以生产模式启动")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("node production.js\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("打开另一个终端验证是否启动成功")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("curl -I http://127.0.0.1:8360/\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("输出 HTTP/1.1 200 OK，则表示成功\n"),a("strong",[s._v("Ctrl + C 停止运行")])]),s._v(" "),a("blockquote",[a("p",[s._v("为防止后面操作出现 [Error] Error: Address already in use, port:8360. 的错误，一定要记得Ctrl + C停止运行，并确保 curl -I "),a("a",{attrs:{href:"http://127.0.0.1:8360/",target:"_blank",rel:"noopener noreferrer"}},[s._v("http://127.0.0.1:8360/"),a("OutboundLink")],1),s._v(" 不能访问")])]),s._v(" "),a("h2",{attrs:{id:"使用-pm2-管理服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用-pm2-管理服务"}},[s._v("#")]),s._v(" 使用 PM2 管理服务")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("安装配置 pm2")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("npm install -g pm2\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])])]),s._v(" "),a("p",[s._v("修改项目根目录下的 pm2.json 为：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("vim pm2.json\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("修改后的内容如下 ：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('{\n  "apps": [{\n    "name": "nideshop",\n    "script": "production.js",\n    "cwd": "/var/www/nideshop",\n    "exec_mode": "fork",\n    "max_memory_restart": "256M",\n    "autorestart": true,\n    "node_args": [],\n    "args": [],\n    "env": {\n\n    }\n  }]\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("p",[s._v("如果服务器配置较高，可适当调整 max_memory_restart 和instances的值")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("启动pm2")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("pm2 start pm2.json\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("成功启动")])])]),s._v(" "),a("p",[a("img",{attrs:{src:"http://upload-images.jianshu.io/upload_images/3985656-21a6aa802f7bb1ed.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240",alt:"image.png"}})]),s._v(" "),a("p",[s._v("再次验证是否可以访问")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("curl -I http://127.0.0.1:8360/\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"使用-nginx-做反向代理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用-nginx-做反向代理"}},[s._v("#")]),s._v(" 使用 nginx 做反向代理")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("yum install nginx -y\nsystemctl start nginx.service\nsystemctl enable nginx.service\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("测试本地是否可以正常访问")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("curl -I localhost\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("修改nginx配置")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("cp /etc/nginx/nginx.conf /etc/nginx/nginx.conf.bak\nvim /etc/nginx/nginx.conf\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("内容如下（只需更改 server 里面的内容）")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('user nginx;\nworker_processes auto;\nerror_log /var/log/nginx/error.log;\npid /run/nginx.pid;\n\n# Load dynamic modules. See /usr/share/nginx/README.dynamic.\ninclude /usr/share/nginx/modules/*.conf;\n\nevents {\n    worker_connections 1024;\n}\n\nhttp {\n    log_format  main  \'$remote_addr - $remote_user [$time_local] "$request" \'\n                      \'$status $body_bytes_sent "$http_referer" \'\n                      \'"$http_user_agent" "$http_x_forwarded_for"\';\n\n    access_log  /var/log/nginx/access.log  main;\n\n    sendfile            on;\n    tcp_nopush          on;\n    tcp_nodelay         on;\n    keepalive_timeout   65;\n    types_hash_max_size 2048;\n\n    include             /etc/nginx/mime.types;\n    default_type        application/octet-stream;\n\n    # Load modular configuration files from the /etc/nginx/conf.d directory.\n    # See http://nginx.org/en/docs/ngx_core_module.html#include\n    # for more information.\n    include /etc/nginx/conf.d/*.conf;\n\n    server {\n        listen 80;\n        server_name nideshop.com www.nideshop.com; # 改成你自己的域名\n        root /var/www/nideshop/www;\n        set $node_port 8360;\n\n        index index.js index.html index.htm;\n        if ( -f $request_filename/index.html ){\n            rewrite (.*) $1/index.html break;\n        }\n        if ( !-f $request_filename ){\n            rewrite (.*) /index.js;\n        }\n        location = /index.js {\n            proxy_http_version 1.1;\n            proxy_set_header X-Real-IP $remote_addr;\n            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n            proxy_set_header Host $http_host;\n            proxy_set_header X-NginX-Proxy true;\n            proxy_set_header Upgrade $http_upgrade;\n            proxy_set_header Connection "upgrade";\n            proxy_pass http://127.0.0.1:$node_port$request_uri;\n            proxy_redirect off;\n        }\n\n        location ~ /static/ {\n            etag         on;\n            expires      max;\n        }\n    }\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br")])]),a("ul",[a("li",[a("p",[s._v("重新启动 nginx 并验证 nginx 是否还可以正常访问")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("nginx -t \nsystemctl restart nginx.service\ncurl  http://127.0.0.1/\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])])])]),s._v(" "),a("p",[s._v("如果返回的是下图的 json 数据则表示 nginx 反向代理配置成功")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://upload-images.jianshu.io/upload_images/3985656-ff191d58e075c41c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240",alt:"nginx转发成功"}})]),s._v(" "),a("blockquote",[a("p",[s._v("注：阿里云默认外网不能访问80/443端口，请更改实例的安全组配置，配置教程："),a("a",{attrs:{href:"https://help.aliyun.com/document_detail/25475.html?spm=5176.doc25475.3.3.ZAx4Uo",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://help.aliyun.com/document_detail/25475.html?spm=5176.doc25475.3.3.ZAx4Uo"),a("OutboundLink")],1)])]),s._v(" "),a("h2",{attrs:{id:"配置https访问"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置https访问"}},[s._v("#")]),s._v(" 配置https访问")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("安装certbot")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("yum install epel-release -y\nyum install certbot-nginx -y\ncertbot --nginx\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])])])]),s._v(" "),a("p",[s._v("如果 certbot -nginx 这步出错，则执行")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("pip install --upgrade --force-reinstall 'requests==2.6.0' urllib3\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("重新执行 certbot —nginx")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("配置自动更新证书")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("certbot renew --dry-run\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])])]),s._v(" "),a("blockquote",[a("p",[s._v("详情文档请查看："),a("a",{attrs:{href:"https://certbot.eff.org/#ubuntuxenial-nginx",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://certbot.eff.org/#ubuntuxenial-nginx"),a("OutboundLink")],1)])]),s._v(" "),a("ul",[a("li",[s._v("测试浏览器使用https形式访问是否成功")])]),s._v(" "),a("p",[a("img",{attrs:{src:"http://upload-images.jianshu.io/upload_images/3985656-9b0cfb1db7c99c3e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240",alt:"配置https访问成功"}})]),s._v(" "),a("h2",{attrs:{id:"修改nideshop微信小程序客户端的配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改nideshop微信小程序客户端的配置"}},[s._v("#")]),s._v(" 修改NideShop微信小程序客户端的配置")]),s._v(" "),a("p",[s._v("微信小程序商城客户端GitHub: "),a("a",{attrs:{href:"https://github.com/tumobi/nideshop-mini-program",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://github.com/tumobi/nideshop-mini-program"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("打开文件 config/api.js，修改 NewApiRootUrl 为自己的域名")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("var NewApiRootUrl = 'https://www.nideshop.com/api/';\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("blockquote",[a("p",[s._v("注意 https 和后面的 api/ 不能少")])]),s._v(" "),a("p",[s._v("到此部署成功。如有问题请加QQ群：497145766")])])}),[],!1,null,null,null);e.default=t.exports}}]);