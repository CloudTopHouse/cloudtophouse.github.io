(window.webpackJsonp=window.webpackJsonp||[]).push([[71],{383:function(t,s,a){t.exports=a.p+"assets/img/fff634856c3091d.b9951912.png"},384:function(t,s,a){t.exports=a.p+"assets/img/db85d9068a86cb9.2413be5f.png"},961:function(t,s,a){"use strict";a.r(s);var e=a(28),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"_02-kubernetes-安装前的准备"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_02-kubernetes-安装前的准备"}},[t._v("#")]),t._v(" 02-Kubernetes 安装前的准备")]),t._v(" "),e("h2",{attrs:{id:"概述"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#概述"}},[t._v("#")]),t._v(" 概述")]),t._v(" "),e("p",[t._v("本次安装采用 Ubuntu Server X64 18.04 LTS 版本安装 kubernetes 集群环境，集群节点为 1 主 2 从模式，此次对虚拟机会有些基本要求，如下：")]),t._v(" "),e("ul",[e("li",[t._v("OS：Ubuntu Server X64 18.04 LTS（16.04 版本步骤相同，再之前则不同）")]),t._v(" "),e("li",[t._v("CPU：最低要求，1 CPU 2 核")]),t._v(" "),e("li",[t._v("内存：最低要求，2 GB")]),t._v(" "),e("li",[t._v("磁盘：最低要求，20 GB")])]),t._v(" "),e("h2",{attrs:{id:"节点配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#节点配置"}},[t._v("#")]),t._v(" 节点配置")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",{staticStyle:{"text-align":"left"}},[t._v("主机名")]),t._v(" "),e("th",{staticStyle:{"text-align":"left"}},[t._v("IP")]),t._v(" "),e("th",{staticStyle:{"text-align":"left"}},[t._v("角色")]),t._v(" "),e("th",{staticStyle:{"text-align":"left"}},[t._v("系统")]),t._v(" "),e("th",{staticStyle:{"text-align":"left"}},[t._v("CPU/内存")]),t._v(" "),e("th",{staticStyle:{"text-align":"left"}},[t._v("磁盘")])])]),t._v(" "),e("tbody",[e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("kubernetes-master")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("192.168.141.110")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("Master")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("Ubuntu Server 18.04")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("2 核 2G")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("20G")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("kubernetes-node-01")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("192.168.141.120")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("Node")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("Ubuntu Server 18.04")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("2 核 4G")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("20G")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("kubernetes-node-02")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("192.168.141.121")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("Node")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("Ubuntu Server 18.04")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("2 核 4G")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("20G")])])])]),t._v(" "),e("h2",{attrs:{id:"统一环境配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#统一环境配置"}},[t._v("#")]),t._v(" 统一环境配置")]),t._v(" "),e("blockquote",[e("p",[e("strong",[t._v("注意：")]),t._v(" 以下步骤请在制作 VMware 镜像时一并完成，避免逐台安装的痛苦")])]),t._v(" "),e("h3",{attrs:{id:"关闭交换空间"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#关闭交换空间"}},[t._v("#")]),t._v(" 关闭交换空间")]),t._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("swapoff -a\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br")])]),e("h3",{attrs:{id:"避免开机启动交换空间"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#避免开机启动交换空间"}},[t._v("#")]),t._v(" 避免开机启动交换空间")]),t._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 注释 swap 开头的行vi /etc/fstab")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br")])]),e("h3",{attrs:{id:"关闭防火墙"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#关闭防火墙"}},[t._v("#")]),t._v(" 关闭防火墙")]),t._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("ufw disable\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br")])]),e("h3",{attrs:{id:"配置-dns"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#配置-dns"}},[t._v("#")]),t._v(" 配置 DNS")]),t._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 取消 DNS 行注释，并增加 DNS 配置如：114.114.114.114，修改后重启下计算机vi /etc/systemd/resolved.conf")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br")])]),e("h3",{attrs:{id:"安装-docker"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装-docker"}},[t._v("#")]),t._v(" 安装 Docker")]),t._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 更新软件源")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" update\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 安装所需依赖")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" -y "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" apt-transport-https ca-certificates "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" software-properties-common\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 安装 GPG 证书")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" -fsSL http://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" apt-key "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),t._v(" -\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 新增软件源信息")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" add-apt-repository "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"deb [arch=amd64] http://mirrors.aliyun.com/docker-ce/linux/ubuntu '),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),t._v("lsb_release -cs"),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v(' stable"')]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 再次更新软件源")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" -y update\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 安装 Docker CE 版")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" -y "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" docker-ce\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br"),e("span",{staticClass:"line-number"},[t._v("8")]),e("br"),e("span",{staticClass:"line-number"},[t._v("9")]),e("br"),e("span",{staticClass:"line-number"},[t._v("10")]),e("br"),e("span",{staticClass:"line-number"},[t._v("11")]),e("br"),e("span",{staticClass:"line-number"},[t._v("12")]),e("br")])]),e("h3",{attrs:{id:"配置-docker-加速器"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#配置-docker-加速器"}},[t._v("#")]),t._v(" 配置 Docker 加速器")]),t._v(" "),e("blockquote",[e("p",[e("strong",[t._v("注意：")]),t._v(" 国内镜像加速器可能会很卡，请替换成你自己阿里云镜像加速器，地址如："),e("code",[t._v("https://yourself.mirror.aliyuncs.com")]),t._v("，在阿里云控制台的 "),e("strong",[t._v("容器镜像服务 -> 镜像加速器")]),t._v("菜单中可以找到")])]),t._v(" "),e("p",[t._v("在 "),e("code",[t._v("/etc/docker/daemon.json")]),t._v(" 中写入如下内容（以下配置修改 "),e("code",[t._v("cgroup")]),t._v(" 驱动为 "),e("code",[t._v("systemd")]),t._v("，满足 K8S 建议）")]),t._v(" "),e("div",{staticClass:"language-json line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-json"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"exec-opts"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"native.cgroupdriver=systemd"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"log-driver"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"json-file"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"log-opts"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"max-size"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"100m"')]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"registry-mirrors"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://k7da99jp.mirror.aliyuncs.com/"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://dockerhub.azk8s.cn"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://registry.docker-cn.com"')]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"storage-driver"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"overlay2"')]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br"),e("span",{staticClass:"line-number"},[t._v("8")]),e("br"),e("span",{staticClass:"line-number"},[t._v("9")]),e("br"),e("span",{staticClass:"line-number"},[t._v("10")]),e("br"),e("span",{staticClass:"line-number"},[t._v("11")]),e("br"),e("span",{staticClass:"line-number"},[t._v("12")]),e("br"),e("span",{staticClass:"line-number"},[t._v("13")]),e("br")])]),e("h3",{attrs:{id:"安装-kubernetes-必备工具"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装-kubernetes-必备工具"}},[t._v("#")]),t._v(" 安装 Kubernetes 必备工具")]),t._v(" "),e("p",[t._v("安装三个 Kubernetes 必备工具，分别为 "),e("strong",[t._v("kubeadm")]),t._v("，"),e("strong",[t._v("kubelet")]),t._v("，"),e("strong",[t._v("kubectl")])]),t._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 安装系统工具")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" update "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" -y apt-transport-https\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 安装 GPG 证书")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" https://mirrors.aliyun.com/kubernetes/apt/doc/apt-key.gpg "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" apt-key "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),t._v(" -\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 写入软件源；注意：我们用系统代号为 bionic，但目前阿里云不支持，所以沿用 16.04 的 xenial")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" EOF "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("/etc/apt/sources.list.d/kubernetes.list\ndeb https://mirrors.aliyun.com/kubernetes/apt/ kubernetes-xenial main\nEOF\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 安装")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" update "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" -y kubelet kubeadm kubectl\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br"),e("span",{staticClass:"line-number"},[t._v("8")]),e("br"),e("span",{staticClass:"line-number"},[t._v("9")]),e("br"),e("span",{staticClass:"line-number"},[t._v("10")]),e("br")])]),e("h3",{attrs:{id:"同步时间"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#同步时间"}},[t._v("#")]),t._v(" 同步时间")]),t._v(" "),e("ul",[e("li",[e("strong",[t._v("设置时区")])])]),t._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("dpkg-reconfigure tzdata\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br")])]),e("ul",[e("li",[t._v("选择 "),e("strong",[t._v("Asia（亚洲）")])])]),t._v(" "),e("p",[e("img",{attrs:{src:a(383),alt:"img"}})]),t._v(" "),e("ul",[e("li",[t._v("选择 "),e("strong",[t._v("Shanghai（上海）")])])]),t._v(" "),e("p",[e("img",{attrs:{src:a(384),alt:"img"}})]),t._v(" "),e("ul",[e("li",[e("strong",[t._v("时间同步")])])]),t._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 安装 ntpdate")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" ntpdate\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 设置系统时间与网络时间同步（cn.pool.ntp.org 位于中国的公共 NTP 服务器）")]),t._v("\nntpdate cn.pool.ntp.org\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 将系统时间写入硬件时间")]),t._v("\nhwclock --systohc\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br")])]),e("ul",[e("li",[e("strong",[t._v("确认时间")])])]),t._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("date")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 输出如下（自行对照与系统时间是否一致）")]),t._v("\nSun Jun  "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("22")]),t._v(":02:35 CST "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("2019")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br")])]),e("h3",{attrs:{id:"修改-cloud-cfg"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#修改-cloud-cfg"}},[t._v("#")]),t._v(" 修改 cloud.cfg")]),t._v(" "),e("p",[t._v("主要作用是防止重启后主机名还原")]),t._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("vi")]),t._v(" /etc/cloud/cloud.cfg\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 该配置默认为 false，修改为 true 即可")]),t._v("\npreserve_hostname: "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br")])]),e("h2",{attrs:{id:"单独节点配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#单独节点配置"}},[t._v("#")]),t._v(" 单独节点配置")]),t._v(" "),e("blockquote",[e("p",[e("strong",[t._v("注意：")]),t._v(" 为 Master 和 Node 节点单独配置对应的 "),e("strong",[t._v("IP")]),t._v(" 和 "),e("strong",[t._v("主机名")])])]),t._v(" "),e("h3",{attrs:{id:"配置-ip"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#配置-ip"}},[t._v("#")]),t._v(" 配置 IP")]),t._v(" "),e("p",[t._v("编辑 "),e("code",[t._v("vi /etc/netplan/50-cloud-init.yaml")]),t._v(" 配置文件，修改内容如下")]),t._v(" "),e("div",{staticClass:"language-yaml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("network")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ethernets")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ens33")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("addresses")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("192.168.141.110/24"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n          "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("gateway4")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 192.168.141.2\n          "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("nameservers")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("addresses")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("192.168.141.2"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br"),e("span",{staticClass:"line-number"},[t._v("8")]),e("br")])]),e("p",[t._v("使用 "),e("code",[t._v("netplan apply")]),t._v(" 命令让配置生效")]),t._v(" "),e("h3",{attrs:{id:"配置主机名"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#配置主机名"}},[t._v("#")]),t._v(" 配置主机名")]),t._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 修改主机名")]),t._v("\nhostnamectl set-hostname kubernetes-master\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置 hosts")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v(" /etc/hosts "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("EOF\n192.168.141.110 kubernetes-master\nEOF")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br")])])])}),[],!1,null,null,null);s.default=n.exports}}]);